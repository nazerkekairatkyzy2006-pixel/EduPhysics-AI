<!doctype html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EduPhysics AI ‚Äî –¢“±—Ä–∞“õ—Ç—ã —ç–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;max-width:980px;margin:18px auto;padding:0 14px;line-height:1.35}
    h1{margin:0 0 8px}
    .muted{color:#6b7280;font-size:14px}
    .card{border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin:12px 0;background:#fff}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    input,button{font-size:16px;padding:10px;border-radius:10px;border:1px solid #d1d5db}
    button{cursor:pointer}
    .tabs{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .tab{padding:10px;border-radius:12px;border:1px solid #d1d5db;background:#f9fafb}
    .tab.active{border-color:#111827;background:#fff;font-weight:700}
    .qbox{border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin-top:12px}
    .opt{display:flex;gap:10px;align-items:flex-start;margin:8px 0;padding:10px;border:1px solid #e5e7eb;border-radius:12px}
    .opt input{margin-top:3px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;font-size:13px;margin:4px 6px 0 0}
    .pill.bad{border-color:#fecaca;background:#fff1f2}
    .pill.good{border-color:#bbf7d0;background:#f0fdf4}
    pre{white-space:pre-wrap;background:#0b1020;color:#e5e7eb;padding:12px;border-radius:12px;overflow:auto}
    .hr{height:1px;background:#e5e7eb;margin:12px 0}
    .small{font-size:13px}
    .ok{color:#059669;font-weight:700}
    .bad{color:#b91c1c;font-weight:700}
  </style>
</head>

<body>
  <h1>EduPhysics AI</h1>
  <div class="muted">
    –¢–∞“õ—ã—Ä—ã–ø: <b>–¢“±—Ä–∞“õ—Ç—ã —ç–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã</b>. 3 —Ç–µ—Å—Ç (”ô—Ä“õ–∞–π—Å—ã 10 —Å“±—Ä–∞“õ).  
    ”ò—Ä —Å“±—Ä–∞“õ—Ç–∞ <b>‚Äú–ñ–ò-–º–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä‚Äù</b> –±–∞—Ç—ã—Ä–º–∞—Å—ã –±–∞—Ä (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç—Å—ñ–∑, –¥–∞–π—ã–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ).
  </div>

  <!-- –û“õ—É—à—ã -->
  <div class="card">
    <h2 style="margin:0 0 10px 0;">–û“õ—É—à—ã</h2>
    <div class="row">
      <input id="fio" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ" />
      <input id="klass" placeholder="–°—ã–Ω—ã–ø (–º—ã—Å–∞–ª—ã: 10A)" />
    </div>
    <div class="muted small" style="margin-top:8px;">
      –ï—Å–∫–µ—Ä—Ç—É: –ë“±–ª –Ω“±—Å“õ–∞ —Å—ã—Ä—Ç“õ—ã –ñ–ò-“ì–∞ –∫—ñ–ª—Ç —Å“±—Ä–∞–º–∞–π–¥—ã (Perplexity –∂–æ“õ), –±–∞—Ä–ª—ã“ì—ã —Å–∞–π—Ç—Ç—ã“£ —ñ—à—ñ–Ω–¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ.
    </div>
  </div>

  <!-- –¢–µ—Å—Ç—Ç–µ—Ä -->
  <div class="card">
    <h2 style="margin:0 0 10px 0;">–¢–µ—Å—Ç—Ç–µ—Ä</h2>
    <div class="tabs">
      <button class="tab active" id="tab1">–¢–µ—Å—Ç 1: –û–º –∑–∞“£—ã</button>
      <button class="tab" id="tab2">–¢–µ—Å—Ç 2: “ö–æ—Å—ã–ª—É–ª–∞—Ä</button>
      <button class="tab" id="tab3">–¢–µ—Å—Ç 3: “ö—É–∞—Ç/–∂“±–º—ã—Å</button>
    </div>

    <div class="actions">
      <button id="startBtn">–ë–∞—Å—Ç–∞—É</button>
      <button id="resetBtn">–ë”ô—Ä—ñ–Ω —Ç–∞–∑–∞–ª–∞—É</button>
    </div>
  </div>

  <!-- Quiz -->
  <div class="card" id="quizArea" style="display:none;">
    <div class="muted small">
      –ê“ì—ã–º–¥–∞“ì—ã —Ç–µ—Å—Ç: <b id="testName"></b> ‚Ä¢ –°“±—Ä–∞“õ: <b id="qPos"></b>/<b id="qTotal"></b>
    </div>

    <div class="qbox">
      <div style="font-size:18px;font-weight:800" id="qText"></div>
      <div class="muted small" id="qHint" style="margin-top:6px;"></div>

      <div id="opts"></div>

      <div class="actions">
        <button id="checkBtn">–¢–µ–∫—Å–µ—Ä—É</button>
        <button id="nextBtn" style="display:none;">–ö–µ–ª–µ—Å—ñ</button>
      </div>

      <div class="hr"></div>

      <div id="afterCheck" style="display:none;">
        <div>–ù”ô—Ç–∏–∂–µ: <span id="isCorrect"></span></div>
        <div class="muted small" style="margin-top:6px;"><b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> <span id="correctText"></span></div>

        <div class="muted small" style="margin-top:10px;"><b>“ö—ã—Å“õ–∞ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:</b></div>
        <div id="shortExplain" class="small"></div>

        <div class="muted small" style="margin-top:10px;"><b>“ö–∞—Ç–µ —Ç–µ–≥ (tag):</b> <span id="tagOut"></span></div>

        <!-- AI explanation (offline) -->
        <button id="aiExplainBtn" style="margin-top:10px;">–ñ–ò-–º–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä</button>
        <div id="aiExplainStatus" class="muted small" style="margin-top:8px;"></div>
        <pre id="aiExplainOut" style="display:none; margin-top:8px;"></pre>
      </div>
    </div>
  </div>

  <!-- Teacher report -->
  <div class="card" id="reportArea" style="display:none;">
    <h2 style="margin:0 0 8px 0;">–ú“±“ì–∞–ª—ñ–º–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω –∞–Ω–∞–ª–∏–∑</h2>
    <div class="muted small">“∞–ø–∞–π, —Ç–æ–ø-3 “õ–∞—Ç–µ —Ç“Ø—Ä—ñ (tags), “±—Å—ã–Ω—ã—Å—Ç–∞—Ä.</div>

    <div class="qbox" style="margin-top:10px;">
      <div id="summaryText" class="small"></div>

      <h3 style="margin:14px 0 6px 0;">–¢–æ–ø-3 “õ–∞—Ç–µ —Ç“Ø—Ä—ñ (tags)</h3>
      <div id="topTags"></div>

      <h3 style="margin:14px 0 6px 0;">“∞—Å—ã–Ω—ã—Å—Ç–∞—Ä</h3>
      <ul id="recs" class="small"></ul>

      <div class="actions">
        <button id="againBtn">–¢–∞“ì—ã —Ç–µ—Å—Ç —Ç–∞–ø—Å—ã—Ä—É</button>
      </div>
    </div>
  </div>

<script>
// =======================
// 3 —Ç–µ—Å—Ç √ó 10 —Å“±—Ä–∞“õ
// ”ò—Ä —Å“±—Ä–∞“õ—Ç–∞: explain + aiExplain (offline) + tag
// =======================
const TESTS = {
  t1: {
    title: "–¢–µ—Å—Ç 1: –û–º –∑–∞“£—ã –∂”ô–Ω–µ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
    questions: [
      { q:"–û–º –∑–∞“£—ã–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞—Å—ã “õ–∞–π—Å—ã?", hint:"I, U, R –±–∞–π–ª–∞–Ω—ã—Å—ã", options:["I = U/R","I = R/U","U = I/R","R = U¬∑I"], correct:0,
        tag:"–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
        explain:"–û–º –∑–∞“£—ã: I = U/R. –¢–æ–∫ –∫“Ø—à—ñ –∫–µ—Ä–Ω–µ—É–≥–µ —Ç—É—Ä–∞, –∫–µ–¥–µ—Ä–≥—ñ–≥–µ –∫–µ—Ä—ñ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n1) –û–º –∑–∞“£—ã I=U/R: –∫–µ—Ä–Ω–µ—É (U) –∞—Ä—Ç—Å–∞ —Ç–æ–∫ (I) –∞—Ä—Ç–∞–¥—ã, –∫–µ–¥–µ—Ä–≥—ñ (R) –∞—Ä—Ç—Å–∞ —Ç–æ–∫ –∞–∑–∞—è–¥—ã.\n2) “ö–∞—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—Ç–∞—Ä –Ω–µ–≥–µ “õ–∞—Ç–µ: I=R/U ‚Äì –æ—Ä—ã–Ω–¥–∞—Ä—ã –∞—É—ã—Å“õ–∞–Ω; U=I/R ‚Äì –¥“±—Ä—ã—Å —Ñ–æ—Ä–º—É–ª–∞ –µ–º–µ—Å; R=U¬∑I ‚Äì –∫”©–±–µ–π—Ç—É –∫–µ—Ä–µ–∫ –µ–º–µ—Å.\n3) “ö–∞–¥–∞–º: –±–µ—Ä—ñ–ª–≥–µ–Ω–¥—ñ –∂–∞–∑ ‚Üí –¥“±—Ä—ã—Å —Ñ–æ—Ä–º—É–ª–∞–Ω—ã —Ç–∞“£–¥–∞ ‚Üí –æ—Ä–Ω—ã–Ω–∞ “õ–æ–π ‚Üí –±—ñ—Ä–ª—ñ–∫—Ç—ñ —Ç–µ–∫—Å–µ—Ä.\n–ú—ã—Å–∞–ª: U=12–í, R=6Œ© ‚Üí I=12/6=2–ê." },
      { q:"–ö–µ—Ä–Ω–µ—É–¥—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?", hint:"U", options:["–í–æ–ª—å—Ç (V)","–û–º (Œ©)","–ê–º–ø–µ—Ä (A)","–í–∞—Ç—Ç (W)"], correct:0,
        tag:"”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä", explain:"–ö–µ—Ä–Ω–µ—É U ‚Äî –í–æ–ª—å—Ç–ø–µ–Ω (V) ”©–ª—à–µ–Ω–µ–¥—ñ.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nU ‚Äî –∫–µ—Ä–Ω–µ—É, –±—ñ—Ä–ª—ñ–≥—ñ –í–æ–ª—å—Ç (V). I ‚Äî –ê–º–ø–µ—Ä (A), R ‚Äî –û–º (Œ©), P ‚Äî –í–∞—Ç—Ç (W).\n–ú—ã—Å–∞–ª: U=220 V ‚Äî —Ç“±—Ä–º—ã—Å—Ç—ã“õ –∂–µ–ª—ñ –∫–µ—Ä–Ω–µ—É—ñ." },
      { q:"–ö–µ–¥–µ—Ä–≥—ñ–Ω—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?", hint:"R", options:["–û–º (Œ©)","–í–æ–ª—å—Ç (V)","–ê–º–ø–µ—Ä (A)","–î–∂–æ—É–ª—å (J)"], correct:0,
        tag:"”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä", explain:"–ö–µ–¥–µ—Ä–≥—ñ R ‚Äî –û–º–º–µ–Ω (Œ©) ”©–ª—à–µ–Ω–µ–¥—ñ.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nR ‚Äî –∫–µ–¥–µ—Ä–≥—ñ, –±—ñ—Ä–ª—ñ–≥—ñ –û–º (Œ©). –û–º ‚Äî —Ç–æ–∫“õ–∞ ‚Äú“õ–∞—Ä—Å—ã–ª–∞—Å—É‚Äù —à–∞–º–∞—Å—ã.\n–ú—ã—Å–∞–ª: R “Ø–ª–∫–µ–Ω –±–æ–ª—Å–∞, –±—ñ—Ä–¥–µ–π U –∫–µ–∑—ñ–Ω–¥–µ I –∞–∑ –±–æ–ª–∞–¥—ã (I=U/R)." },
      { q:"U=12 –í, R=3 Œ© –±–æ–ª—Å–∞, I=?", hint:"I=U/R", options:["4 A","36 A","0.25 A","9 A"], correct:0,
        tag:"–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É", explain:"I=U/R=12/3=4 A.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n1) –§–æ—Ä–º—É–ª–∞: I=U/R.\n2) –û—Ä–Ω—ã–Ω–∞ “õ–æ—è–º—ã–∑: 12/3=4.\n3) –ë—ñ—Ä–ª—ñ–∫: –í/Œ© = A.\n“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã: I=4A." },
      { q:"I=2 A, R=5 Œ© –±–æ–ª—Å–∞, U=?", hint:"U=I¬∑R", options:["10 V","2.5 V","7 V","20 V"], correct:0,
        tag:"–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É", explain:"U=I¬∑R=2¬∑5=10 V.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nU=I¬∑R.\n2¬∑5=10.\n–ë—ñ—Ä–ª—ñ–∫: A¬∑Œ© = V.\nU=10V." },
      { q:"U=9 V, I=3 A –±–æ–ª—Å–∞, R=?", hint:"R=U/I", options:["3 Œ©","27 Œ©","6 Œ©","9 Œ©"], correct:0,
        tag:"–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É", explain:"R=U/I=9/3=3 Œ©.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nR=U/I.\n9/3=3.\n–ë—ñ—Ä–ª—ñ–∫: V/A = Œ©.\nR=3Œ©." },
      { q:"R –∞—Ä—Ç—Å–∞ (U —Ç“±—Ä–∞“õ—Ç—ã), I “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ?", hint:"I=U/R", options:["–ö–µ–º–∏–¥—ñ","–ê—Ä—Ç–∞–¥—ã","”®–∑–≥–µ—Ä–º–µ–π–¥—ñ","–ë—ñ–ª–º–µ–π–º—ñ–Ω"], correct:0,
        tag:"–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫", explain:"I=U/R ‚Üí R –∞—Ä—Ç—Å–∞, I –∫–µ–º–∏–¥—ñ.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nI=U/R. –ë”©–ª–≥—ñ—à (R) ”©—Å—Å–µ, –±”©–ª—à–µ–∫ –∞–∑–∞—è–¥—ã.\n2 –µ—Å–µ R –∞—Ä—Ç—Å–∞ ‚Üí 2 –µ—Å–µ I –∞–∑–∞—è–¥—ã." },
      { q:"–¢–æ–∫ –∫“Ø—à—ñ–Ω—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?", hint:"I", options:["–ê–º–ø–µ—Ä (A)","–û–º (Œ©)","–í–æ–ª—å—Ç (V)","–í–∞—Ç—Ç (W)"], correct:0,
        tag:"”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä", explain:"–¢–æ–∫ –∫“Ø—à—ñ I ‚Äî –ê–º–ø–µ—Ä (A).",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nI ‚Äî –ê–º–ø–µ—Ä. –ê–Ω—ã“õ—Ç–∞–º–∞: I=q/t.\n–ú—ã—Å–∞–ª: q=10–ö–ª, t=5—Å ‚Üí I=2A." },
      { q:"I=q/t —Ñ–æ—Ä–º—É–ª–∞—Å—ã –Ω–µ–Ω—ñ –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ?", hint:"–ê–Ω—ã“õ—Ç–∞–º–∞", options:["–¢–æ–∫ –∫“Ø—à—ñ –∞–Ω—ã“õ—Ç–∞–º–∞—Å—ã","–ö–µ—Ä–Ω–µ—É","–ö–µ–¥–µ—Ä–≥—ñ","“ö—É–∞—Ç"], correct:0,
        tag:"–¢–æ–∫ –∞–Ω—ã“õ—Ç–∞–º–∞—Å—ã", explain:"I=q/t ‚Äî —É–∞“õ—ã—Ç –±—ñ—Ä–ª—ñ–≥—ñ–Ω–¥–µ–≥—ñ –∑–∞—Ä—è–¥.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nI=q/t: 1 —Å–µ–∫—É–Ω–¥—Ç–∞ “õ–∞–Ω—à–∞ –∑–∞—Ä—è–¥ ”©—Ç–µ–¥—ñ.\n–ï–≥–µ—Ä –∑–∞—Ä—è–¥ –∫”©–ø ”©—Ç—Å–µ ‚Üí —Ç–æ–∫ “Ø–ª–∫–µ–Ω." },
      { q:"“ö–∞–π—Å—ã—Å—ã –¥“±—Ä—ã—Å?", hint:"–û–º –∑–∞“£—ã", options:["U=I¬∑R","I=U¬∑R","R=I/U","U=R/I"], correct:0,
        tag:"–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã", explain:"–î“±—Ä—ã—Å—ã: U=I¬∑R.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–û–º –∑–∞“£—ã–Ω—ã“£ 3 —Ç“Ø—Ä—ñ: I=U/R, U=I¬∑R, R=U/I.\n“ö–∞–ª“ì–∞–Ω–¥–∞—Ä—ã —Ñ–æ—Ä–º—É–ª–∞–Ω—ã —à–∞—Ç–∞—Å—Ç—ã—Ä—É–¥–∞–Ω —à—ã“ì–∞–¥—ã." }
    ]
  },

  t2: {
    title: "–¢–µ—Å—Ç 2: –¢—ñ–∑–±–µ–∫—Ç–µ–π –∂”ô–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É",
    questions: [
      { q:"–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞ —Ç–æ–∫ –∫“Ø—à—ñ “õ–∞–ª–∞–π –±–æ–ª–∞–¥—ã?", hint:"I –±–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ?", options:["–ë–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π","”ò—Ä –∂–µ—Ä–¥–µ ”ô—Ä—Ç“Ø—Ä–ª—ñ","–ù”©–ª","–ö–µ—Ä–Ω–µ—É–≥–µ —Ç–µ“£"], correct:0,
        tag:"–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–∞—Å–∏–µ—Ç", explain:"–¢—ñ–∑–±–µ–∫—Ç–µ–π —Ç—ñ–∑–±–µ–∫—Ç–µ —Ç–æ–∫ –±–∞—Ä–ª—ã“õ —ç–ª–µ–º–µ–Ω—Ç—Ç–µ –±—ñ—Ä–¥–µ–π.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ –±—ñ—Ä “ì–∞–Ω–∞ ‚Äú–∂–æ–ª‚Äù –±–∞—Ä, —Å–æ–Ω–¥—ã“õ—Ç–∞–Ω I –±—ñ—Ä–¥–µ–π ”©—Ç–µ–¥—ñ.\n–ê–ª –∫–µ—Ä–Ω–µ—É –±”©–ª—ñ–∫—Ç–µ—Ä–≥–µ –±”©–ª—ñ–Ω–µ–¥—ñ: U=U1+U2..." },
      { q:"–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞“ì—ã —Ç–æ–ª—ã“õ –∫–µ–¥–µ—Ä–≥—ñ?", hint:"“ö–æ—Å—ã–Ω–¥—ã", options:["R=R1+R2+...","1/R=1/R1+1/R2","R=R1¬∑R2","R=R1/R2"], correct:0,
        tag:"–¢—ñ–∑–±–µ–∫—Ç–µ–π –∫–µ–¥–µ—Ä–≥—ñ", explain:"–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ –∫–µ–¥–µ—Ä–≥—ñ–ª–µ—Ä “õ–æ—Å—ã–ª–∞–¥—ã.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–¢—ñ–∑–±–µ–∫—Ç–µ–π: R–∂–∞–ª–ø—ã = R1 + R2 + ...\n–ú—ã—Å–∞–ª: 2Œ©+3Œ©=5Œ©." },
      { q:"–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞ –∫–µ—Ä–Ω–µ—É “õ–∞–ª–∞–π –±–æ–ª–∞–¥—ã?", hint:"U —Ç–∞—Ä–º–∞“õ—Ç–∞—Ä–¥–∞?", options:["–ë–∞—Ä–ª—ã“õ —Ç–∞—Ä–º–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–π","”ò—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ ”ô—Ä—Ç“Ø—Ä–ª—ñ","–ù”©–ª","–¢–æ–∫“õ–∞ —Ç–µ“£"], correct:0,
        tag:"–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–∞—Å–∏–µ—Ç", explain:"–ü–∞—Ä–∞–ª–ª–µ–ª—å —Ç–∞—Ä–º–∞“õ—Ç–∞—Ä–¥—ã“£ –∫–µ—Ä–Ω–µ—É—ñ –±—ñ—Ä–¥–µ–π.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ —Ç–∞—Ä–º–∞“õ—Ç–∞—Ä –±—ñ—Ä–¥–µ–π –µ–∫—ñ –Ω“Ø–∫—Ç–µ–≥–µ “õ–æ—Å—ã–ª–∞–¥—ã ‚Üí U –±—ñ—Ä–¥–µ–π.\n–ê–ª —Ç–æ–∫ –±”©–ª—ñ–Ω–µ–¥—ñ: I=I1+I2..." },
      { q:"–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞“ì—ã —Ñ–æ—Ä–º—É–ª–∞?", hint:"–ö–µ—Ä—ñ “õ–æ—Å—ã–Ω–¥—ã", options:["1/R=1/R1+1/R2+...","R=R1+R2","R=R1¬∑R2","R=R1/R2"], correct:0,
        tag:"–ü–∞—Ä–∞–ª–ª–µ–ª—å –∫–µ–¥–µ—Ä–≥—ñ", explain:"–ü–∞—Ä–∞–ª–ª–µ–ª—å: 1/R–∂–∞–ª–ø—ã = 1/R1 + 1/R2 + ...",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ –∫–µ–¥–µ—Ä–≥—ñ ”ô—Ä“õ–∞—à–∞–Ω –µ“£ –∫—ñ—à—ñ—Å—ñ–Ω–µ–Ω –¥–µ –∫—ñ—à—ñ –±–æ–ª–∞–¥—ã.\n–°–µ–±–µ–±—ñ —Ç–æ–∫“õ–∞ –∂–æ–ª –∫”©–±–µ–π–µ–¥—ñ." },
      { q:"R1=4Œ©, R2=6Œ© —Ç—ñ–∑–±–µ–∫—Ç–µ–π –±–æ–ª—Å–∞, R–∂–∞–ª–ø—ã?", hint:"“ö–æ—Å—ã–Ω–¥—ã", options:["10Œ©","2.4Œ©","24Œ©","6Œ©"], correct:0,
        tag:"–ï—Å–µ–ø (—Ç—ñ–∑–±–µ–∫—Ç–µ–π)", explain:"R=4+6=10Œ©.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–¢—ñ–∑–±–µ–∫—Ç–µ–π: “õ–æ—Å–∞–º—ã–∑.\n4+6=10Œ©." },
      { q:"R1=4Œ©, R2=6Œ© –ø–∞—Ä–∞–ª–ª–µ–ª—å –±–æ–ª—Å–∞, R–∂–∞–ª–ø—ã?", hint:"1/R=1/4+1/6", options:["2.4Œ©","10Œ©","5Œ©","6Œ©"], correct:0,
        tag:"–ï—Å–µ–ø (–ø–∞—Ä–∞–ª–ª–µ–ª—å)", explain:"1/R=1/4+1/6=5/12 ‚Üí R=12/5=2.4Œ©.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n1/R=1/4+1/6=3/12+2/12=5/12.\nR=12/5=2.4Œ©." },
      { q:"–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ –∂–∞–ª–ø—ã —Ç–æ–∫ “õ–∞–ª–∞–π?", hint:"“ö–æ—Å—ã–Ω–¥—ã", options:["I=I1+I2+...","I –±—ñ—Ä–¥–µ–π","I=0","U-“ì–∞ —Ç–µ“£"], correct:0,
        tag:"–ü–∞—Ä–∞–ª–ª–µ–ª—å —Ç–æ–∫", explain:"–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ –∂–∞–ª–ø—ã —Ç–æ–∫ —Ç–∞—Ä–º–∞“õ —Ç–æ–∫—Ç–∞—Ä—ã–Ω—ã“£ “õ–æ—Å—ã–Ω–¥—ã—Å—ã.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nI–∂–∞–ª–ø—ã = I1 + I2 + ...\n–ö”©–ø —Ç–∞—Ä–º–∞“õ “õ–æ—Å—ã–ª—Å–∞ ‚Üí I–∂–∞–ª–ø—ã ”©—Å–µ–¥—ñ." },
      { q:"–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å“õ–∞–Ω–¥–∞ –∫–µ—Ä–Ω–µ—É “õ–∞–ª–∞–π?", hint:"“ö–æ—Å—ã–Ω–¥—ã", options:["U=U1+U2+...","U –±—ñ—Ä–¥–µ–π","U=0","I-–≥–µ —Ç–µ“£"], correct:0,
        tag:"–¢—ñ–∑–±–µ–∫—Ç–µ–π –∫–µ—Ä–Ω–µ—É", explain:"–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ –∫–µ—Ä–Ω–µ—É –±”©–ª—ñ–∫—Ç–µ—Ä–≥–µ –±”©–ª—ñ–Ω–µ–¥—ñ, “õ–æ—Å—ã–ª–∞–¥—ã.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–¢—ñ–∑–±–µ–∫—Ç–µ–π: U–∂–∞–ª–ø—ã = U1 + U2 + ...\nR “Ø–ª–∫–µ–Ω —ç–ª–µ–º–µ–Ω—Ç—Ç–µ U “Ø–ª–µ—Å—ñ –∫”©–±—ñ—Ä–µ–∫." },
      { q:"–ï–∫—ñ –±—ñ—Ä–¥–µ–π R –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—Å–∞ R–∂–∞–ª–ø—ã?", hint:"R/2", options:["R/2","2R","R","R¬≤"], correct:0,
        tag:"–ü–∞—Ä–∞–ª–ª–µ–ª—å –∑–∞“£–¥—ã–ª—ã“õ", explain:"–ï–∫—ñ –±—ñ—Ä–¥–µ–π R –ø–∞—Ä–∞–ª–ª–µ–ª—å ‚Üí R–∂–∞–ª–ø—ã=R/2.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n1/R–∂=1/R+1/R=2/R ‚Üí R–∂=R/2.\n10Œ©||10Œ©=5Œ©." },
      { q:"–ï–∫—ñ –±—ñ—Ä–¥–µ–π R —Ç—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—Å–∞ R–∂–∞–ª–ø—ã?", hint:"2R", options:["2R","R/2","R","0"], correct:0,
        tag:"–¢—ñ–∑–±–µ–∫—Ç–µ–π –∑–∞“£–¥—ã–ª—ã“õ", explain:"–ï–∫—ñ –±—ñ—Ä–¥–µ–π R —Ç—ñ–∑–±–µ–∫—Ç–µ–π ‚Üí R–∂–∞–ª–ø—ã=2R.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–¢—ñ–∑–±–µ–∫—Ç–µ–π: R–∂=R+R=2R." }
    ]
  },

  t3: {
    title: "–¢–µ—Å—Ç 3: “ö—É–∞—Ç, –∂“±–º—ã—Å, —ç–Ω–µ—Ä–≥–∏—è",
    questions: [
      { q:"–≠–ª–µ–∫—Ç—Ä “õ—É–∞—Ç—ã–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", hint:"P, U, I", options:["P=U¬∑I","P=U/I","P=I/R","P=R/U"], correct:0,
        tag:"“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã", explain:"“ö—É–∞—Ç: P = U¬∑I.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n“ö—É–∞—Ç ‚Äî –±—ñ—Ä —É–∞“õ—ã—Ç—Ç–∞“ì—ã —ç–Ω–µ—Ä–≥–∏—è –±–µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã.\nP=U¬∑I.\n–ú—ã—Å–∞–ª: 12–í¬∑2–ê=24–í—Ç." },
      { q:"“ö—É–∞—Ç—Ç—ã“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?", hint:"P", options:["–í–∞—Ç—Ç (W)","–î–∂–æ—É–ª—å (J)","–û–º (Œ©)","–ö—É–ª–æ–Ω (C)"], correct:0,
        tag:"”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä", explain:"“ö—É–∞—Ç –í–∞—Ç—Ç–ø–µ–Ω ”©–ª—à–µ–Ω–µ–¥—ñ.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n1 –í—Ç = 1 –î–∂/—Å.\n–≠–Ω–µ—Ä–≥–∏—è –î–∂–æ—É–ª—å–º–µ–Ω, –∞–ª “õ—É–∞—Ç –í–∞—Ç—Ç–ø–µ–Ω." },
      { q:"–≠–Ω–µ—Ä–≥–∏—è (–∂“±–º—ã—Å) —Ñ–æ—Ä–º—É–ª–∞—Å—ã?", hint:"A, P, t", options:["A=P¬∑t","A=P/t","A=U/I","A=R¬∑t"], correct:0,
        tag:"–≠–Ω–µ—Ä–≥–∏—è —Ñ–æ—Ä–º—É–ª–∞—Å—ã", explain:"–≠–Ω–µ—Ä–≥–∏—è: A = P¬∑t (—Å–æ–Ω–¥–∞–π-–∞“õ A=UIt).",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nA=P¬∑t.\n–£–∞“õ—ã—Ç —Å–µ–∫—É–Ω–¥–ø–µ–Ω (—Å) –∞–ª—ã–Ω—É—ã –∫–µ—Ä–µ–∫.\n–ú—ã—Å–∞–ª: 100–í—Ç 10—Å ‚Üí 1000–î–∂." },
      { q:"U=220–í, I=2A –±–æ–ª—Å–∞ P=?", hint:"P=U¬∑I", options:["440–í—Ç","110–í—Ç","220–í—Ç","222–í—Ç"], correct:0,
        tag:"–ï—Å–µ–ø (“õ—É–∞—Ç)", explain:"P=220¬∑2=440–í—Ç.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nP=U¬∑I.\n220√ó2=440.\n“ö—É–∞—Ç “Ø–ª–∫–µ–Ω –±–æ–ª—Å–∞, —ç–Ω–µ—Ä–≥–∏—è –¥–∞ —Ç–µ–∑ –∂–∏–Ω–∞–ª–∞–¥—ã." },
      { q:"P=60–í—Ç —à–∞–º 5 –º–∏–Ω—É—Ç –∂–∞–Ω—Å–∞, —ç–Ω–µ—Ä–≥–∏—è “õ–∞–Ω—à–∞? (—Å–µ–∫—É–Ω–¥–ø–µ–Ω)", hint:"t=300—Å", options:["18000–î–∂","300–î–∂","1200–î–∂","600–î–∂"], correct:0,
        tag:"–£–∞“õ—ã—Ç—Ç—ã –∞—É—ã—Å—Ç—ã—Ä—É", explain:"t=5–º–∏–Ω=300—Å, A=60¬∑300=18000–î–∂.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–ê–ª–¥—ã–º–µ–Ω –º–∏–Ω—É—Ç—Ç—ã —Å–µ–∫—É–Ω–¥“õ–∞ –∞—É—ã—Å—Ç—ã—Ä: 5√ó60=300—Å.\nA=P¬∑t=60√ó300=18000–î–∂." },
      { q:"“ö–∞–π —Ñ–æ—Ä–º—É–ª–∞ –¥“±—Ä—ã—Å?", hint:"–ë–∞–ª–∞–º–∞ —Ç“Ø—Ä", options:["P=I¬≤R","P=R¬≤I","P=U¬≤I","P=I/R¬≤"], correct:0,
        tag:"“ö—É–∞—Ç —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É", explain:"P=I¬≤R –∂”ô–Ω–µ P=U¬≤/R ‚Äî –µ–∫–µ—É—ñ –¥–µ –¥“±—Ä—ã—Å —Ç“Ø—Ä–ª–µ—Ä.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nP=U¬∑I, –∞–ª U=I¬∑R.\n–°–æ–Ω–¥–∞ P=I¬∑(I¬∑R)=I¬≤R.\n–¢–∞“ì—ã: P=U¬≤/R." },
      { q:"U —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, R –∞–∑–∞–π—Å–∞, P “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ? (P=U¬≤/R)", hint:"–ö–µ—Ä—ñ", options:["–ê—Ä—Ç–∞–¥—ã","–ö–µ–º–∏–¥—ñ","”®–∑–≥–µ—Ä–º–µ–π–¥—ñ","–ù”©–ª –±–æ–ª–∞–¥—ã"], correct:0,
        tag:"–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫ (“õ—É–∞—Ç)", explain:"P=U¬≤/R ‚Üí R –∞–∑–∞–π—Å–∞, P –∞—Ä—Ç–∞–¥—ã.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nR –∞–∑–∞–π—Å–∞, –±”©–ª–≥—ñ—à –∫—ñ—à—ñ—Ä–µ–π–µ–¥—ñ ‚Üí P ”©—Å–µ–¥—ñ.\n–°–∞“õ –±–æ–ª: —à–∞–º–∞–¥–∞–Ω —Ç—ã—Å —Ç–æ–∫ “õ—ã–∑–¥—ã—Ä—É—ã –º“Ø–º–∫—ñ–Ω." },
      { q:"I —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, R –∞—Ä—Ç—Å–∞, P “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ? (P=I¬≤R)", hint:"–¢—É—Ä–∞", options:["–ê—Ä—Ç–∞–¥—ã","–ö–µ–º–∏–¥—ñ","”®–∑–≥–µ—Ä–º–µ–π–¥—ñ","–ù”©–ª"], correct:0,
        tag:"–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫ (“õ—É–∞—Ç)", explain:"P=I¬≤R ‚Üí R –∞—Ä—Ç—Å–∞, P –∞—Ä—Ç–∞–¥—ã.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nI —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, P —Ç—É—Ä–∞ R-–≥–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª.\nR 2 –µ—Å–µ –∞—Ä—Ç—Å–∞ ‚Üí P 2 –µ—Å–µ –∞—Ä—Ç–∞–¥—ã." },
      { q:"A=UIt —Ñ–æ—Ä–º—É–ª–∞—Å—ã–Ω–¥–∞ t “õ–∞–Ω–¥–∞–π –±—ñ—Ä–ª—ñ–∫—Ç–µ?", hint:"SI", options:["–°–µ–∫—É–Ω–¥","–ú–∏–Ω—É—Ç","–°–∞“ì–∞—Ç","–ö“Ø–Ω"], correct:0,
        tag:"”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä", explain:"t ‚Äî —Å–µ–∫—É–Ω–¥–ø–µ–Ω –∞–ª—ã–Ω—É—ã –∫–µ—Ä–µ–∫.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\nSI –∂“Ø–π–µ—Å—ñ–Ω–¥–µ —É–∞“õ—ã—Ç —Å–µ–∫—É–Ω–¥.\n1–º–∏–Ω=60—Å, 1—Å–∞“ì=3600—Å." },
      { q:"–¢“±—Ä–º—ã—Å—Ç–∞ —ç–Ω–µ—Ä–≥–∏—è–Ω—ã –∫”©–±—ñ–Ω–µ “õ–∞–Ω–¥–∞–π –±—ñ—Ä–ª—ñ–∫–ø–µ–Ω ”©–ª—à–µ–π–¥—ñ?", hint:"–≠–ª–µ–∫—Ç—Ä –µ—Å–µ–ø—Ç–µ–≥—ñ—à", options:["–∫–í—Ç¬∑—Å–∞“ì","–í—Ç","–û–º","–ê–º–ø–µ—Ä"], correct:0,
        tag:"–¢“±—Ä–º—ã—Å—Ç—ã“õ —ç–Ω–µ—Ä–≥–∏—è", explain:"–¢“±—Ä–º—ã—Å—Ç–∞ —ç–Ω–µ—Ä–≥–∏—è –∫–í—Ç¬∑—Å–∞“ì –±—ñ—Ä–ª—ñ–≥—ñ–º–µ–Ω ”©–ª—à–µ–Ω–µ–¥—ñ.",
        aiExplain:"–¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:\n–≠–ª–µ–∫—Ç—Ä –µ—Å–µ–ø—Ç–µ–≥—ñ—à –∫–í—Ç¬∑—Å–∞“ì –∫”©—Ä—Å–µ—Ç–µ–¥—ñ.\n1 –∫–í—Ç¬∑—Å–∞“ì = 3.6√ó10^6 –î–∂." }
    ]
  }
};

// =======================
// UI references
// =======================
const fioEl = document.getElementById("fio");
const klassEl = document.getElementById("klass");
const quizArea = document.getElementById("quizArea");
const reportArea = document.getElementById("reportArea");
const testName = document.getElementById("testName");
const qPos = document.getElementById("qPos");
const qTotal = document.getElementById("qTotal");
const qText = document.getElementById("qText");
const qHint = document.getElementById("qHint");
const opts = document.getElementById("opts");
const checkBtn = document.getElementById("checkBtn");
const nextBtn = document.getElementById("nextBtn");
const afterCheck = document.getElementById("afterCheck");
const isCorrectEl = document.getElementById("isCorrect");
const correctText = document.getElementById("correctText");
const shortExplain = document.getElementById("shortExplain");
const tagOut = document.getElementById("tagOut");
const aiExplainBtn = document.getElementById("aiExplainBtn");
const aiExplainStatus = document.getElementById("aiExplainStatus");
const aiExplainOut = document.getElementById("aiExplainOut");
const summaryText = document.getElementById("summaryText");
const topTags = document.getElementById("topTags");
const recsUl = document.getElementById("recs");

let activeKey = "t1";
let idx = 0;
let score = 0;
let startedAt = null;
let mistakes = {}; // tag -> count
let currentChosenIdx = null;

// Tabs
function setActiveTab(key){
  activeKey = key;
  document.getElementById("tab1").classList.toggle("active", key==="t1");
  document.getElementById("tab2").classList.toggle("active", key==="t2");
  document.getElementById("tab3").classList.toggle("active", key==="t3");
}
document.getElementById("tab1").onclick = ()=>setActiveTab("t1");
document.getElementById("tab2").onclick = ()=>setActiveTab("t2");
document.getElementById("tab3").onclick = ()=>setActiveTab("t3");

document.getElementById("resetBtn").onclick = ()=>{
  if(confirm("–ë–∞—Ä–ª—ã“ì—ã–Ω —Ç–∞–∑–∞–ª–∞–π–º—ã–∑ –±–∞?")) location.reload();
};

document.getElementById("startBtn").onclick = ()=>{
  const fio = fioEl.value.trim();
  const klass = klassEl.value.trim();
  if(!fio || !klass){
    alert("–ê—Ç—ã-–∂”©–Ω—ñ –º–µ–Ω —Å—ã–Ω—ã–ø—Ç—ã —Ç–æ–ª—Ç—ã—Ä.");
    return;
  }
  startTest();
};

document.getElementById("againBtn").onclick = ()=>{
  reportArea.style.display = "none";
  quizArea.style.display = "none";
  window.scrollTo({top:0, behavior:"smooth"});
};

function startTest(){
  idx = 0;
  score = 0;
  mistakes = {};
  startedAt = Date.now();
  quizArea.style.display = "block";
  reportArea.style.display = "none";
  testName.textContent = TESTS[activeKey].title;
  renderQ();
  window.scrollTo({top:0, behavior:"smooth"});
}

function renderQ(){
  const Q = TESTS[activeKey].questions[idx];
  qPos.textContent = String(idx+1);
  qTotal.textContent = String(TESTS[activeKey].questions.length);
  qText.textContent = Q.q;
  qHint.textContent = Q.hint || "";

  opts.innerHTML = "";
  currentChosenIdx = null;

  Q.options.forEach((t, i)=>{
    const label = document.createElement("label");
    label.className = "opt";
    label.innerHTML = `<input type="radio" name="opt" value="${i}"><div><b>${String.fromCharCode(65+i)}.</b> ${t}</div>`;
    opts.appendChild(label);
  });

  // reset view
  afterCheck.style.display = "none";
  checkBtn.style.display = "inline-block";
  nextBtn.style.display = "none";

  // AI always visible (even before check)
  aiExplainBtn.style.display = "inline-block";
  aiExplainStatus.textContent = "";
  aiExplainOut.style.display = "none";
  aiExplainOut.textContent = "";

  aiExplainBtn.onclick = ()=>{
    // offline "AI" explanation from question bank
    aiExplainStatus.textContent = "ü§ñ –ñ–ò-—Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:";
    aiExplainOut.style.display = "block";
    aiExplainOut.textContent = Q.aiExplain || (Q.explain || "–¢“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –∂–æ“õ.");
  };
}

checkBtn.onclick = ()=>{
  const Q = TESTS[activeKey].questions[idx];
  const chosen = document.querySelector('input[name="opt"]:checked');
  if(!chosen){ alert("–ñ–∞—É–∞–ø —Ç–∞“£–¥–∞."); return; }
  currentChosenIdx = Number(chosen.value);

  const ok = currentChosenIdx === Q.correct;
  if(ok) score += 1;
  else mistakes[Q.tag] = (mistakes[Q.tag]||0) + 1;

  afterCheck.style.display = "block";
  isCorrectEl.textContent = ok ? "–î“±—Ä—ã—Å ‚úÖ" : "“ö–∞—Ç–µ ‚ùå";
  isCorrectEl.className = ok ? "ok" : "bad";
  correctText.textContent = `${String.fromCharCode(65+Q.correct)}. ${Q.options[Q.correct]}`;
  shortExplain.textContent = Q.explain || "‚Äî";
  tagOut.textContent = Q.tag || "‚Äî";

  checkBtn.style.display = "none";
  nextBtn.style.display = "inline-block";
};

nextBtn.onclick = ()=>{
  if(idx < TESTS[activeKey].questions.length - 1){
    idx += 1;
    renderQ();
  } else {
    finish();
  }
};

function finish(){
  quizArea.style.display = "none";
  reportArea.style.display = "block";

  const total = TESTS[activeKey].questions.length;
  const percent = Math.round((score/total)*100);
  const timeSec = Math.max(1, Math.round((Date.now()-startedAt)/1000));

  summaryText.innerHTML = `
    <div class="small">
      <b>–û“õ—É—à—ã:</b> ${escapeHtml(fioEl.value.trim())} (${escapeHtml(klassEl.value.trim())})<br>
      <b>–¢–µ—Å—Ç:</b> ${escapeHtml(TESTS[activeKey].title)}<br>
      <b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> ${score}/${total} ‚Ä¢ <b>–ù”ô—Ç–∏–∂–µ:</b> ${percent}% ‚Ä¢ <b>–£–∞“õ—ã—Ç—ã:</b> ~${timeSec} —Å–µ–∫
    </div>
  `;

  // Top-3 tags
  const top = Object.entries(mistakes).sort((a,b)=>b[1]-a[1]).slice(0,3);
  topTags.innerHTML = "";
  if(top.length===0){
    topTags.innerHTML = `<span class="pill good">“ö–∞—Ç–µ –∂–æ“õ üéâ</span>`;
  } else {
    top.forEach(([tag,cnt])=>{
      const span = document.createElement("span");
      span.className = "pill bad";
      span.textContent = `${tag} ‚Äî ${cnt}`;
      topTags.appendChild(span);
    });
  }

  // Recommendations
  const recs = buildRecommendations(top);
  recsUl.innerHTML = "";
  recs.forEach(r=>{
    const li = document.createElement("li");
    li.textContent = r;
    recsUl.appendChild(li);
  });

  window.scrollTo({top:0, behavior:"smooth"});
}

function buildRecommendations(top){
  const map = {
    "–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã": "–û–º –∑–∞“£—ã–Ω—ã“£ 3 —Ç“Ø—Ä—ñ–Ω –∂–∞—Ç—Ç–∞: I=U/R, U=I¬∑R, R=U/I. 5 –µ—Å–µ–ø–ø–µ–Ω –±–µ–∫—ñ—Ç.",
    "–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É": "–ë–µ—Ä—ñ–ª–≥–µ–Ω–¥–µ—Ä–¥—ñ –∂–∞–∑ ‚Üí —Ñ–æ—Ä–º—É–ª–∞–Ω—ã —Ç–∞“£–¥–∞ ‚Üí –æ—Ä–Ω—ã–Ω–∞ “õ–æ–π ‚Üí –±—ñ—Ä–ª—ñ–∫—Ç—ñ —Ç–µ–∫—Å–µ—Ä.",
    "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É": "I, U, R —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä—ã–Ω —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—ñ–ø 5 –º—ã—Å–∞–ª –∂–∞—Å–∞ (–±”©–ª—É/–∫”©–±–µ–π—Ç—É —à–∞—Ç–∞—Å–ø–∞—Å—ã–Ω).",
    "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä": "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä: I‚ÄìA, U‚ÄìV, R‚ÄìŒ©, P‚ÄìW, A‚ÄìJ, —ç–Ω–µ—Ä–≥–∏—è‚Äì–∫–í—Ç¬∑—Å–∞“ì.",
    "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫": "I=U/R —Ç”ô—É–µ–ª–¥—ñ–ª—ñ–≥—ñ–Ω –≥—Ä–∞—Ñ–∏–∫–ø–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä: R –∞—Ä—Ç—Å–∞ I –∫–µ–º–∏–¥—ñ.",
    "–ü–∞—Ä–∞–ª–ª–µ–ª—å –∫–µ–¥–µ—Ä–≥—ñ": "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ 1/R=1/R1+1/R2. –ï“£ –∫—ñ—à—ñ—Å—ñ–Ω–µ–Ω –¥–µ –∫—ñ—à—ñ –±–æ–ª–∞—Ç—ã–Ω—ã–Ω –µ—Å—Ç–µ —Å–∞“õ—Ç–∞.",
    "–¢—ñ–∑–±–µ–∫—Ç–µ–π –∫–µ–¥–µ—Ä–≥—ñ": "–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ R “õ–æ—Å—ã–ª–∞–¥—ã: R=R1+R2. –¢–æ–∫ –±—ñ—Ä–¥–µ–π ”©—Ç–µ–¥—ñ.",
    "–£–∞“õ—ã—Ç—Ç—ã –∞—É—ã—Å—Ç—ã—Ä—É": "–ú–∏–Ω—É—Ç/—Å–∞“ì–∞—Ç—Ç—ã —Å–µ–∫—É–Ω–¥“õ–∞ –∞—É—ã—Å—Ç—ã—Ä: 1–º–∏–Ω=60—Å, 1—Å–∞“ì=3600—Å."
  };

  const out = [];
  top.forEach(([tag])=>{
    if(map[tag]) out.push(map[tag]);
  });

  const base = [
    "–ö“Ø–Ω —Å–∞–π—ã–Ω 5 “õ—ã—Å“õ–∞ –µ—Å–µ–ø —à—ã“ì–∞—Ä—ã–ø, “õ–∞—Ç–µ“£ —à—ã“õ“õ–∞–Ω —Ç–µ–≥—Ç–µ—Ä–¥—ñ “õ–∞–π—Ç–∞ “õ–∞—Ä–∞.",
    "–ñ–∞—É–∞–ø—Ç–∞–Ω –∫–µ–π—ñ–Ω ‚Äú–ñ–ò-–º–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä‚Äù –±–∞—Ç—ã—Ä–º–∞—Å—ã–Ω –±–∞—Å—ã–ø, —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ–Ω—ñ –æ“õ—ã–ø –±–µ–∫—ñ—Ç.",
    "–¢–∞“õ—ã—Ä—ã–ø –±–æ–π—ã–Ω—à–∞ —Ñ–æ—Ä–º—É–ª–∞ –∫–µ—Å—Ç–µ –∂–∞—Å–∞–ø, “õ–∞—Å—ã–Ω–¥–∞ –±—ñ—Ä–ª—ñ–∫ –∂–∞–∑—ã–ø –∂“Ø—Ä."
  ];

  return [...new Set([...out, ...base])].slice(0,6);
}

function escapeHtml(s){
  return String(s||"").replace(/[&<>"']/g, (c)=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[c]));
}
</script>
</body>
</html>
