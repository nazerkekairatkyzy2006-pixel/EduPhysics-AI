<!doctype html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EduPhysics AI ‚Äî –¢“±—Ä–∞“õ—Ç—ã —ç–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;max-width:980px;margin:18px auto;padding:0 14px;line-height:1.35}
    h1{margin:0 0 8px 0}
    .muted{color:#6b7280;font-size:14px}
    .card{border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin:12px 0;background:#fff}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    input,select,button{font-size:16px;padding:10px;border-radius:10px;border:1px solid #d1d5db}
    button{cursor:pointer}
    .tabs{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .tab{padding:10px;border-radius:12px;border:1px solid #d1d5db;background:#f9fafb}
    .tab.active{border-color:#111827;background:#fff;font-weight:700}
    .qbox{border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin-top:12px}
    .opt{display:flex;gap:10px;align-items:flex-start;margin:8px 0;padding:10px;border:1px solid #e5e7eb;border-radius:12px}
    .opt input{margin-top:3px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;font-size:13px;margin:4px 6px 0 0}
    .pill.bad{border-color:#fecaca;background:#fff1f2}
    .pill.good{border-color:#bbf7d0;background:#f0fdf4}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    pre{white-space:pre-wrap;background:#0b1020;color:#e5e7eb;padding:12px;border-radius:12px;overflow:auto}
    .hr{height:1px;background:#e5e7eb;margin:12px 0}
    .small{font-size:13px}
    .ok{color:#059669;font-weight:600}
    .warn{color:#b45309;font-weight:600}
    .bad{color:#b91c1c;font-weight:700}
  </style>
</head>

<body>
  <h1>EduPhysics AI</h1>
  <div class="muted">
    –¢–∞“õ—ã—Ä—ã–ø: <b>–¢“±—Ä–∞“õ—Ç—ã —ç–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã</b>. 3 —Ç–µ—Å—Ç (”ô—Ä“õ–∞–π—Å—ã—Å—ã 10 —Å“±—Ä–∞“õ).  
    ”ò—Ä —Å“±—Ä–∞“õ—Ç–∞–Ω –∫–µ–π—ñ–Ω <b>‚Äú–ñ–ò-–º–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä‚Äù</b> –±–∞—Ç—ã—Ä–º–∞—Å—ã —à—ã“ì—ã–ø, Perplexity-–≥–µ –∞–≤—Ç–æ–º–∞—Ç —Å“±—Ä–∞—É –∂—ñ–±–µ—Ä–µ–¥—ñ.
  </div>

  <!-- –û“õ—É—à—ã -->
  <div class="card">
    <h2 style="margin:0 0 10px 0;">–û“õ—É—à—ã</h2>
    <div class="row">
      <input id="fio" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ" />
      <input id="klass" placeholder="–°—ã–Ω—ã–ø (–º—ã—Å–∞–ª—ã: 10A)" />
    </div>
    <div class="muted small" style="margin-top:8px;">–ï—Å–∫–µ—Ä—Ç—É: –ë“±–ª –Ω“±—Å“õ–∞ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Å–µ—Ä–≤–µ—Ä–¥–µ —Å–∞“õ—Ç–∞–º–∞–π–¥—ã, —Ç–µ–∫ —ç–∫—Ä–∞–Ω–¥–∞ –∞–Ω–∞–ª–∏–∑ —à—ã“ì–∞—Ä–∞–¥—ã.</div>
  </div>

  <!-- –¢–µ—Å—Ç–µ—Ä -->
  <div class="card">
    <h2 style="margin:0 0 10px 0;">–¢–µ—Å—Ç–µ—Ä</h2>
    <div class="tabs">
      <button class="tab active" id="tab1">–¢–µ—Å—Ç 1: –û–º –∑–∞“£—ã</button>
      <button class="tab" id="tab2">–¢–µ—Å—Ç 2: “ö–æ—Å—ã–ª—É–ª–∞—Ä</button>
      <button class="tab" id="tab3">–¢–µ—Å—Ç 3: “ö—É–∞—Ç/–∂“±–º—ã—Å</button>
    </div>
    <div class="muted small" style="margin-top:8px;">
      –¢–∞“£–¥–∞ –¥–∞, <b>‚Äú–ë–∞—Å—Ç–∞—É‚Äù</b> –±–∞—Å. –°“±—Ä–∞“õ—Ç–∞—Ä –∫–µ–∑–µ–∫–ø–µ–Ω —à—ã“ì–∞–¥—ã.
    </div>

    <div class="actions">
      <button id="startBtn">–ë–∞—Å—Ç–∞—É</button>
      <button id="resetBtn">–ë”ô—Ä—ñ–Ω —Ç–∞–∑–∞–ª–∞—É</button>
    </div>
  </div>

  <!-- –°“±—Ä–∞“õ –∞–π–º–∞“ì—ã -->
  <div class="card" id="quizArea" style="display:none;">
    <div class="muted small">–ê“ì—ã–º–¥–∞“ì—ã —Ç–µ—Å—Ç: <b id="testName"></b> ‚Ä¢ –°“±—Ä–∞“õ: <b id="qPos"></b>/<b id="qTotal"></b></div>
    <div class="qbox">
      <div style="font-size:18px;font-weight:700" id="qText"></div>
      <div class="muted small" id="qHint" style="margin-top:6px;"></div>

      <div id="opts"></div>

      <div class="actions">
        <button id="checkBtn">–¢–µ–∫—Å–µ—Ä—É</button>
        <button id="nextBtn" style="display:none;">–ö–µ–ª–µ—Å—ñ</button>
      </div>

      <div class="hr"></div>

      <div id="afterCheck" style="display:none;">
        <div>–ù”ô—Ç–∏–∂–µ: <span id="isCorrect"></span></div>
        <div class="muted small" style="margin-top:6px;"><b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> <span id="correctText"></span></div>

        <div class="muted small" style="margin-top:10px;"><b>“ö—ã—Å“õ–∞ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:</b></div>
        <div id="shortExplain" class="small"></div>

        <div class="muted small" style="margin-top:10px;"><b>“ö–∞—Ç–µ —Ç–µ–≥ (misconception):</b> <span id="tagOut"></span></div>

        <!-- AI explanation per question -->
        <button id="aiExplainBtn" style="margin-top:10px; display:none;">–ñ–ò-–º–µ–Ω —Ç–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä</button>
        <div id="aiExplainStatus" class="muted small" style="margin-top:8px;"></div>
        <pre id="aiExplainOut" style="display:none; margin-top:8px;"></pre>
      </div>
    </div>
  </div>

  <!-- –ú“±“ì–∞–ª—ñ–º–≥–µ –∞–Ω–∞–ª–∏–∑ -->
  <div class="card" id="reportArea" style="display:none;">
    <h2 style="margin:0 0 8px 0;">–ú“±“ì–∞–ª—ñ–º–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω –∞–Ω–∞–ª–∏–∑</h2>
    <div class="muted small">“ö—ã—Å“õ–∞—à–∞ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã: “±–ø–∞–π, ”ô–ª—Å—ñ–∑ —Ç–∞“õ—ã—Ä—ã–ø, “õ–∞—Ç–µ —Ç“Ø—Ä–ª–µ—Ä—ñ –∂”ô–Ω–µ “±—Å—ã–Ω—ã—Å—Ç–∞—Ä.</div>

    <div class="qbox" style="margin-top:10px;">
      <div id="summaryText" class="small"></div>

      <h3 style="margin:14px 0 6px 0;">–¢–æ–ø-3 “õ–∞—Ç–µ —Ç“Ø—Ä—ñ (tags)</h3>
      <div id="topTags"></div>

      <h3 style="margin:14px 0 6px 0;">“∞—Å—ã–Ω—ã—Å—Ç–∞—Ä</h3>
      <ul id="recs" class="small"></ul>

      <div class="actions">
        <button id="againBtn">–¢–∞“ì—ã —Ç–µ—Å—Ç —Ç–∞–ø—Å—ã—Ä—É</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   –í–æ–ø—Ä–æ—Å—ã (3 —Ç–µ—Å—Ç–∞ √ó 10)
   ========================= */
const TESTS = {
  t1: {
    title: "–¢–µ—Å—Ç 1: –û–º –∑–∞“£—ã –∂”ô–Ω–µ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
    questions: [
      {
        q: "–û–º –∑–∞“£—ã–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞—Å—ã “õ–∞–π—Å—ã?",
        hint: "I, U, R –±–∞–π–ª–∞–Ω—ã—Å—ã",
        options: ["I = U / R", "I = R / U", "U = I / R", "R = U ¬∑ I"],
        correct: 0,
        tag: "–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
        explain: "–û–º –∑–∞“£—ã: —Ç–æ–∫ –∫“Ø—à—ñ –∫–µ—Ä–Ω–µ—É–≥–µ —Ç—É—Ä–∞, –∫–µ–¥–µ—Ä–≥—ñ–≥–µ –∫–µ—Ä—ñ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª: I = U/R."
      },
      {
        q: "–ö–µ–¥–µ—Ä–≥—ñ–Ω—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
        hint: "R “õ–∞–Ω–¥–∞–π –±—ñ—Ä–ª—ñ–∫–ø–µ–Ω ”©–ª—à–µ–Ω–µ–¥—ñ?",
        options: ["–û–º (Œ©)", "–í–æ–ª—å—Ç (V)", "–ê–º–ø–µ—Ä (A)", "–í–∞—Ç—Ç (W)"],
        correct: 0,
        tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
        explain: "–ö–µ–¥–µ—Ä–≥—ñ R ‚Äî –û–º (Œ©) –±—ñ—Ä–ª—ñ–≥—ñ–º–µ–Ω ”©–ª—à–µ–Ω–µ–¥—ñ."
      },
      {
        q: "–ï–≥–µ—Ä U = 12 –í, R = 3 Œ© –±–æ–ª—Å–∞, —Ç–æ–∫ –∫“Ø—à—ñ I –Ω–µ–≥–µ —Ç–µ“£?",
        hint: "I = U/R",
        options: ["4 A", "36 A", "0.25 A", "9 A"],
        correct: 0,
        tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É",
        explain: "I = 12/3 = 4 A."
      },
      {
        q: "–ö–µ—Ä–Ω–µ—É–¥—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
        hint: "U",
        options: ["–í–æ–ª—å—Ç (V)", "–û–º (Œ©)", "–ê–º–ø–µ—Ä (A)", "–ö—É–ª–æ–Ω (C)"],
        correct: 0,
        tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
        explain: "–ö–µ—Ä–Ω–µ—É U ‚Äî –í–æ–ª—å—Ç (V)."
      },
      {
        q: "–¢–æ–∫ –∫“Ø—à—ñ “õ–∞–Ω–¥–∞–π ”ô—Ä—ñ–ø–ø–µ–Ω –±–µ–ª–≥—ñ–ª–µ–Ω–µ–¥—ñ?",
        hint: "Electric current",
        options: ["I", "U", "R", "P"],
        correct: 0,
        tag: "–ë–µ–ª–≥—ñ–ª–µ—É–ª–µ—Ä",
        explain: "–¢–æ–∫ –∫“Ø—à—ñ ‚Äî I ”ô—Ä–ø—ñ–º–µ–Ω –±–µ–ª–≥—ñ–ª–µ–Ω–µ–¥—ñ."
      },
      {
        q: "R = U / I —Ñ–æ—Ä–º—É–ª–∞—Å—ã –Ω–µ–Ω—ñ —Ç–∞–±—É“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω?",
        hint: "“ö–∞–π —à–∞–º–∞?",
        options: ["–ö–µ–¥–µ—Ä–≥—ñ", "–ö–µ—Ä–Ω–µ—É", "–¢–æ–∫ –∫“Ø—à—ñ", "“ö—É–∞—Ç"],
        correct: 0,
        tag: "–§–æ—Ä–º—É–ª–∞ –º–∞“ì—ã–Ω–∞—Å—ã",
        explain: "R = U/I ‚Äî –∫–µ–¥–µ—Ä–≥—ñ–Ω—ñ —Ç–∞–±—É —Ñ–æ—Ä–º—É–ª–∞—Å—ã."
      },
      {
        q: "–ï–≥–µ—Ä I –∞—Ä—Ç—Å–∞, U —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, R “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ? (R = U/I)",
        hint: "–ö–µ—Ä—ñ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è",
        options: ["–ê–∑–∞—è–¥—ã", "–ê—Ä—Ç–∞–¥—ã", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ", "–ê–ª–¥—ã–º–µ–Ω –∞—Ä—Ç—ã–ø, –∫–µ–π—ñ–Ω –∞–∑–∞—è–¥—ã"],
        correct: 0,
        tag: "–ü—Ä–æ–ø–æ—Ä—Ü–∏—è–Ω—ã —Ç“Ø—Å—ñ–Ω—É",
        explain: "R = U/I, I –∞—Ä—Ç—Å–∞ ‚Äî R –∞–∑–∞—è–¥—ã."
      },
      {
        q: "U = I¬∑R —Ñ–æ—Ä–º—É–ª–∞—Å—ã–Ω–¥–∞ U –Ω–µ–≥–µ —Ç”ô—É–µ–ª–¥—ñ?",
        hint: "–¢—É—Ä–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è",
        options: ["I –º–µ–Ω R-–≥–µ —Ç—É—Ä–∞", "I-–≥–µ –∫–µ—Ä—ñ", "R-–≥–µ –∫–µ—Ä—ñ", "–ï—à–Ω”ô—Ä—Å–µ–≥–µ —Ç”ô—É–µ–ª–¥—ñ –µ–º–µ—Å"],
        correct: 0,
        tag: "–ü—Ä–æ–ø–æ—Ä—Ü–∏—è–Ω—ã —Ç“Ø—Å—ñ–Ω—É",
        explain: "U = I¬∑R ‚Üí I –∞—Ä—Ç—Å–∞ U –∞—Ä—Ç–∞–¥—ã; R –∞—Ä—Ç—Å–∞ U –∞—Ä—Ç–∞–¥—ã."
      },
      {
        q: "–ï–≥–µ—Ä R=6 Œ© –∂”ô–Ω–µ I=2 A –±–æ–ª—Å–∞, U “õ–∞–Ω—à–∞?",
        hint: "U = I¬∑R",
        options: ["12 V", "3 V", "8 V", "4 V"],
        correct: 0,
        tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É",
        explain: "U = 2¬∑6 = 12 V."
      },
      {
        q: "“ö–∞–π—Å—ã—Å—ã –¥“±—Ä—ã—Å —Ç–µ“£–¥—ñ–∫?",
        hint: "–û–º –∑–∞“£—ã",
        options: ["U = I¬∑R", "I = U¬∑R", "R = I/U", "U = R/I"],
        correct: 0,
        tag: "–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
        explain: "–î“±—Ä—ã—Å—ã: U = I¬∑R."
      }
    ]
  },

  t2: {
    title: "–¢–µ—Å—Ç 2: –¢—ñ–∑–±–µ–∫—Ç–µ–π –∂”ô–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É",
    questions: [
      {
        q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞ —Ç–æ–∫ –∫“Ø—à—ñ “õ–∞–ª–∞–π –±–æ–ª–∞–¥—ã?",
        hint: "I –±–∞—Ä–ª—ã“õ —ç–ª–µ–º–µ–Ω—Ç—Ç–µ –±—ñ—Ä–¥–µ–π –º–µ?",
        options: ["–ë–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π", "”ò—Ä –∂–µ—Ä–¥–µ ”ô—Ä—Ç“Ø—Ä–ª—ñ", "–ù”©–ª –±–æ–ª–∞–¥—ã", "–ö–µ—Ä–Ω–µ—É–≥–µ —Ç–µ“£ –±–æ–ª–∞–¥—ã"],
        correct: 0,
        tag: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É",
        explain: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞ I –±–∞—Ä–ª—ã“õ –±”©–ª—ñ–∫—Ç–µ –±—ñ—Ä–¥–µ–π."
      },
      {
        q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞“ì—ã —Ç–æ–ª—ã“õ –∫–µ–¥–µ—Ä–≥—ñ:",
        hint: "“ö–æ—Å—ã–Ω–¥—ã",
        options: ["R = R1 + R2 + ...", "1/R = 1/R1 + 1/R2", "R = R1¬∑R2", "R = R1/R2"],
        correct: 0,
        tag: "–¢—ñ–∑–±–µ–∫—Ç–µ–π –∫–µ–¥–µ—Ä–≥—ñ",
        explain: "–¢—ñ–∑–±–µ–∫—Ç–µ–π: R_–∂–∞–ª–ø—ã = R1+R2+..."
      },
      {
        q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞ –∫–µ—Ä–Ω–µ—É “õ–∞–ª–∞–π –±–æ–ª–∞–¥—ã?",
        hint: "U –±–∞—Ä–ª—ã“õ —Ç–∞—Ä–º–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–π –º–µ?",
        options: ["–ë–∞—Ä–ª—ã“õ —Ç–∞—Ä–º–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–π", "”ò—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ ”ô—Ä—Ç“Ø—Ä–ª—ñ", "–ù”©–ª –±–æ–ª–∞–¥—ã", "–¢–æ–∫“õ–∞ —Ç–µ“£ –±–æ–ª–∞–¥—ã"],
        correct: 0,
        tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É",
        explain: "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ U –±–∞—Ä–ª—ã“õ —Ç–∞—Ä–º–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–π."
      },
      {
        q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª“ì–∞–Ω–¥–∞“ì—ã —Ç–æ–ª—ã“õ –∫–µ–¥–µ—Ä–≥—ñ —Ñ–æ—Ä–º—É–ª–∞—Å—ã:",
        hint: "–ö–µ—Ä—ñ “õ–æ—Å—ã–Ω–¥—ã",
        options: ["1/R = 1/R1 + 1/R2 + ...", "R = R1 + R2", "R = R1¬∑R2", "R = R1/R2"],
        correct: 0,
        tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å –∫–µ–¥–µ—Ä–≥—ñ",
        explain: "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ: 1/R_–∂–∞–ª–ø—ã = 1/R1 + 1/R2 + ..."
      },
      {
        q: "–ù–µ–≥–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ –∂–∞–ª–ø—ã –∫–µ–¥–µ—Ä–≥—ñ –∞–∑–∞—è–¥—ã?",
        hint: "–¢–æ–∫ –∂“Ø—Ä–µ—Ç—ñ–Ω –∂–æ–ª —Å–∞–Ω—ã",
        options: ["–¢–æ–∫“õ–∞ –±—ñ—Ä–Ω–µ—à–µ –∂–æ–ª –∞—à—ã–ª–∞–¥—ã", "–ö–µ—Ä–Ω–µ—É –∞–∑–∞—è–¥—ã", "–¢–æ–∫ –º—ñ–Ω–¥–µ—Ç—Ç—ñ —Ç“Ø—Ä–¥–µ –∞–∑–∞—è–¥—ã", "“ö—É–∞—Ç –Ω”©–ª–≥–µ —Ç–µ“£ –±–æ–ª–∞–¥—ã"],
        correct: 0,
        tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å –ª–æ–≥–∏–∫–∞",
        explain: "–ü–∞—Ä–∞–ª–ª–µ–ª—å —Ç–∞—Ä–º–∞“õ –∫”©–±–µ–π—Å–µ, —Ç–æ–∫“õ–∞ –∂–æ–ª –∫”©–±–µ–π—ñ–ø, R_–∂–∞–ª–ø—ã –∞–∑–∞—è–¥—ã."
      },
      {
        q: "R1=6Œ©, R2=3Œ© –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—Å–∞, R–∂–∞–ª–ø—ã?",
        hint: "1/R=1/6+1/3",
        options: ["2 Œ©", "9 Œ©", "3 Œ©", "4 Œ©"],
        correct: 0,
        tag: "–ï—Å–µ–ø (–ø–∞—Ä–∞–ª–ª–µ–ª—å)",
        explain: "1/R=1/6+1/3=1/6+2/6=3/6=1/2 ‚Üí R=2Œ©."
      },
      {
        q: "R1=2Œ©, R2=5Œ© —Ç—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—Å–∞, R–∂–∞–ª–ø—ã?",
        hint: "“ö–æ—Å—ã–Ω–¥—ã",
        options: ["7 Œ©", "10 Œ©", "3 Œ©", "2.5 Œ©"],
        correct: 0,
        tag: "–ï—Å–µ–ø (—Ç—ñ–∑–±–µ–∫—Ç–µ–π)",
        explain: "R=2+5=7Œ©."
      },
      {
        q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ —Ç–æ–∫ –∫“Ø—à—ñ “õ–∞–ª–∞–π –±”©–ª—ñ–Ω–µ–¥—ñ?",
        hint: "–¢–∞—Ä–º–∞“õ—Ç–∞—Ä“ì–∞ –±”©–ª—ñ–Ω–µ–¥—ñ",
        options: ["–¢–∞—Ä–º–∞“õ—Ç–∞—Ä“ì–∞ –±”©–ª—ñ–Ω–µ–¥—ñ, I–∂–∞–ª–ø—ã = I1 + I2", "–ë–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π", "–ù”©–ª –±–æ–ª–∞–¥—ã", "–ö–µ—Ä–Ω–µ—É–≥–µ —Ç–µ“£ –±–æ–ª–∞–¥—ã"],
        correct: 0,
        tag: "–¢–æ–∫ –±”©–ª—ñ–Ω—É—ñ",
        explain: "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ —Ç–æ–∫ –±”©–ª—ñ–Ω–µ–¥—ñ: I = I1 + I2 + ..."
      },
      {
        q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å“õ–∞–Ω–¥–∞ –∫–µ—Ä–Ω–µ—É “õ–∞–ª–∞–π –±”©–ª—ñ–Ω–µ–¥—ñ?",
        hint: "U–∂–∞–ª–ø—ã = U1+U2",
        options: ["–ë”©–ª—ñ–∫—Ç–µ—Ä–≥–µ –±”©–ª—ñ–Ω–µ–¥—ñ: U = U1 + U2", "–ë–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π", "–ù”©–ª –±–æ–ª–∞–¥—ã", "–¢–µ–∫ –±—ñ—Ä —Ä–µ–∑–∏—Å—Ç–æ—Ä–¥–∞ –±–æ–ª–∞–¥—ã"],
        correct: 0,
        tag: "–ö–µ—Ä–Ω–µ—É –±”©–ª—ñ–Ω—É—ñ",
        explain: "–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ –∫–µ—Ä–Ω–µ—É –±”©–ª—ñ–Ω–µ–¥—ñ: U–∂–∞–ª–ø—ã = U1 + U2 + ..."
      },
      {
        q: "“ö–∞–π “õ–æ—Å—ã–ª—É —Ç“Ø—Ä—ñ “Ø–π–¥–µ–≥—ñ —Ä–æ–∑–µ—Ç–∫–∞–ª–∞—Ä–¥–∞ “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã?",
        hint: "–ë–∞—Ä–ª—ã“õ “õ“±—Ä–∞–ª–¥–∞ U –±—ñ—Ä–¥–µ–π –±–æ–ª—Å—ã–Ω",
        options: ["–ü–∞—Ä–∞–ª–ª–µ–ª—å", "–¢—ñ–∑–±–µ–∫—Ç–µ–π", "–ê—Ä–∞–ª–∞—Å –µ–º–µ—Å", "–ï—à“õ–∞–π—Å—ã"],
        correct: 0,
        tag: "”®–º—ñ—Ä–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å",
        explain: "“Æ–π –∂–µ–ª—ñ—Å—ñ ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å: ”ô—Ä “õ“±—Ä—ã–ª“ì—ã“ì–∞ –±—ñ—Ä–¥–µ–π –∫–µ—Ä–Ω–µ—É –±–µ—Ä—ñ–ª–µ–¥—ñ."
      }
    ]
  },

  t3: {
    title: "–¢–µ—Å—Ç 3: “ö—É–∞—Ç, –∂“±–º—ã—Å, —ç–Ω–µ—Ä–≥–∏—è",
    questions: [
      {
        q: "–≠–ª–µ–∫—Ç—Ä “õ—É–∞—Ç—ã–Ω—ã“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã (–Ω–µ–≥—ñ–∑–≥—ñ)?",
        hint: "P, U, I",
        options: ["P = U¬∑I", "P = U/I", "P = I/R", "P = U¬∑R"],
        correct: 0,
        tag: "“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
        explain: "“ö—É–∞—Ç: P = U¬∑I."
      },
      {
        q: "“ö—É–∞—Ç—Ç—ã“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
        hint: "P",
        options: ["–í–∞—Ç—Ç (W)", "–î–∂–æ—É–ª—å (J)", "–û–º (Œ©)", "–ê–º–ø–µ—Ä (A)"],
        correct: 0,
        tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
        explain: "“ö—É–∞—Ç P ‚Äî –í–∞—Ç—Ç (W)."
      },
      {
        q: "–≠–ª–µ–∫—Ç—Ä —ç–Ω–µ—Ä–≥–∏—è—Å—ã–Ω—ã“£ (–∂“±–º—ã—Å—Ç—ã“£) —Ñ–æ—Ä–º—É–ª–∞—Å—ã:",
        hint: "A, P, t",
        options: ["A = P¬∑t", "A = P/t", "A = U/I", "A = I/R"],
        correct: 0,
        tag: "–≠–Ω–µ—Ä–≥–∏—è —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
        explain: "–≠–Ω–µ—Ä–≥–∏—è (–∂“±–º—ã—Å): A = P¬∑t."
      },
      {
        q: "–ï–≥–µ—Ä P = 60 W, t = 10 s –±–æ–ª—Å–∞, A?",
        hint: "A=P¬∑t",
        options: ["600 J", "6 J", "50 J", "70 J"],
        correct: 0,
        tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É",
        explain: "A = 60¬∑10 = 600 –î–∂."
      },
      {
        q: "P = I¬≤R —Ñ–æ—Ä–º—É–ª–∞—Å—ã “õ–∞—à–∞–Ω —ã“£“ì–∞–π–ª—ã?",
        hint: "I –º–µ–Ω R –±–µ–ª–≥—ñ–ª—ñ –±–æ–ª—Å–∞",
        options: ["I –∂”ô–Ω–µ R –±–µ–ª–≥—ñ–ª—ñ –±–æ–ª“ì–∞–Ω–¥–∞", "–¢–µ–∫ U –±–µ–ª–≥—ñ–ª—ñ –±–æ–ª—Å–∞", "–¢–µ–∫ t –±–µ–ª–≥—ñ–ª—ñ –±–æ–ª—Å–∞", "–ï—à“õ–∞—à–∞–Ω"],
        correct: 0,
        tag: "–§–æ—Ä–º—É–ª–∞ —Ç–∞“£–¥–∞—É",
        explain: "P=I¬≤R ‚Äî I –º–µ–Ω R –∞—Ä“õ—ã–ª—ã “õ—É–∞—Ç—Ç—ã —Ç–∞–±—É“ì–∞ —ã“£“ì–∞–π–ª—ã."
      },
      {
        q: "U=12V, I=2A ‚Üí P?",
        hint: "P=U¬∑I",
        options: ["24 W", "6 W", "10 W", "14 W"],
        correct: 0,
        tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É",
        explain: "P=12¬∑2=24 W."
      },
      {
        q: "–≠–Ω–µ—Ä–≥–∏—è–Ω—ã —Ç“±—Ä–º—ã—Å—Ç–∞ –∫”©–±—ñ–Ω–µ “õ–∞–Ω–¥–∞–π –±—ñ—Ä–ª—ñ–∫–ø–µ–Ω –µ—Å–µ–ø—Ç–µ–π–¥—ñ?",
        hint: "–≠–ª–µ–∫—Ç—Ä –µ—Å–µ–ø—Ç–µ–≥—ñ—à",
        options: ["–∫–í—Ç¬∑—Å–∞“ì", "–î–∂–æ—É–ª—å", "–û–º", "–ê–º–ø–µ—Ä"],
        correct: 0,
        tag: "–¢“±—Ä–º—ã—Å—Ç—ã“õ ”©–ª—à–µ–º",
        explain: "–¢“±—Ä–º—ã—Å—Ç–∞ —ç–Ω–µ—Ä–≥–∏—è: –∫–í—Ç¬∑—Å–∞“ì."
      },
      {
        q: "P=100 W “õ“±—Ä—ã–ª“ì—ã 2 —Å–∞“ì–∞—Ç –∂“±–º—ã—Å —ñ—Å—Ç–µ–¥—ñ. –≠–Ω–µ—Ä–≥–∏—è (–∫–í—Ç¬∑—Å–∞“ì)?",
        hint: "100W=0.1kW",
        options: ["0.2 –∫–í—Ç¬∑—Å–∞“ì", "200 –∫–í—Ç¬∑—Å–∞“ì", "2 –∫–í—Ç¬∑—Å–∞“ì", "0.02 –∫–í—Ç¬∑—Å–∞“ì"],
        correct: 0,
        tag: "–ï—Å–µ–ø (–∫–í—Ç¬∑—Å–∞“ì)",
        explain: "0.1 –∫–í—Ç √ó 2 —Å–∞“ì = 0.2 –∫–í—Ç¬∑—Å–∞“ì."
      },
      {
        q: "“ö—É–∞—Ç –∞—Ä—Ç—Å–∞ (U —Ç“±—Ä–∞“õ—Ç—ã), I “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ? (P=U¬∑I)",
        hint: "–¢—É—Ä–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è",
        options: ["I –∞—Ä—Ç–∞–¥—ã", "I –∞–∑–∞—è–¥—ã", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ", "–ù”©–ª –±–æ–ª–∞–¥—ã"],
        correct: 0,
        tag: "–ü—Ä–æ–ø–æ—Ä—Ü–∏—è–Ω—ã —Ç“Ø—Å—ñ–Ω—É",
        explain: "P=U¬∑I ‚Üí U —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, P –∞—Ä—Ç—Å–∞ I –∞—Ä—Ç–∞–¥—ã."
      },
      {
        q: "–≠–Ω–µ—Ä–≥–∏—è–Ω—ã –∞–∑–∞–π—Ç—É “Ø—à—ñ–Ω –µ“£ –¥“±—Ä—ã—Å —Ç”ô—Å—ñ–ª:",
        hint: "A=P¬∑t",
        options: ["“ö—É–∞—Ç—Ç—ã –∞–∑–∞–π—Ç—É –Ω–µ–º–µ—Å–µ —É–∞“õ—ã—Ç—Ç—ã “õ—ã—Å“õ–∞—Ä—Ç—É", "–ö–µ—Ä–Ω–µ—É–¥—ñ –º—ñ–Ω–¥–µ—Ç—Ç—ñ –∞–∑–∞–π—Ç—É", "–ö–µ–¥–µ—Ä–≥—ñ–Ω—ñ –º—ñ–Ω–¥–µ—Ç—Ç—ñ –∞–∑–∞–π—Ç—É", "–¢–æ–∫—Ç—ã –º—ñ–Ω–¥–µ—Ç—Ç—ñ –∞—Ä—Ç—Ç—ã—Ä—É"],
        correct: 0,
        tag: "–¢“Ø—Å—ñ–Ω—ñ–∫",
        explain: "A=P¬∑t: —ç–Ω–µ—Ä–≥–∏—è–Ω—ã –∞–∑–∞–π—Ç—É “Ø—à—ñ–Ω P –∞–∑–∞–π—Å—ã–Ω –Ω–µ–º–µ—Å–µ t “õ—ã—Å“õ–∞—Ä—Å—ã–Ω."
      }
    ]
  }
};

/* =========================
   –°–æ—Å—Ç–æ—è–Ω–∏–µ
   ========================= */
let activeKey = "t1";
let qIndex = 0;
let startedAt = null;

// –ø—Ä–æ–≥—Ä–µ—Å—Å –∂–∏–Ω–∞—É
const progress = {
  fio: "",
  klass: "",
  testKey: "",
  answers: [], // {q, chosenIdx, correctIdx, isCorrect, tag, msSpent}
  score: 0
};

function $(id){ return document.getElementById(id); }

function setActiveTab(key){
  activeKey = key;
  ["tab1","tab2","tab3"].forEach((t,i)=>{
    const k = ["t1","t2","t3"][i];
    $(t).classList.toggle("active", k===key);
  });
}

$("tab1").onclick = ()=>setActiveTab("t1");
$("tab2").onclick = ()=>setActiveTab("t2");
$("tab3").onclick = ()=>setActiveTab("t3");

$("resetBtn").onclick = ()=>{
  if(!confirm("–ë–∞—Ä–ª—ã“ì—ã–Ω —Ç–∞–∑–∞–ª–∞–π–º—ã–∑ –±–∞?")) return;
  location.reload();
};

$("startBtn").onclick = ()=>{
  const fio = $("fio").value.trim();
  const klass = $("klass").value.trim();
  if(!fio || !klass){
    alert("–ê—Ç—ã-–∂”©–Ω—ñ –º–µ–Ω —Å—ã–Ω—ã–ø—Ç—ã —Ç–æ–ª—Ç—ã—Ä.");
    return;
  }
  progress.fio = fio;
  progress.klass = klass;
  startTest();
};

function startTest(){
  progress.testKey = activeKey;
  progress.answers = [];
  progress.score = 0;
  qIndex = 0;
  startedAt = Date.now();

  $("reportArea").style.display = "none";
  $("quizArea").style.display = "block";
  $("testName").textContent = TESTS[activeKey].title;

  renderQuestion();
}

function renderQuestion(){
  const T = TESTS[activeKey];
  const item = T.questions[qIndex];

  $("qPos").textContent = (qIndex+1);
  $("qTotal").textContent = T.questions.length;

  $("qText").textContent = item.q;
  $("qHint").textContent = item.hint || "";

  $("opts").innerHTML = "";
  item.options.forEach((txt, idx)=>{
    const div = document.createElement("label");
    div.className = "opt";
    div.innerHTML = `
      <input type="radio" name="opt" value="${idx}">
      <div><b>${String.fromCharCode(65+idx)}.</b> ${txt}</div>
    `;
    $("opts").appendChild(div);
  });

  // reset after-check panel
  $("afterCheck").style.display = "none";
  $("checkBtn").style.display = "inline-block";
  $("nextBtn").style.display = "none";

  // reset AI explain widgets
  $("aiExplainBtn").style.display = "none";
  $("aiExplainStatus").textContent = "";
  $("aiExplainOut").style.display = "none";
  $("aiExplainOut").textContent = "";
}

$("checkBtn").onclick = async ()=>{
  const T = TESTS[activeKey];
  const item = T.questions[qIndex];

  const chosen = document.querySelector('input[name="opt"]:checked');
  if(!chosen){
    alert("–ñ–∞—É–∞–ø —Ç–∞“£–¥–∞.");
    return;
  }
  const chosenIdx = Number(chosen.value);
  const correctIdx = item.correct;
  const isCorrect = chosenIdx === correctIdx;

  // time per question (rough)
  const msSpent = 0; // “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞ –∫–µ–π—ñ–Ω “õ–æ—Å–∞–º—ã–∑

  progress.answers.push({
    q: item.q,
    chosenIdx,
    correctIdx,
    isCorrect,
    tag: item.tag || "–ë–∞—Å“õ–∞",
    explain: item.explain || "",
    options: item.options
  });
  if(isCorrect) progress.score += 1;

  $("afterCheck").style.display = "block";
  $("isCorrect").textContent = isCorrect ? "–î“±—Ä—ã—Å ‚úÖ" : "“ö–∞—Ç–µ ‚ùå";
  $("isCorrect").className = isCorrect ? "ok" : "bad";

  $("correctText").textContent = `${String.fromCharCode(65+correctIdx)}. ${item.options[correctIdx]}`;
  $("shortExplain").textContent = item.explain || "‚Äî";
  $("tagOut").textContent = item.tag ? item.tag : "‚Äî";

  $("checkBtn").style.display = "none";
  $("nextBtn").style.display = "inline-block";

  // AI button always available (even if correct ‚Äî for deeper explanation)
  $("aiExplainBtn").style.display = "inline-block";
  $("aiExplainBtn").onclick = ()=>askAIExplain(item, chosenIdx, correctIdx);
};

$("nextBtn").onclick = ()=>{
  const T = TESTS[activeKey];
  if(qIndex < T.questions.length - 1){
    qIndex += 1;
    renderQuestion();
  } else {
    finishTest();
  }
};

$("againBtn").onclick = ()=>{
  $("quizArea").style.display = "none";
  $("reportArea").style.display = "none";
  window.scrollTo({top:0, behavior:"smooth"});
};

function finishTest(){
  $("quizArea").style.display = "none";
  $("reportArea").style.display = "block";

  const total = TESTS[activeKey].questions.length;
  const percent = Math.round((progress.score/total)*100);

  const timeSec = Math.max(1, Math.round((Date.now() - startedAt)/1000));

  // tag counts for mistakes
  const tagCount = {};
  let wrong = 0;
  progress.answers.forEach(a=>{
    if(!a.isCorrect){
      wrong += 1;
      tagCount[a.tag] = (tagCount[a.tag] || 0) + 1;
    }
  });

  // top tags
  const top = Object.entries(tagCount).sort((a,b)=>b[1]-a[1]).slice(0,3);

  // summary text
  $("summaryText").innerHTML = `
    <div class="small">
      <b>–û“õ—É—à—ã:</b> ${escapeHtml(progress.fio)} (${escapeHtml(progress.klass)})<br>
      <b>–¢–µ—Å—Ç:</b> ${escapeHtml(TESTS[activeKey].title)}<br>
      <b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> ${progress.score}/${total} ‚Ä¢ <b>–ù”ô—Ç–∏–∂–µ:</b> ${percent}%<br>
      <b>“ö–∞—Ç–µ —Å–∞–Ω—ã:</b> ${wrong} ‚Ä¢ <b>–£–∞“õ—ã—Ç—ã:</b> —à–∞–º–∞–º–µ–Ω ${timeSec} —Å–µ–∫
    </div>
  `;

  // top tags render
  $("topTags").innerHTML = "";
  if(top.length === 0){
    $("topTags").innerHTML = `<span class="pill good">“ö–∞—Ç–µ –∂–æ“õ üéâ</span>`;
  } else {
    top.forEach(([tag,cnt])=>{
      const span = document.createElement("span");
      span.className = "pill bad";
      span.textContent = `${tag} ‚Äî ${cnt}`;
      $("topTags").appendChild(span);
    });
  }

  // recommendations
  const recs = buildRecommendations(top);
  $("recs").innerHTML = "";
  recs.forEach(r=>{
    const li = document.createElement("li");
    li.textContent = r;
    $("recs").appendChild(li);
  });

  window.scrollTo({top:0, behavior:"smooth"});
}

function buildRecommendations(top){
  // —É–Ω–∏–≤–µ—Ä—Å–∞–ª “õ—ã—Å“õ–∞ “±—Å—ã–Ω—ã—Å—Ç–∞—Ä
  const base = [
    "–û–º –∑–∞“£—ã–Ω 3 —Ç“Ø—Ä–¥–µ –∂–∞—Ç—Ç–∞: I=U/R, U=I¬∑R, R=U/I.",
    "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä–¥—ñ –∫–µ—Å—Ç–µ “õ—ã–ª—ã–ø –∂–∞–∑: I‚ÄìA, U‚ÄìV, R‚ÄìŒ©, P‚ÄìW, A‚ÄìJ, —ç–Ω–µ—Ä–≥–∏—è‚Äì–∫–í—Ç¬∑—Å–∞“ì.",
    "–ö“Ø–Ω–¥–µ 5 “õ—ã—Å“õ–∞ –µ—Å–µ–ø —à—ã“ì–∞—Ä—ã–ø –±–µ–∫—ñ—Ç (“õ–∞—Ç–µ —à—ã“õ“õ–∞–Ω –∂–µ—Ä—ñ–Ω “õ–∞–π—Ç–∞ —Ç–∞–ª–¥–∞)."
  ];

  const map = {
    "–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã": "–û–º –∑–∞“£—ã –±–æ–π—ã–Ω—à–∞ 10 –∂–∞—Ç—Ç—ã“ì—É: —Ñ–æ—Ä–º—É–ª–∞–Ω—ã “õ–∞–π –∫–µ–∑–¥–µ “õ–∞–π —Ç“Ø—Ä—ñ–Ω “õ–æ–ª–¥–∞–Ω–∞—Ç—ã–Ω—ã–Ω –∞–∂—ã—Ä–∞—Ç.",
    "–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É": "–§–æ—Ä–º—É–ª–∞–º–µ–Ω –µ—Å–µ–ø —à—ã“ì–∞—Ä—É: –±–µ—Ä—ñ–ª–≥–µ–Ω–¥–µ—Ä–¥—ñ –∂–∞–∑ ‚Üí —Ñ–æ—Ä–º—É–ª–∞–Ω—ã —Ç–∞“£–¥–∞ ‚Üí “õ–æ–π—ã–ø –µ—Å–µ–ø—Ç–µ ‚Üí –±—ñ—Ä–ª—ñ–≥—ñ–Ω —Ç–µ–∫—Å–µ—Ä.",
    "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä": "SI –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä—ñ–Ω —à–∞—Ç–∞—Å—Ç—ã—Ä–º–∞—É “Ø—à—ñ–Ω: A, V, Œ©, W, J, –∫–í—Ç¬∑—Å–∞“ì ‚Äî –±”©–ª–µ–∫ –∂–∞—Ç—Ç–∞.",
    "–ü–∞—Ä–∞–ª–ª–µ–ª—å –ª–æ–≥–∏–∫–∞": "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ R –∞–∑–∞—è–¥—ã, —Å–µ–±–µ–±—ñ —Ç–æ–∫“õ–∞ –∂–æ–ª –∫”©–±–µ–π–µ–¥—ñ ‚Äî —Å—Ö–µ–º–∞–º–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä—ñ–ø –∫”©—Ä.",
    "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É": "–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ I –±—ñ—Ä–¥–µ–π, U –±”©–ª—ñ–Ω–µ–¥—ñ ‚Äî 2 —Ä–µ–∑–∏—Å—Ç–æ—Ä–ª—ã –º—ã—Å–∞–ª–º–µ–Ω –¥”ô–ª–µ–ª–¥–µ.",
    "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É": "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ U –±—ñ—Ä–¥–µ–π, I –±”©–ª—ñ–Ω–µ–¥—ñ ‚Äî 2 —Ç–∞—Ä–º–∞“õ –º—ã—Å–∞–ª—ã–º–µ–Ω –±–µ–∫—ñ—Ç.",
    "“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã": "“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä—ã: P=U¬∑I, P=I¬≤R, P=U¬≤/R ‚Äî “õ–∞–π –∫–µ–∑–¥–µ “õ–∞–π—Å—ã —ã“£“ì–∞–π–ª—ã –µ–∫–µ–Ω—ñ–Ω –∂–∞–∑.",
    "–ï—Å–µ–ø (–∫–í—Ç¬∑—Å–∞“ì)": "–∫–í—Ç¬∑—Å–∞“ì: –∞–ª–¥—ã–º–µ–Ω W‚ÜíkW (1000-“ì–∞ –±”©–ª), —Å–æ—Å—ã–Ω P¬∑t."
  };

  const extra = [];
  top.forEach(([tag])=>{
    if(map[tag]) extra.push(map[tag]);
  });

  // “õ–∞–π—Ç–∞–ª–∞–Ω–±–∞—É “Ø—à—ñ–Ω
  const out = [...extra, ...base].filter((v,i,arr)=>arr.indexOf(v)===i);
  return out.slice(0,6);
}

/* =========================
   AI (Perplexity) per question
   –¢—Ä–µ–±—É–µ—Ç Netlify Function /.netlify/functions/ask
   ========================= */
async function askAIExplain(item, chosenIdx, correctIdx){
  const chosenText = `${String.fromCharCode(65+chosenIdx)}. ${item.options[chosenIdx]}`;
  const correctText = `${String.fromCharCode(65+correctIdx)}. ${item.options[correctIdx]}`;

  $("aiExplainBtn").disabled = true;
  $("aiExplainStatus").textContent = "–ñ–ò –∂–∞—É–∞–ø –¥–∞–π—ã–Ω–¥–∞–ø –∂–∞—Ç—ã—Ä...";
  $("aiExplainOut").style.display = "none";
  $("aiExplainOut").textContent = "";

  const payload = {
    topic: "–¢“±—Ä–∞“õ—Ç—ã —ç–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã (10-—Å—ã–Ω—ã–ø)",
    question: item.q,
    options: item.options,
    chosen: chosenText,
    correct: correctText,
    tag: item.tag || "",
    short_explain: item.explain || "",
    student_level: $("klass").value.trim() || "10",
    language: "kk",
    request: "–û“õ—É—à—ã“ì–∞ —Ç“Ø—Å—ñ–Ω—ñ–∫—Ç—ñ —Ç—ñ–ª–º–µ–Ω —Ç–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä: –Ω–µ–≥–µ –¥“±—Ä—ã—Å –∂–∞—É–∞–ø –¥“±—Ä—ã—Å, “õ–∞—Ç–µ –∂–∞—É–∞–ø –Ω–µ–≥–µ “õ–∞—Ç–µ. “ö—ã—Å“õ–∞ —Ñ–æ—Ä–º—É–ª–∞/–ª–æ–≥–∏–∫–∞ –∫”©—Ä—Å–µ—Ç. –°–æ“£—ã–Ω–¥–∞ 1 “õ—ã—Å“õ–∞ “±“õ—Å–∞—Å –µ—Å–µ–ø/–º–∏–Ω–∏-—Å“±—Ä–∞“õ –±–µ—Ä (–∂–∞—É–∞–±—ã–Ω –∂–∞—Å—ã—Ä–º–∞–π)."
  };

  try{
    const res = await fetch("/.netlify/functions/ask", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });

    const data = await res.json().catch(()=>({}));
    if(!res.ok){
      throw new Error(data?.error || ("HTTP "+res.status));
    }

    const text = data?.answer || data?.output || data?.text || JSON.stringify(data, null, 2);

    $("aiExplainOut").style.display = "block";
    $("aiExplainOut").textContent = text;
    $("aiExplainStatus").textContent = "–î–∞–π—ã–Ω ‚úÖ";
  }catch(e){
    $("aiExplainStatus").textContent =
      "–ñ–ò –∂–∞—É–∞–ø –∫–µ–ª–º–µ–¥—ñ. –°–µ–±–µ–ø: " + (e?.message || e) +
      " (Netlify-–¥–µ PPLX_API_KEY “õ–æ–π—ã–ª“ì–∞–Ω—ã–Ω —Ç–µ–∫—Å–µ—Ä).";
  }finally{
    $("aiExplainBtn").disabled = false;
  }
}

// XSS safe render for summary
function escapeHtml(s){
  return String(s||"").replace(/[&<>"']/g, (c)=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[c]));
}
</script>

</body>
</html>
