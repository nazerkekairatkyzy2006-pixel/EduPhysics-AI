<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EduPhysics AI ‚Äî –¢“±—Ä–∞“õ—Ç—ã —ç–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã</title>
  <style>
    body{font-family:system-ui,Arial;max-width:1100px;margin:20px auto;padding:0 12px;line-height:1.35}
    .card{border:1px solid #ddd;border-radius:14px;padding:14px;margin:12px 0}
    input,textarea,button,select{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;font-size:16px}
    button{cursor:pointer}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    pre{white-space:pre-wrap;background:#f7f7f7;border-radius:10px;padding:10px;border:1px solid #eee}
    code{background:#f1f1f1;padding:2px 6px;border-radius:6px}
    .muted{color:#555}
    .hidden{display:none}
    .opt{margin:8px 0}
    .pill{display:inline-block;padding:3px 8px;border:1px solid #ddd;border-radius:999px;margin:4px 6px 0 0;font-size:13px;background:#fafafa}
    .good{border-color:#9bd39b;background:#f3fff3}
    .bad{border-color:#e6a2a2;background:#fff3f3}
  </style>
</head>
<body>
  <h1>EduPhysics AI</h1>
  <p class="muted">
    –¢–∞“õ—ã—Ä—ã–ø: <b>–¢“±—Ä–∞“õ—Ç—ã —ç–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã</b>. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ 3 —Ç–µ—Å—Ç—Ç–µ–Ω —Ç“±—Ä–∞–¥—ã (”ô—Ä“õ–∞–π—Å—ã—Å—ã 10 —Å“±—Ä–∞“õ).
    ”ò—Ä —Å“±—Ä–∞“õ—Ç–∞–Ω –∫–µ–π—ñ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –∂”ô–Ω–µ ‚Äú“õ–∞—Ç–µ —Ç–µ–≥—ñ‚Äù (misconception tag) —à—ã“ì–∞–¥—ã.
    –°–æ“£—ã–Ω–¥–∞ ‚ÄúLimited Memory summary‚Äù —Ä–µ—Ç—ñ–Ω–¥–µ —Ç–æ–ø-3 “õ–∞—Ç–µ –º–µ–Ω “±—Å—ã–Ω—ã—Å –±–µ—Ä—ñ–ª–µ–¥—ñ.
  </p>

  <!-- –û“õ—É—à—ã -->
  <div class="card">
    <h2>–û“õ—É—à—ã</h2>
    <div class="row">
      <input id="fio" placeholder="–§–ò–û" />
      <input id="klass" placeholder="–ö–ª–∞—Å—Å (–º—ã—Å–∞–ª—ã 10–ê)" />
    </div>
  </div>

  <!-- –¢–µ—Å—Ç —Ç–∞“£–¥–∞—É—ã -->
  <div class="card">
    <h2>–¢–µ—Å—Ç—Ç–µ—Ä</h2>
    <div class="row3">
      <button id="btnT1">–¢–µ—Å—Ç 1: –û–º –∑–∞“£—ã</button>
      <button id="btnT2">–¢–µ—Å—Ç 2: “ö–æ—Å—ã–ª—É–ª–∞—Ä</button>
      <button id="btnT3">–¢–µ—Å—Ç 3: “ö—É–∞—Ç/–∂“±–º—ã—Å</button>
    </div>
    <p class="muted" style="margin-top:10px">
      ”ò—Ä —Ç–µ—Å—Ç 10 —Å“±—Ä–∞“õ—Ç–∞–Ω —Ç“±—Ä–∞–¥—ã. ‚Äú–ë–∞—Å—Ç–∞—É‚Äù –±–∞—Å—Å–∞“£, —Å“±—Ä–∞“õ—Ç–∞—Ä –∫–µ–∑–µ–∫–ø–µ–Ω —à—ã“ì–∞–¥—ã.
    </p>
  </div>

  <!-- QUIZ UI -->
  <div class="card hidden" id="quizCard">
    <h2 id="quizTitle">–¢–µ—Å—Ç</h2>
    <div class="muted" id="progress">1/10</div>

    <h3 id="qText" style="margin-top:10px">–°“±—Ä–∞“õ</h3>
    <div id="options"></div>

    <div class="row" style="margin-top:10px">
      <button id="btnNext" disabled>–ö–µ–ª–µ—Å—ñ</button>
      <button id="btnFinish" class="hidden">–ê—è“õ—Ç–∞—É</button>
    </div>

    <h3 style="margin-top:14px">–ö–µ—Ä—ñ –±–∞–π–ª–∞–Ω—ã—Å</h3>
    <pre id="feedback">–ñ–∞—É–∞–ø —Ç–∞“£–¥–∞...</pre>
  </div>

  <!-- RESULTS -->
  <div class="card hidden" id="resultsCard">
    <h2>–ù”ô—Ç–∏–∂–µ</h2>
    <pre id="resultsText">...</pre>
    <div id="topTags"></div>
    <h3 style="margin-top:12px">“∞—Å—ã–Ω—ã—Å—Ç–∞—Ä</h3>
    <ul id="recs"></ul>
    <button id="btnBack" style="margin-top:10px">–¢–∞“ì—ã —Ç–µ—Å—Ç —Ç–∞–ø—Å—ã—Ä—É</button>
  </div>

  <!-- –°—ã–∑–±–∞ + —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ (–∫—Ä–∏—Ç–µ—Ä–∏–π) -->
  <div class="card">
    <h2>–°—ã–∑–±–∞ + —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –º”ô—Ç—ñ–Ω (–∫—Ä–∏—Ç–µ—Ä–∏–π)</h2>
    <h3>–î–µ—Ä–µ–∫—Ç–µ—Ä –∞“ì—ã–Ω—ã (Data Flow)</h3>
    <pre>
–û“õ—É—à—ã ‚Üí –¢–µ—Å—Ç —Ç–∞“£–¥–∞—É ‚Üí –°“±—Ä–∞“õ“õ–∞ –∂–∞—É–∞–ø ‚Üí –¢–µ–∫—Å–µ—Ä—É ‚Üí “ö–∞—Ç–µ —Ç–µ–≥—ñ (tag) ‚Üí Summary –∂–∞“£–∞—Ä—Ç—É
     ‚Üí “∞—Å—ã–Ω—ã—Å/—Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ ‚Üí –ú“±“ì–∞–ª—ñ–º–≥–µ/–æ“õ—É—à—ã“ì–∞ –Ω”ô—Ç–∏–∂–µ –∫”©—Ä—Å–µ—Ç—É
    </pre>

    <h3>Limited Memory summary (–Ω–µ —Å–∞“õ—Ç–∞–π–º—ã–∑?)</h3>
    <pre>
–°–∞“õ—Ç–∞–π–º—ã–∑ (“õ—ã—Å“õ–∞ “ì–∞–Ω–∞):
- topic_mastery (“õ–∞–π –±”©–ª—ñ–º ”ô–ª—Å—ñ–∑)
- top-3 misconception tags (–µ“£ –∂–∏—ñ “õ–∞—Ç–µ)
- last_seen (—Å–æ“£“ì—ã ”ô—Ä–µ–∫–µ—Ç)
- recommendations (3 “±—Å—ã–Ω—ã—Å)

–°–∞“õ—Ç–∞–º–∞–π–º—ã–∑:
- –±–∞—Ä–ª—ã“õ –∂–∞—É–∞–ø—Ç–∞—Ä–¥—ã“£ —Ç–æ–ª—ã“õ –∞—Ä—Ö–∏–≤—ñ–Ω “±–∑–∞“õ —É–∞“õ—ã—Ç“õ–∞
(“õ–∞–∂–µ—Ç –±–æ–ª—Å–∞ —Ç–µ–∫ —Å–æ“£“ì—ã 1 –ø–æ–ø—ã—Ç–∫–∞ “ì–∞–Ω–∞)
    </pre>
  </div>

  <!-- Perplexity AI Tutor -->
  <div class="card">
    <h2>Perplexity AI Tutor (—Å“±—Ä–∞“õ “õ–æ—é)</h2>
    <textarea id="aiQ" rows="3" placeholder="–ú—ã—Å–∞–ª—ã: –ù–µ–≥–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ R –∞–∑–∞—è–¥—ã?"></textarea>
    <button id="askBtn" style="margin-top:10px">–°“±—Ä–∞—É (–ñ–ò)</button>
    <h3>–ñ–∞—É–∞–ø:</h3>
    <pre id="aiA">...</pre>
    <p class="muted">
      –ï–≥–µ—Ä –±“±–ª –∂–µ—Ä–¥–µ ‚Äú–ù–µ—Ç PPLX_API_KEY‚Ä¶‚Äù —à—ã“õ—Å–∞ ‚Äî Netlify-–¥–µ Environment variable “õ–æ—é –∫–µ—Ä–µ–∫:
      <code>PPLX_API_KEY</code>.
    </p>
  </div>

<script>
  // =========================
  // –í–æ–ø—Ä–æ—Å—ã (3 —Ç–µ—Å—Ç–∞ √ó 10) ‚Äî (—Ä—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
  // =========================
  const TESTS = {
    t1: {
      title: "–¢–µ—Å—Ç 1: –û–º –∑–∞“£—ã –∂”ô–Ω–µ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
      questions: [
        {
          q: "–û–º –∑–∞“£—ã–Ω—ã“£ –¥“±—Ä—ã—Å —Ñ–æ—Ä–º—É–ª–∞—Å—ã “õ–∞–π—Å—ã?",
          opts: ["I = R / U", "I = U / R", "U = I / R", "R = U ¬∑ I"],
          correct: 1,
          tag: "–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
          explain: "–û–º –∑–∞“£—ã: —Ç–æ–∫ –∫“Ø—à—ñ –∫–µ—Ä–Ω–µ—É–≥–µ —Ç—É—Ä–∞, –∫–µ–¥–µ—Ä–≥—ñ–≥–µ –∫–µ—Ä—ñ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª: I = U/R.",
          mini: "–ú—ã—Å–∞–ª: U=12 –í, R=6 Œ© ‚Üí I=12/6=2 A."
        },
        {
          q: "–ö–µ—Ä–Ω–µ—É–¥—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
          opts: ["–ê–º–ø–µ—Ä (A)", "–í–æ–ª—å—Ç (V)", "–û–º (Œ©)", "–í–∞—Ç—Ç (W)"],
          correct: 1,
          tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
          explain: "–ö–µ—Ä–Ω–µ—É (U) –í–æ–ª—å—Ç–ø–µ–Ω (V) ”©–ª—à–µ–Ω–µ–¥—ñ.",
          mini: "–ï—Å—ñ“£–¥–µ —Å–∞“õ—Ç–∞: I‚ÄîA, U‚ÄîV, R‚ÄîŒ©, P‚ÄîW."
        },
        {
          q: "–ö–µ–¥–µ—Ä–≥—ñ–Ω—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
          opts: ["–û–º (Œ©)", "–í–æ–ª—å—Ç (V)", "–ê–º–ø–µ—Ä (A)", "–î–∂–æ—É–ª—å (J)"],
          correct: 0,
          tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
          explain: "–ö–µ–¥–µ—Ä–≥—ñ (R) –û–º–º–µ–Ω (Œ©) ”©–ª—à–µ–Ω–µ–¥—ñ.",
          mini: "R=2 Œ© –¥–µ–≥–µ–Ω—ñ–º—ñ–∑ ‚Äî 1 –ê —Ç–æ–∫ “Ø—à—ñ–Ω 2 –í –∫–µ—Ä–µ–∫ (U=IR)."
        },
        {
          q: "I=2 A, R=5 Œ© –±–æ–ª—Å–∞, U “õ–∞–Ω—à–∞?",
          opts: ["2.5 V", "7 V", "10 V", "20 V"],
          correct: 2,
          tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É",
          explain: "U = I¬∑R. 2¬∑5=10 –í.",
          mini: "“ö–∞—Ç–µ –∫–µ—Ç–ø–µ: –∫”©–±–µ–π—Ç—É/–±”©–ª—É –¥“±—Ä—ã—Å –ø–∞, —Ñ–æ—Ä–º—É–ª–∞–Ω—ã —Ç–µ–∫—Å–µ—Ä."
        },
        {
          q: "U=9 V, I=3 A –±–æ–ª—Å–∞, R “õ–∞–Ω—à–∞?",
          opts: ["27 Œ©", "6 Œ©", "3 Œ©", "9 Œ©"],
          correct: 2,
          tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É",
          explain: "R = U/I. 9/3=3 Œ©.",
          mini: "R=U/I ‚Äî –û–º –∑–∞“£—ã–Ω—ã“£ —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—ñ–ª–≥–µ–Ω —Ç“Ø—Ä—ñ."
        },
        {
          q: "–ï–≥–µ—Ä R –∞—Ä—Ç—Å–∞ (U —Ç“±—Ä–∞“õ—Ç—ã), I “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ?",
          opts: ["–ê—Ä—Ç–∞–¥—ã", "–ö–µ–º–∏–¥—ñ", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ", "–ê–ª–¥—ã–º–µ–Ω –∞—Ä—Ç–∞–¥—ã, —Å–æ—Å—ã–Ω –∫–µ–º–∏–¥—ñ"],
          correct: 1,
          tag: "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫—Ç–µ—Ä",
          explain: "I = U/R. R –∞—Ä—Ç—Å–∞, –±”©–ª—à–µ–∫ –∫—ñ—à—ñ—Ä–µ–π–µ–¥—ñ ‚Üí I –∫–µ–º–∏–¥—ñ.",
          mini: "2 –µ—Å–µ R –∞—Ä—Ç—Å–∞ ‚Üí I 2 –µ—Å–µ –∞–∑–∞—è–¥—ã."
        },
        {
          q: "”®—Ç–∫—ñ–∑–≥—ñ—à—Ç—ñ“£ –∫–µ–¥–µ—Ä–≥—ñ—Å—ñ –ù–ï–≥–µ —Ç”ô—É–µ–ª–¥—ñ –±–æ–ª–∞–¥—ã? (–µ“£ —Ç–æ–ª—ã“õ)",
          opts: ["–¢–µ–∫ —Ç–æ–∫ –∫“Ø—à—ñ–Ω–µ", "–¢–µ–∫ –∫–µ—Ä–Ω–µ—É–≥–µ", "–ú–∞—Ç–µ—Ä–∏–∞–ª, “±–∑—ã–Ω–¥—ã“õ, “õ–∏–º–∞ –∞—É–¥–∞–Ω—ã, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", "–¢–µ–∫ —É–∞“õ—ã—Ç“õ–∞"],
          correct: 2,
          tag: "–ö–µ–¥–µ—Ä–≥—ñ —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä—ã",
          explain: "R –º–∞—Ç–µ—Ä–∏–∞–ª“ì–∞, “±–∑—ã–Ω–¥—ã“õ“õ–∞ (L), “õ–∏–º–∞“ì–∞ (S) –∂”ô–Ω–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞“ì–∞ —Ç”ô—É–µ–ª–¥—ñ.",
          mini: "“∞–∑—ã–Ω –±–æ–ª—Å–∞ ‚Äî R “Ø–ª–∫–µ–Ω; “õ–∏–º–∞ “Ø–ª–∫–µ–Ω –±–æ–ª—Å–∞ ‚Äî R –∫—ñ—à—ñ."
        },
        {
          q: "–¢–æ–∫ –∫“Ø—à—ñ–Ω—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
          opts: ["–û–º (Œ©)", "–ê–º–ø–µ—Ä (A)", "–í–æ–ª—å—Ç (V)", "–í–∞—Ç—Ç (W)"],
          correct: 1,
          tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
          explain: "–¢–æ–∫ –∫“Ø—à—ñ (I) –ê–º–ø–µ—Ä–º–µ–Ω ”©–ª—à–µ–Ω–µ–¥—ñ.",
          mini: "I=1A ‚Äî –±—ñ—Ä —Å–µ–∫—É–Ω–¥—Ç–∞ 1 –ö–ª –∑–∞—Ä—è–¥ ”©—Ç–µ–¥—ñ (I=q/t)."
        },
        {
          q: "I=q/t —Ñ–æ—Ä–º—É–ª–∞—Å—ã –Ω–µ–Ω—ñ –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ?",
          opts: ["–ö–µ—Ä–Ω–µ—É –∞–Ω—ã“õ—Ç–∞–º–∞—Å—ã", "–¢–æ–∫ –∫“Ø—à—ñ –∞–Ω—ã“õ—Ç–∞–º–∞—Å—ã", "–ö–µ–¥–µ—Ä–≥—ñ –∞–Ω—ã“õ—Ç–∞–º–∞—Å—ã", "“ö—É–∞—Ç –∞–Ω—ã“õ—Ç–∞–º–∞—Å—ã"],
          correct: 1,
          tag: "–¢–æ–∫ –∞–Ω—ã“õ—Ç–∞–º–∞—Å—ã",
          explain: "–¢–æ–∫ –∫“Ø—à—ñ ‚Äî —É–∞“õ—ã—Ç –±—ñ—Ä–ª—ñ–≥—ñ–Ω–¥–µ–≥—ñ –∑–∞—Ä—è–¥: I=q/t.",
          mini: "q=10 –ö–ª, t=5 c ‚Üí I=2 A."
        },
        {
          q: "–û–º –∑–∞“£—ã–Ω—ã“£ U “Ø—à—ñ–Ω —Ç“Ø—Ä—ñ?",
          opts: ["U = I/R", "U = IR", "U = R/I", "U = I + R"],
          correct: 1,
          tag: "–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
          explain: "U = I¬∑R.",
          mini: "I=0.5 A, R=8 Œ© ‚Üí U=4 V."
        }
      ]
    },
    t2: {
      title: "–¢–µ—Å—Ç 2: –¢—ñ–∑–±–µ–∫—Ç–µ–π –∂”ô–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—É",
      questions: [
        {
          q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å“õ–∞–Ω–¥–∞ —Ç–æ–ª—ã“õ –∫–µ–¥–µ—Ä–≥—ñ “õ–∞–ª–∞–π —Ç–∞–±—ã–ª–∞–¥—ã?",
          opts: ["R = R1 + R2 + ...", "1/R = 1/R1 + 1/R2 + ...", "R = R1¬∑R2", "R = R1 - R2"],
          correct: 0,
          tag: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—É",
          explain: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—É–¥–∞ –∫–µ–¥–µ—Ä–≥—ñ–ª–µ—Ä “õ–æ—Å—ã–ª–∞–¥—ã: R“õ = R1 + R2 + ...",
          mini: "R1=2 Œ©, R2=3 Œ© ‚Üí R“õ=5 Œ©."
        },
        {
          q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ –¥“±—Ä—ã—Å —Ñ–æ—Ä–º—É–ª–∞?",
          opts: ["R = R1 + R2", "1/R = 1/R1 + 1/R2", "R = R1/R2", "R = R1 - R2"],
          correct: 1,
          tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—É",
          explain: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—É–¥–∞: 1/R“õ = 1/R1 + 1/R2 (+ ...).",
          mini: "R1=6 Œ©, R2=3 Œ© ‚Üí 1/R=1/6+1/3=1/2 ‚Üí R=2 Œ©."
        },
        {
          q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å“õ–∞–Ω–¥–∞ —Ç–æ–∫ –∫“Ø—à—ñ (I) “õ–∞–ª–∞–π –±–æ–ª–∞–¥—ã?",
          opts: ["”ò—Ä –∂–µ—Ä–¥–µ ”ô—Ä—Ç“Ø—Ä–ª—ñ", "–ë–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π", "–¢–µ–∫ –±—ñ—Ä—ñ–Ω—à—ñ —Ä–µ–∑–∏—Å—Ç–æ—Ä–¥–∞ –±–æ–ª–∞–¥—ã", "–ù”©–ª–≥–µ —Ç–µ“£"],
          correct: 1,
          tag: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–∞—Å–∏–µ—Ç",
          explain: "–¢—ñ–∑–±–µ–∫—Ç–µ–π —Ç—ñ–∑–±–µ–∫—Ç–µ —Ç–æ–∫ –±–∞—Ä–ª—ã“õ —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π ”©—Ç–µ–¥—ñ.",
          mini: "I –±—ñ—Ä–¥–µ–π, –∞–ª –∫–µ—Ä–Ω–µ—É –±”©–ª—ñ–∫—Ç–µ—Ä–≥–µ –±”©–ª—ñ–Ω–µ–¥—ñ."
        },
        {
          q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ –∫–µ—Ä–Ω–µ—É (U) “õ–∞–ª–∞–π –±–æ–ª–∞–¥—ã?",
          opts: ["”ò—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–π", "”ò—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ ”ô—Ä—Ç“Ø—Ä–ª—ñ", "–ù”©–ª", "–¢–µ–∫ –±—ñ—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ –±–æ–ª–∞–¥—ã"],
          correct: 0,
          tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–∞—Å–∏–µ—Ç",
          explain: "–ü–∞—Ä–∞–ª–ª–µ–ª—å —Ç–∞—Ä–º–∞“õ—Ç–∞—Ä–¥—ã“£ –∫–µ—Ä–Ω–µ—É—ñ –±—ñ—Ä–¥–µ–π –±–æ–ª–∞–¥—ã.",
          mini: "U –±—ñ—Ä–¥–µ–π, –∞–ª —Ç–æ–∫ —Ç–∞—Ä–º–∞“õ—Ç–∞—Ä“ì–∞ –±”©–ª—ñ–Ω–µ–¥—ñ."
        },
        {
          q: "R1=4 Œ© –∂”ô–Ω–µ R2=6 Œ© —Ç—ñ–∑–±–µ–∫—Ç–µ–π –±–æ–ª—Å–∞, R“õ=?",
          opts: ["10 Œ©", "2.4 Œ©", "24 Œ©", "6 Œ©"],
          correct: 0,
          tag: "–¢—ñ–∑–±–µ–∫—Ç–µ–π –µ—Å–µ–ø",
          explain: "R“õ=4+6=10 Œ©.",
          mini: "–¢—ñ–∑–±–µ–∫—Ç–µ–π: –∂–∞–π “õ–æ—Å–∞—Å—ã“£."
        },
        {
          q: "R1=4 Œ© –∂”ô–Ω–µ R2=6 Œ© –ø–∞—Ä–∞–ª–ª–µ–ª—å –±–æ–ª—Å–∞, R“õ —à–∞–º–∞–º–µ–Ω?",
          opts: ["10 Œ©", "2.4 Œ©", "24 Œ©", "5 Œ©"],
          correct: 1,
          tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å –µ—Å–µ–ø",
          explain: "1/R=1/4+1/6= (3+2)/12=5/12 ‚Üí R=12/5=2.4 Œ©.",
          mini: "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ R ”ô—Ä“õ–∞—à–∞–Ω –µ“£ –∫—ñ—à—ñ—Å—ñ–Ω–µ–Ω –¥–µ –∫—ñ—à—ñ."
        },
        {
          q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ —Ç–æ–∫ –∫“Ø—à—ñ “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ?",
          opts: ["–ë–∞—Ä–ª—ã“ì—ã –±—ñ—Ä–¥–µ–π", "–¢–∞—Ä–º–∞“õ—Ç–∞—Ä“ì–∞ –±”©–ª—ñ–Ω–µ–¥—ñ, –∂–∞–ª–ø—ã —Ç–æ–∫ –∞—Ä—Ç–∞–¥—ã", "–ù”©–ª–≥–µ —Ç“Ø—Å–µ–¥—ñ", "–¢–µ–∫ –±—ñ—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ “õ–∞–ª–∞–¥—ã"],
          correct: 1,
          tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å —Ç–æ–∫",
          explain: "–ñ–∞–ª–ø—ã —Ç–æ–∫ I = I1 + I2 + ... (—Ç–∞—Ä–º–∞“õ—Ç–∞—Ä“ì–∞ –±”©–ª—ñ–Ω–µ–¥—ñ).",
          mini: "–ë—ñ—Ä —Ç–∞—Ä–º–∞“õ “õ–æ—Å—ã–ª—Å–∞ ‚Äî –∂–∞–ª–ø—ã —Ç–æ–∫ –∫”©–±–µ–π–µ–¥—ñ."
        },
        {
          q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—É–¥–∞ –∫–µ—Ä–Ω–µ—É “õ–∞–ª–∞–π –±”©–ª—ñ–Ω–µ–¥—ñ?",
          opts: ["–ë—ñ—Ä–¥–µ–π –±–æ–ª–∞–¥—ã", "“ö–æ—Å—ã–ª–∞–¥—ã: U = U1 + U2 + ...", "–ù”©–ª", "–¢–µ–∫ –±—ñ—Ä —ç–ª–µ–º–µ–Ω—Ç—Ç–µ –±–æ–ª–∞–¥—ã"],
          correct: 1,
          tag: "–¢—ñ–∑–±–µ–∫—Ç–µ–π –∫–µ—Ä–Ω–µ—É",
          explain: "–¢—ñ–∑–±–µ–∫—Ç–µ–π: –∂–∞–ª–ø—ã –∫–µ—Ä–Ω–µ—É –±”©–ª—ñ–∫—Ç–µ—Ä–¥—ñ“£ “õ–æ—Å—ã–Ω–¥—ã—Å—ã.",
          mini: "U=IR: R “Ø–ª–∫–µ–Ω –±–æ–ª—Å–∞, U –±”©–ª—ñ–≥—ñ –¥–µ “Ø–ª–∫–µ–Ω."
        },
        {
          q: "–ï–∫—ñ –±—ñ—Ä–¥–µ–π —Ä–µ–∑–∏—Å—Ç–æ—Ä (R –∂”ô–Ω–µ R) –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—Å–∞, R“õ=?",
          opts: ["2R", "R/2", "R", "R^2"],
          correct: 1,
          tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å –∑–∞“£–¥—ã–ª—ã“õ",
          explain: "–ï–∫—ñ –±—ñ—Ä–¥–µ–π R –ø–∞—Ä–∞–ª–ª–µ–ª—å ‚Üí R“õ=R/2.",
          mini: "–ú—ã—Å–∞–ª: 10 Œ© –∂”ô–Ω–µ 10 Œ© ‚Üí 5 Œ©."
        },
        {
          q: "–ï–∫—ñ –±—ñ—Ä–¥–µ–π —Ä–µ–∑–∏—Å—Ç–æ—Ä (R –∂”ô–Ω–µ R) —Ç—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—Å–∞, R“õ=?",
          opts: ["2R", "R/2", "R", "0"],
          correct: 0,
          tag: "–¢—ñ–∑–±–µ–∫—Ç–µ–π –∑–∞“£–¥—ã–ª—ã“õ",
          explain: "–ï–∫—ñ –±—ñ—Ä–¥–µ–π R —Ç—ñ–∑–±–µ–∫—Ç–µ–π ‚Üí R“õ=2R.",
          mini: "10 Œ© + 10 Œ© = 20 Œ©."
        }
      ]
    },
    t3: {
      title: "–¢–µ—Å—Ç 3: “ö—É–∞—Ç, –∂“±–º—ã—Å, —ç–Ω–µ—Ä–≥–∏—è",
      questions: [
        {
          q: "–≠–ª–µ–∫—Ç—Ä “õ—É–∞—Ç—ã–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?",
          opts: ["P = U¬∑I", "P = U/I", "P = I/R", "P = R/U"],
          correct: 0,
          tag: "“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
          explain: "“ö—É–∞—Ç: P = U¬∑I.",
          mini: "U=12 –í, I=2 A ‚Üí P=24 –í—Ç."
        },
        {
          q: "“ö—É–∞—Ç—Ç—ã“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
          opts: ["–í–∞—Ç—Ç (W)", "–î–∂–æ—É–ª—å (J)", "–û–º (Œ©)", "–ö—É–ª–æ–Ω (C)"],
          correct: 0,
          tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
          explain: "“ö—É–∞—Ç –í–∞—Ç—Ç–ø–µ–Ω ”©–ª—à–µ–Ω–µ–¥—ñ (–í—Ç).",
          mini: "1 –í—Ç = 1 –î–∂/—Å."
        },
        {
          q: "–¢–æ–∫—Ç—ã“£ –∂“±–º—ã—Å—ã (—ç–Ω–µ—Ä–≥–∏—è—Å—ã) “õ–∞–ª–∞–π —Ç–∞–±—ã–ª–∞–¥—ã?",
          opts: ["A = P¬∑t", "A = U/I", "A = R¬∑t", "A = I/t"],
          correct: 0,
          tag: "–ñ“±–º—ã—Å/—ç–Ω–µ—Ä–≥–∏—è",
          explain: "–≠–Ω–µ—Ä–≥–∏—è (–∂“±–º—ã—Å): A = P¬∑t. –°–æ–Ω–¥–∞–π-–∞“õ A=UIt.",
          mini: "P=100 –í—Ç, t=10 —Å ‚Üí A=1000 –î–∂."
        },
        {
          q: "U=220 –í, I=2 A –±–æ–ª—Å–∞, P=?",
          opts: ["110 –í—Ç", "440 –í—Ç", "220 –í—Ç", "222 –í—Ç"],
          correct: 1,
          tag: "“ö—É–∞—Ç –µ—Å–µ–ø",
          explain: "P=U¬∑I=220¬∑2=440 –í—Ç.",
          mini: "–ï—Å–µ–ø—Ç–µ—É–¥–µ –±—ñ—Ä–ª—ñ–∫–∫–µ –º”ô–Ω –±–µ—Ä."
        },
        {
          q: "P=60 –í—Ç —à–∞–º 5 –º–∏–Ω—É—Ç –∂–∞–Ω—Å–∞, —ç–Ω–µ—Ä–≥–∏—è (A) “õ–∞–Ω—à–∞? (—Å–µ–∫—É–Ω–¥–ø–µ–Ω –µ—Å–µ–ø—Ç–µ)",
          opts: ["300 –î–∂", "18000 –î–∂", "1200 –î–∂", "600 –î–∂"],
          correct: 1,
          tag: "–£–∞“õ—ã—Ç—Ç—ã –∞—É—ã—Å—Ç—ã—Ä—É",
          explain: "t=5 –º–∏–Ω=300 —Å. A=P¬∑t=60¬∑300=18000 –î–∂.",
          mini: "–ú–∏–Ω—É—Ç—Ç—ã ”ô—Ä“õ–∞—à–∞–Ω —Å–µ–∫—É–Ω–¥“õ–∞ –∞–π–Ω–∞–ª–¥—ã—Ä!"
        },
        {
          q: "“ö—É–∞—Ç—Ç—ã“£ –±–∞—Å“õ–∞ —Ç“Ø—Ä—ñ (–û–º –∑–∞“£—ã –∞—Ä“õ—ã–ª—ã) “õ–∞–π—Å—ã—Å—ã –¥“±—Ä—ã—Å?",
          opts: ["P = I^2¬∑R", "P = R^2¬∑I", "P = U^2¬∑I", "P = I/R^2"],
          correct: 0,
          tag: "“ö—É–∞—Ç —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É",
          explain: "P=UI –∂”ô–Ω–µ U=IR ‚Üí P=I^2R. –°–æ–Ω–¥–∞–π-–∞“õ P=U^2/R.",
          mini: "–ï–∫—ñ —Ñ–æ—Ä–º—É–ª–∞ –¥–∞ –¥“±—Ä—ã—Å: P=I^2R –∂”ô–Ω–µ P=U^2/R."
        },
        {
          q: "U —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, R –∞–∑–∞–π—Å–∞, “õ—É–∞—Ç P “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ? (P=U^2/R)",
          opts: ["–ö–µ–º–∏–¥—ñ", "–ê—Ä—Ç–∞–¥—ã", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ", "–ù”©–ª –±–æ–ª–∞–¥—ã"],
          correct: 1,
          tag: "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫ (“õ—É–∞—Ç)",
          explain: "P=U^2/R. R –∞–∑–∞–π—Å–∞, –±”©–ª–≥—ñ—à –∞–∑–∞—è–¥—ã ‚Üí P –∞—Ä—Ç–∞–¥—ã.",
          mini: "2 –µ—Å–µ R –∞–∑–∞–π—Å–∞ ‚Üí P 2 –µ—Å–µ ”©—Å–µ–¥—ñ."
        },
        {
          q: "I —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, R –∞—Ä—Ç—Å–∞, “õ—É–∞—Ç P “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ? (P=I^2R)",
          opts: ["–ö–µ–º–∏–¥—ñ", "–ê—Ä—Ç–∞–¥—ã", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ", "–ê–ª–¥—ã–º–µ–Ω ”©—Å–µ–¥—ñ, —Å–æ—Å—ã–Ω –∫–µ–º–∏–¥—ñ"],
          correct: 1,
          tag: "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫ (“õ—É–∞—Ç)",
          explain: "P=I^2R. R –∞—Ä—Ç—Å–∞ ‚Üí P –∞—Ä—Ç–∞–¥—ã.",
          mini: "I –±—ñ—Ä–¥–µ–π –±–æ–ª“ì–∞–Ω–¥–∞, “Ø–ª–∫–µ–Ω R –∫”©–±—ñ—Ä–µ–∫ “õ—É–∞—Ç –±”©–ª–µ–¥—ñ."
        },
        {
          q: "A=UIt —Ñ–æ—Ä–º—É–ª–∞—Å—ã–Ω–¥–∞ t “õ–∞–Ω–¥–∞–π ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫?",
          opts: ["–ú–∏–Ω—É—Ç", "–°–∞“ì–∞—Ç", "–°–µ–∫—É–Ω–¥", "–ö“Ø–Ω"],
          correct: 2,
          tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
          explain: "SI –∂“Ø–π–µ—Å—ñ–Ω–¥–µ —É–∞“õ—ã—Ç —Å–µ–∫—É–Ω–¥–ø–µ–Ω (—Å) –∞–ª—ã–Ω–∞–¥—ã.",
          mini: "1 —Å–∞“ì–∞—Ç = 3600 —Å, 1 –º–∏–Ω—É—Ç = 60 —Å."
        },
        {
          q: "–≠–ª–µ–∫—Ç—Ä —ç–Ω–µ—Ä–≥–∏—è—Å—ã–Ω —Ç“±—Ä–º—ã—Å—Ç–∞ –∫”©–±—ñ–Ω–µ “õ–∞–Ω–¥–∞–π –±—ñ—Ä–ª—ñ–∫–ø–µ–Ω ”©–ª—à–µ–π–¥—ñ?",
          opts: ["–∫–í—Ç¬∑—Å–∞“ì", "–í—Ç", "–û–º", "–ê–º–ø–µ—Ä"],
          correct: 0,
          tag: "–¢“±—Ä–º—ã—Å—Ç—ã“õ —ç–Ω–µ—Ä–≥–∏—è",
          explain: "“Æ–π–¥–µ —ç–ª–µ–∫—Ç—Ä —ç–Ω–µ—Ä–≥–∏—è—Å—ã –∫–í—Ç¬∑—Å–∞“ì (kilowatt-hour) –±—ñ—Ä–ª—ñ–≥—ñ–º–µ–Ω ”©–ª—à–µ–Ω–µ–¥—ñ.",
          mini: "1 –∫–í—Ç¬∑—Å–∞“ì = 3.6√ó10^6 –î–∂."
        }
      ]
    }
  };

  // =========================
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–≤–∏–∑–∞
  // =========================
  let activeTestKey = null;
  let idx = 0;
  let score = 0;
  let answered = false;
  let wrongTags = {}; // tag -> count

  const quizCard = document.getElementById('quizCard');
  const resultsCard = document.getElementById('resultsCard');
  const quizTitle = document.getElementById('quizTitle');
  const progress = document.getElementById('progress');
  const qText = document.getElementById('qText');
  const optionsDiv = document.getElementById('options');
  const feedback = document.getElementById('feedback');
  const btnNext = document.getElementById('btnNext');
  const btnFinish = document.getElementById('btnFinish');
  const resultsText = document.getElementById('resultsText');
  const topTagsDiv = document.getElementById('topTags');
  const recsUl = document.getElementById('recs');

  function resetQuiz() {
    idx = 0; score = 0; answered = false; wrongTags = {};
    feedback.textContent = "–ñ–∞—É–∞–ø —Ç–∞“£–¥–∞...";
    btnNext.disabled = true;
    btnFinish.classList.add('hidden');
    resultsCard.classList.add('hidden');
    quizCard.classList.remove('hidden');
  }

  function startTest(key) {
    activeTestKey = key;
    resetQuiz();
    quizTitle.textContent = TESTS[key].title;
    renderQuestion();
  }

  function renderQuestion() {
    const qs = TESTS[activeTestKey].questions;
    const total = qs.length;
    const item = qs[idx];
    answered = false;
    btnNext.disabled = true;

    progress.textContent = `${idx+1}/${total}`;
    qText.textContent = item.q;
    optionsDiv.innerHTML = "";

    item.opts.forEach((opt, i) => {
      const b = document.createElement('button');
      b.className = "opt";
      b.textContent = opt;
      b.onclick = () => choose(i);
      optionsDiv.appendChild(b);
    });

    feedback.textContent = "–ñ–∞—É–∞–ø —Ç–∞“£–¥–∞...";
    btnFinish.classList.toggle('hidden', idx !== total-1);
  }

  function choose(choiceIndex) {
    if (answered) return;
    answered = true;

    const item = TESTS[activeTestKey].questions[idx];
    const correct = item.correct;

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
    const buttons = optionsDiv.querySelectorAll('button');
    buttons.forEach((b, i) => {
      if (i === correct) b.classList.add('good');
      if (i === choiceIndex && i !== correct) b.classList.add('bad');
      b.disabled = true;
    });

    if (choiceIndex === correct) {
      score += 1;
      feedback.textContent =
`‚úÖ –î“±—Ä—ã—Å!
–¢“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ: ${item.explain}
–ú–∏–Ω–∏-–º—ã—Å–∞–ª: ${item.mini}
Tag: ${item.tag}`;
    } else {
      wrongTags[item.tag] = (wrongTags[item.tag] || 0) + 1;
      feedback.textContent =
`‚ùå “ö–∞—Ç–µ.
–î“±—Ä—ã—Å –∂–∞—É–∞–ø: ${item.opts[correct]}
–¢“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ: ${item.explain}
–ú–∏–Ω–∏-–º—ã—Å–∞–ª: ${item.mini}
“ö–∞—Ç–µ —Ç“Ø—Ä—ñ (tag): ${item.tag}`;
    }

    btnNext.disabled = false;
  }

  btnNext.addEventListener('click', () => {
    const qs = TESTS[activeTestKey].questions;
    if (idx < qs.length - 1) {
      idx += 1;
      renderQuestion();
    } else {
      finish();
    }
  });

  btnFinish.addEventListener('click', finish);

  function top3Tags() {
    const pairs = Object.entries(wrongTags).sort((a,b)=>b[1]-a[1]);
    return pairs.slice(0,3);
  }

  function buildRecommendations(tagsTop) {
    const tags = tagsTop.map(x=>x[0]);
    const recs = [];

    // –ü—Ä–æ—Å—Ç–µ–π—à–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ–≥–∞–º
    if (tags.includes("–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã") || tags.includes("–§–æ—Ä–º—É–ª–∞–Ω—ã “õ–æ–ª–¥–∞–Ω—É") || tags.includes("–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É")) {
      recs.push("–û–º –∑–∞“£—ã: I=U/R, U=IR, R=U/I ‚Äî 3 —Ñ–æ—Ä–º—É–ª–∞–Ω—ã –∂–∞—Ç—Ç–∞–ø, 5 –µ—Å–µ–ø —à—ã“ì–∞—Ä—ã–ø –±–µ–∫—ñ—Ç.");
    }
    if (tags.includes("–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—É") || tags.includes("–ü–∞—Ä–∞–ª–ª–µ–ª—å –µ—Å–µ–ø") || tags.includes("–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–∞—Å–∏–µ—Ç") || tags.includes("–ü–∞—Ä–∞–ª–ª–µ–ª—å —Ç–æ–∫")) {
      recs.push("–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—É: 1/R=1/R1+1/R2, U –±—ñ—Ä–¥–µ–π, I –±”©–ª—ñ–Ω–µ–¥—ñ ‚Äî 3 –º—ã—Å–∞–ª –µ—Å–µ–ø —à—ã“ì–∞—Ä.");
    }
    if (tags.includes("–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—É") || tags.includes("–¢—ñ–∑–±–µ–∫—Ç–µ–π –µ—Å–µ–ø") || tags.includes("–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–∞—Å–∏–µ—Ç") || tags.includes("–¢—ñ–∑–±–µ–∫—Ç–µ–π –∫–µ—Ä–Ω–µ—É")) {
      recs.push("–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—É: R “õ–æ—Å—ã–ª–∞–¥—ã, I –±—ñ—Ä–¥–µ–π, U –±”©–ª—ñ–Ω–µ–¥—ñ ‚Äî 3 –µ—Å–µ–ø –∂–∞—Å–∞.");
    }
    if (tags.includes("“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã") || tags.includes("“ö—É–∞—Ç —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É") || tags.includes("–ñ“±–º—ã—Å/—ç–Ω–µ—Ä–≥–∏—è") || tags.includes("–£–∞“õ—ã—Ç—Ç—ã –∞—É—ã—Å—Ç—ã—Ä—É") || tags.includes("–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫ (“õ—É–∞—Ç)")) {
      recs.push("“ö—É–∞—Ç/—ç–Ω–µ—Ä–≥–∏—è: P=UI, P=I¬≤R, P=U¬≤/R, A=Pt=UIt ‚Äî —É–∞“õ—ã—Ç—Ç—ã —Å–µ–∫—É–Ω–¥“õ–∞ –∞–π–Ω–∞–ª–¥—ã—Ä—É–¥—ã “±–º—ã—Ç–ø–∞.");
    }
    if (tags.includes("”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä")) {
      recs.push("”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä: I‚ÄîA, U‚ÄîV, R‚ÄîŒ©, P‚ÄîW, A‚ÄîJ, —ç–Ω–µ—Ä–≥–∏—è‚Äî–∫–í—Ç¬∑—Å–∞“ì (—Ç“±—Ä–º—ã—Å—Ç–∞).");
    }

    // –¢–æ–ª—Ç—ã—Ä—É: –µ“£ –∫–µ–º—ñ 3 “±—Å—ã–Ω—ã—Å –±–æ–ª—Å—ã–Ω
    while (recs.length < 3) recs.push("”ò–ª—Å—ñ–∑ —Ç–∞“õ—ã—Ä—ã–ø –±–æ–π—ã–Ω—à–∞ 5 “õ—ã—Å“õ–∞ –µ—Å–µ–ø —à—ã“ì–∞—Ä—ã–ø, “õ–∞—Ç–µ–ª–µ—Å–∫–µ–Ω —Ç–µ–≥—Ç–µ—Ä–¥—ñ “õ–∞–π—Ç–∞ “õ–∞—Ä–∞.");

    return recs.slice(0,3);
  }

  function finish() {
    quizCard.classList.add('hidden');
    resultsCard.classList.remove('hidden');

    const total = TESTS[activeTestKey].questions.length;
    const percent = Math.round((score/total)*100);

    const top = top3Tags(); // [ [tag, count], ... ]
    const name = document.getElementById('fio').value || "–ë–µ–∑ –∏–º–µ–Ω–∏";
    const klass = document.getElementById('klass').value || "10";

    resultsText.textContent =
`–û“õ—É—à—ã: ${name} (${klass})
–¢–µ—Å—Ç: ${TESTS[activeTestKey].title}
–î“±—Ä—ã—Å –∂–∞—É–∞–ø: ${score}/${total}
–ù”ô—Ç–∏–∂–µ: ${percent}%`;

    // –¢–æ–ø-3 —Ç–µ–≥—Ç–µ—Ä –∫”©—Ä—Å–µ—Ç—É
    topTagsDiv.innerHTML = "<h3>–¢–æ–ø-3 “õ–∞—Ç–µ —Ç“Ø—Ä—ñ (tags)</h3>";
    if (top.length === 0) {
      topTagsDiv.innerHTML += `<div class="pill good">“ö–∞—Ç–µ –∂–æ“õ üéâ</div>`;
    } else {
      top.forEach(([tag, cnt]) => {
        const span = document.createElement('span');
        span.className = "pill bad";
        span.textContent = `${tag} ‚Äî ${cnt}`;
        topTagsDiv.appendChild(span);
      });
    }

    // “∞—Å—ã–Ω—ã—Å—Ç–∞—Ä
    const recs = buildRecommendations(top);
    recsUl.innerHTML = "";
    recs.forEach(r => {
      const li = document.createElement('li');
      li.textContent = r;
      recsUl.appendChild(li);
    });

    // Limited Memory summary (–¥–µ–º–æ): –±—ñ–∑ –¥”ô–ª –æ—Å—ã 3 –Ω”ô—Ä—Å–µ–Ω—ñ —Å–∞“õ—Ç–∞–π –∞–ª–∞–º—ã–∑
    window.__LM_SUMMARY__ = {
      full_name: name,
      class: klass,
      last_seen: new Date().toISOString(),
      top_misconceptions: top.map(x=>x[0]),
      recommendations: recs,
      topic_mastery_hint: {
        // –ü—Ä–æ—Å—Ç–æ–π –Ω–∞–º–µ–∫: –ø–æ –∫–∞–∫–æ–º—É —Ç–µ—Å—Ç—É –ø—Ä–æ—à—ë–ª
        test_completed: activeTestKey,
        score_percent: percent
      }
    };
  }

  document.getElementById('btnBack').addEventListener('click', () => {
    resultsCard.classList.add('hidden');
  });

  // –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤
  document.getElementById('btnT1').addEventListener('click', ()=>startTest('t1'));
  document.getElementById('btnT2').addEventListener('click', ()=>startTest('t2'));
  document.getElementById('btnT3').addEventListener('click', ()=>startTest('t3'));

  // =========================
  // Perplexity AI: –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–∞
  // =========================
  function buildSummaryForAI() {
    const fio = document.getElementById('fio').value || "–ë–µ–∑ –∏–º–µ–Ω–∏";
    const klass = document.getElementById('klass').value || "10";
    // –ï—Å–ª–∏ —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏–ª —Ç–µ—Å—Ç ‚Äî –±–µ—Ä—ë–º LM summary, –∏–Ω–∞—á–µ ‚Äî –±–∞–∑–æ–≤–∞—è –∑–∞–≥–ª—É—à–∫–∞
    return window.__LM_SUMMARY__ || {
      full_name: fio,
      class: klass,
      top_misconceptions: ["(—Ç–µ—Å—Ç ”ô–ª—ñ —Ç–∞–ø—Å—ã—Ä—ã–ª–º–∞–¥—ã)"],
      recommendations: ["–¢–µ—Å—Ç —Ç–∞–ø—Å—ã—Ä—ã–ø –∫”©—Ä, —Å–æ–Ω–¥–∞ –ñ–ò –¥”ô–ª “±—Å—ã–Ω—ã—Å –±–µ—Ä–µ–¥—ñ."]
    };
  }

  document.getElementById('askBtn').addEventListener('click', async () => {
    const question = document.getElementById('aiQ').value.trim();
    if (!question) return alert("–°“±—Ä–∞“õ –∂–∞–∑!");

    document.getElementById('aiA').textContent = "–ñ–∞—É–∞–ø –∫“Ø—Ç—ñ–ø —Ç“±—Ä...";
    try {
      const res = await fetch("/.netlify/functions/ask", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ question, studentSummary: buildSummaryForAI() })
      });
      const data = await res.json();
      document.getElementById('aiA').textContent = data.answer || data.error || "“ö–∞—Ç–µ";
    } catch (e) {
      document.getElementById('aiA').textContent = "“ö–∞—Ç–µ: Netlify —Ñ—É–Ω–∫—Ü–∏—è/–∏–Ω—Ç–µ—Ä–Ω–µ—Ç —ñ—Å—Ç–µ–º–µ–π —Ç“±—Ä";
    }
  });
</script>
</body>
</html>
