<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EduPhysics AI</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --primary:#2563eb;
      --good:#16a34a;
      --bad:#dc2626;
      --chip:#f3f4f6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{max-width:980px;margin:28px auto;padding:0 14px}
    h1{margin:0 0 6px 0;font-size:34px;letter-spacing:.2px}
    .sub{margin:0 0 18px 0;color:var(--muted)}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      margin:14px 0;
      box-shadow:0 2px 10px rgba(17,24,39,.05);
    }
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .field{flex:1;min-width:220px}
    label{display:block;font-size:13px;color:var(--muted);margin:0 0 6px}
    input{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      font-size:15px;
      outline:none;
      background:#fff;
    }
    input:focus{border-color:rgba(37,99,235,.5);box-shadow:0 0 0 3px rgba(37,99,235,.12)}
    .tabs{display:flex;gap:10px;flex-wrap:wrap}
    .tab{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      min-width:160px;
      text-align:center;
    }
    .tab.active{
      border-color:rgba(37,99,235,.35);
      box-shadow:0 0 0 3px rgba(37,99,235,.10);
    }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
    }
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .qhead{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:end}
    .qmeta{color:var(--muted);font-size:13px}
    .qtitle{font-size:20px;margin:8px 0 6px 0}
    .opts{margin-top:10px;display:flex;flex-direction:column;gap:10px}
    .opt{
      border:1px solid var(--line);
      background:#fff;
      padding:12px;
      border-radius:12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      cursor:pointer;
    }
    .opt input{width:auto;margin-top:2px}
    .resultLine{margin-top:14px;border-top:1px solid var(--line);padding-top:12px}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;font-weight:800;font-size:13px;
    }
    .badge.good{background:rgba(22,163,74,.12);color:var(--good)}
    .badge.bad{background:rgba(220,38,38,.12);color:var(--bad)}
    .mini{color:var(--muted);font-size:13px;line-height:1.5}
    .aiBox{
      margin-top:10px;
      border:1px solid rgba(37,99,235,.25);
      background:rgba(37,99,235,.05);
      border-radius:14px;
      padding:12px;
      display:none;
    }
    .aiTitle{font-weight:900;margin:0 0 8px 0}
    .aiText{margin:0;color:#111827;line-height:1.55;white-space:pre-wrap}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{
      background:rgba(220,38,38,.08);
      border:1px solid rgba(220,38,38,.20);
      color:#991b1b;
      padding:7px 10px;border-radius:999px;font-weight:800;font-size:13px;
    }
    .chip.good{background:rgba(22,163,74,.08);border-color:rgba(22,163,74,.20);color:#14532d}
    ul{margin:10px 0 0 18px}
    .muted{color:var(--muted)}
    .oknote{margin-top:10px;color:var(--good);font-weight:800;display:none}
    .warnnote{margin-top:10px;color:var(--bad);font-weight:800;display:none}
    .footerlink{margin-top:10px;font-size:13px}
    a{color:var(--primary);text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>EduPhysics AI</h1>
    <p class="sub">–¢–∞“õ—ã—Ä—ã–ø: <b>–¢“±—Ä–∞“õ—Ç—ã —ç–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã</b></p>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –û“õ—É—à—ã -->
    <div class="card">
      <h2 style="margin:0 0 12px 0;">–û“õ—É—à—ã</h2>
      <div class="row">
        <div class="field">
          <label>–ê—Ç—ã-–∂”©–Ω—ñ</label>
          <input id="studentName" placeholder="–ú—ã—Å–∞–ª—ã: –ê–π–±–µ–∫ –ù“±—Ä–ª–∞–Ω“±–ª—ã" />
        </div>
        <div class="field">
          <label>–°—ã–Ω—ã–ø</label>
          <input id="studentClass" placeholder="–ú—ã—Å–∞–ª—ã: 10 –ê" />
        </div>
      </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –¢–µ—Å—Ç—Ç–µ—Ä -->
    <div class="card">
      <h2 style="margin:0 0 12px 0;">–¢–µ—Å—Ç—Ç–µ—Ä</h2>

      <div class="tabs" id="tabs"></div>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn primary" id="startBtn">–ë–∞—Å—Ç–∞—É</button>
        <button class="btn" id="resetBtn">–ë”ô—Ä—ñ–Ω —Ç–∞–∑–∞–ª–∞—É</button>
      </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –°“±—Ä–∞“õ -->
    <div class="card" id="quizCard" style="display:none;">
      <div class="qhead">
        <div>
          <div class="qmeta" id="qMeta"></div>
          <div class="qtitle" id="qTitle"></div>
          <div class="mini" id="qTopic"></div>
        </div>
      </div>

      <div class="opts" id="opts"></div>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn primary" id="checkBtn">–¢–µ–∫—Å–µ—Ä—É</button>
        <button class="btn" id="nextBtn" style="display:none;">–ö–µ–ª–µ—Å—ñ</button>
      </div>

      <div class="resultLine" id="resultLine" style="display:none;">
        <div id="resultBadge"></div>

        <div style="margin-top:10px;">
          <div class="mini"><b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> <span id="rightAnswerText"></span></div>
          <div class="mini" style="margin-top:6px;"><b>“ö—ã—Å“õ–∞ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:</b> <span id="shortExplain"></span></div>
          <div class="mini" style="margin-top:6px;"><b>“ö–∞—Ç–µ tag (—à–∞—Ç–∞—Å“õ–∞–Ω –∂–µ—Ä):</b> <span id="mistag"></span></div>
        </div>

        <!-- AI explanation per question -->
        <button class="btn" id="aiExplainBtn" style="margin-top:12px; display:none;">–ñ–ò-–º–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä</button>

        <div class="aiBox" id="aiBox">
          <p class="aiTitle">ü§ñ –¢–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ</p>
          <p class="aiText" id="aiExplainOut"></p>
        </div>
      </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –û“õ—É—à—ã“ì–∞ –∞–Ω–∞–ª–∏–∑ -->
    <div class="card" id="analysisCard" style="display:none;">
      <h2 style="margin:0 0 8px 0;">–û“õ—É—à—ã“ì–∞ –∞–Ω–∞–ª–∏–∑</h2>
      <div class="mini muted">“∞–ø–∞–π, —Ç–æ–ø-3 “õ–∞—Ç–µ —Ç“Ø—Ä—ñ (tags), “±—Å—ã–Ω—ã—Å—Ç–∞—Ä.</div>

      <div class="card" style="border-radius:14px;margin-top:12px;background:#fff;">
        <pre id="analysisText" style="margin:0;white-space:pre-wrap;line-height:1.45;"></pre>

        <h3 style="margin:14px 0 8px 0;">–¢–æ–ø-3 “õ–∞—Ç–µ —Ç“Ø—Ä—ñ (tags)</h3>
        <div class="chips" id="topTags"></div>

        <h3 style="margin:14px 0 8px 0;">“∞—Å—ã–Ω—ã—Å—Ç–∞—Ä</h3>
        <ul id="recs"></ul>

        <button class="btn" id="againBtn" style="margin-top:12px;">–¢–∞“ì—ã —Ç–µ—Å—Ç —Ç–∞–ø—Å—ã—Ä—É</button>

        <div class="oknote" id="sendOk">‚úÖ –ù”ô—Ç–∏–∂–µ –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ.</div>
        <div class="warnnote" id="sendWarn">‚ö†Ô∏è –ù”ô—Ç–∏–∂–µ–Ω—ñ –∂—ñ–±–µ—Ä—É —Å”ô—Ç—Å—ñ–∑ –±–æ–ª–¥—ã. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç/Netlify Forms —Ç–µ–∫—Å–µ—Ä.</div>

        <!-- –û–ø—Ü–∏—è: Perplexity —Å—ñ–ª—Ç–µ–º–µ—Å—ñ–Ω —Ç”©–º–µ–Ω–≥–µ “õ–æ—é (“õ–∞–ª–∞—Å–∞“£) -->
        <div class="footerlink muted">
          “ö–æ—Å—ã–º—à–∞ –æ“õ—É: <a href="https://www.perplexity.ai" target="_blank" rel="noopener">Perplexity</a>
        </div>
      </div>
    </div>

    <!-- =============================== -->
    <!-- Netlify Forms (hidden)          -->
    <!-- =============================== -->
    <!-- –í–ê–ñ–ù–û: —Ñ–æ—Ä–º–∞ –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ HTML, —á—Ç–æ–±—ã Netlify –µ—ë "—É–≤–∏–¥–µ–ª" -->
    <form name="results" method="POST" data-netlify="true" netlify-honeypot="bot-field" hidden>
      <input name="bot-field" />
      <input name="studentName" />
      <input name="studentClass" />
      <input name="testKey" />
      <input name="testTitle" />
      <input name="score" />
      <input name="correct" />
      <input name="total" />
      <input name="percent" />
      <input name="durationSec" />
      <input name="topTags" />
      <input name="recommendations" />
      <input name="timestamp" />
    </form>

  </div>

  <script>
    // ============================================================
    // –î–ê–ù–ù–´–ï: 3 —Ç–µ—Å—Ç–∞ √ó 10
    // (–∫–æ–º–º–µ–Ω—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º, —á—Ç–æ–±—ã —Ç–µ–±–µ —É–¥–æ–±–Ω–æ –±—ã–ª–æ –≤ –∫–æ–¥–µ)
    // ============================================================
    const TESTS = {
      t1: {
        title: "–¢–µ—Å—Ç 1: –û–º –∑–∞“£—ã",
        questions: [
          {
            topic: "–û–º –∑–∞“£—ã",
            q: "–û–º –∑–∞“£—ã–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?",
            options: ["I = U¬∑R", "U = I¬∑R", "R = U+I", "I = R/U"],
            correct: 1,
            tag: "–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
            short: "–û–º –∑–∞“£—ã: U = I¬∑R (–∫–µ—Ä–Ω–µ—É = —Ç–æ–∫ ¬∑ –∫–µ–¥–µ—Ä–≥—ñ).",
          },
          {
            topic: "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É",
            q: "–¢–æ–∫ –∫“Ø—à—ñ–Ω (I) —Ç–∞–±—É —Ñ–æ—Ä–º—É–ª–∞—Å—ã “õ–∞–π—Å—ã?",
            options: ["I = U/R", "I = U¬∑R", "I = R/U", "I = R¬∑U"],
            correct: 0,
            tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É",
            short: "U = I¬∑R ‚Üí I = U/R.",
          },
          {
            topic: "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É",
            q: "–ö–µ–¥–µ—Ä–≥—ñ–Ω—ñ (R) —Ç–∞–±—É —Ñ–æ—Ä–º—É–ª–∞—Å—ã “õ–∞–π—Å—ã?",
            options: ["R = U/I", "R = I/U", "R = U¬∑I", "R = U+I"],
            correct: 0,
            tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É",
            short: "U = I¬∑R ‚Üí R = U/I.",
          },
          {
            topic: "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫",
            q: "–ö–µ—Ä–Ω–µ—É —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, –∫–µ–¥–µ—Ä–≥—ñ –∞—Ä—Ç—Å–∞ —Ç–æ–∫ (I) “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ?",
            options: ["–ê—Ä—Ç–∞–¥—ã", "–ê–∑–∞—è–¥—ã", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ", "–ê–ª–¥—ã–º–µ–Ω –∞—Ä—Ç—ã–ø, –∫–µ–π—ñ–Ω –∞–∑–∞—è–¥—ã"],
            correct: 1,
            tag: "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫",
            short: "I = U/R: R –∞—Ä—Ç—Å–∞, I –∞–∑–∞—è–¥—ã.",
          },
          {
            topic: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫",
            q: "–¢–æ–∫ –∫“Ø—à—ñ–Ω—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
            options: ["–í–æ–ª—å—Ç (V)", "–û–º (Œ©)", "–ê–º–ø–µ—Ä (A)", "–í–∞—Ç—Ç (W)"],
            correct: 2,
            tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
            short: "–¢–æ–∫ –∫“Ø—à—ñ –∞–º–ø–µ—Ä–º–µ–Ω (A) ”©–ª—à–µ–Ω–µ–¥—ñ.",
          },
          {
            topic: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫",
            q: "–ö–µ—Ä–Ω–µ—É–¥—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
            options: ["–í–æ–ª—å—Ç (V)", "–ê–º–ø–µ—Ä (A)", "–û–º (Œ©)", "–î–∂–æ—É–ª—å (J)"],
            correct: 0,
            tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
            short: "–ö–µ—Ä–Ω–µ—É –≤–æ–ª—å—Ç–ø–µ–Ω (V) ”©–ª—à–µ–Ω–µ–¥—ñ.",
          },
          {
            topic: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫",
            q: "–ö–µ–¥–µ—Ä–≥—ñ–Ω—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
            options: ["–í–∞—Ç—Ç (W)", "–û–º (Œ©)", "–í–æ–ª—å—Ç (V)", "–ö—É–ª–æ–Ω (C)"],
            correct: 1,
            tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
            short: "–ö–µ–¥–µ—Ä–≥—ñ –æ–º–º–µ–Ω (Œ©) ”©–ª—à–µ–Ω–µ–¥—ñ.",
          },
          {
            topic: "–ï—Å–µ–ø",
            q: "U = 12 –í, R = 4 Œ©. –¢–æ–∫ –∫“Ø—à—ñ I “õ–∞–Ω—à–∞?",
            options: ["3 A", "16 A", "48 A", "0.33 A"],
            correct: 0,
            tag: "–ï—Å–µ–ø —à—ã“ì–∞—Ä—É",
            short: "I = U/R = 12/4 = 3 A.",
          },
          {
            topic: "–ï—Å–µ–ø",
            q: "I = 2 A, R = 5 Œ©. –ö–µ—Ä–Ω–µ—É U “õ–∞–Ω—à–∞?",
            options: ["2.5 V", "10 V", "7 V", "3 V"],
            correct: 1,
            tag: "–ï—Å–µ–ø —à—ã“ì–∞—Ä—É",
            short: "U = I¬∑R = 2¬∑5 = 10 V.",
          },
          {
            topic: "–¢“Ø—Å—ñ–Ω—ñ–∫",
            q: "–û–º –∑–∞“£—ã “õ–∞–Ω–¥–∞–π —à–∞–º–∞–ª–∞—Ä–¥—ã –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã—Ä–∞–¥—ã?",
            options: ["Q, t, I", "U, I, R", "P, A, t", "E, q, r"],
            correct: 1,
            tag: "–¢“Ø—Å—ñ–Ω—ñ–∫",
            short: "–û–º –∑–∞“£—ã U (–∫–µ—Ä–Ω–µ—É), I (—Ç–æ–∫), R (–∫–µ–¥–µ—Ä–≥—ñ) –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω –±–µ—Ä–µ–¥—ñ.",
          },
        ]
      },

      t2: {
        title: "–¢–µ—Å—Ç 2: “ö–æ—Å—ã–ª—É–ª–∞—Ä",
        questions: [
          {
            topic: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É",
            q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å“õ–∞–Ω–¥–∞ –∂–∞–ª–ø—ã –∫–µ–¥–µ—Ä–≥—ñ “õ–∞–ª–∞–π —Ç–∞–±—ã–ª–∞–¥—ã?",
            options: ["R = R1 + R2 + ...", "1/R = 1/R1 + 1/R2 + ...", "R = R1¬∑R2", "R = R1/R2"],
            correct: 0,
            tag: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É",
            short: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É–¥–∞ –∫–µ–¥–µ—Ä–≥—ñ–ª–µ—Ä “õ–æ—Å—ã–ª–∞–¥—ã.",
          },
          {
            topic: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É",
            q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ –∂–∞–ª–ø—ã –∫–µ–¥–µ—Ä–≥—ñ “Ø—à—ñ–Ω –¥“±—Ä—ã—Å ”©—Ä–Ω–µ–∫?",
            options: ["R = R1 + R2", "1/R = 1/R1 + 1/R2", "R = R1 - R2", "R = R1/R2"],
            correct: 1,
            tag: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É",
            short: "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ 1/R “õ–æ—Å—ã–Ω–¥—ã—Å—ã “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã.",
          },
          {
            topic: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É",
            q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π —Ç—ñ–∑–±–µ–∫—Ç–µ —Ç–æ–∫ –∫“Ø—à—ñ “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ?",
            options: ["–ë–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π", "”ò—Ä –∂–µ—Ä–¥–µ ”ô—Ä—Ç“Ø—Ä–ª—ñ", "–ù”©–ª –±–æ–ª–∞–¥—ã", "–¢–µ–∫ –∫–µ—Ä–Ω–µ—É–≥–µ —Ç–µ“£"],
            correct: 0,
            tag: "–¢–æ–∫ —Ç–∞—Ä–∞–ª—É—ã",
            short: "–¢—ñ–∑–±–µ–∫—Ç–µ–π —Ç—ñ–∑–±–µ–∫—Ç–µ —Ç–æ–∫ –±–∞—Ä–ª—ã“õ —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä–¥–µ–Ω –±—ñ—Ä–¥–µ–π ”©—Ç–µ–¥—ñ.",
          },
          {
            topic: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É",
            q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å —Ç—ñ–∑–±–µ–∫—Ç–µ –∫–µ—Ä–Ω–µ—É “õ–∞–ª–∞–π –±–æ–ª–∞–¥—ã?",
            options: ["–ë–∞—Ä–ª—ã“õ —Ç–∞—Ä–º–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–π", "”ò—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ ”ô—Ä—Ç“Ø—Ä–ª—ñ", "–ù”©–ª", "–¢–µ–∫ —Ç–æ–∫“õ–∞ —Ç–µ“£"],
            correct: 0,
            tag: "–ö–µ—Ä–Ω–µ—É —Ç–∞—Ä–∞–ª—É—ã",
            short: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ ”ô—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ –∫–µ—Ä–Ω–µ—É –±—ñ—Ä–¥–µ–π.",
          },
          {
            topic: "–°–∞–ª—ã—Å—Ç—ã—Ä—É",
            q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ –∂–∞–ª–ø—ã –∫–µ–¥–µ—Ä–≥—ñ (R) ”ô—Ä“õ–∞–π—Å—ã—Å—ã–Ω–∞–Ω “õ–∞–ª–∞–π –±–æ–ª–∞–¥—ã?",
            options: ["“Æ–ª–∫–µ–Ω –±–æ–ª–∞–¥—ã", "–ö—ñ—à—ñ –±–æ–ª–∞–¥—ã", "–¢–µ“£ –±–æ–ª–∞–¥—ã", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ"],
            correct: 1,
            tag: "–ñ–∞–ª–ø—ã –∫–µ–¥–µ—Ä–≥—ñ",
            short: "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ –∂–∞–ª–ø—ã R –µ“£ –∫—ñ—à—ñ—Å—ñ–Ω–µ–Ω –¥–µ –∫—ñ—à—ñ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.",
          },
          {
            topic: "–ï—Å–µ–ø",
            q: "R1 = 2Œ©, R2 = 3Œ© —Ç—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª–¥—ã. R–∂–∞–ª–ø—ã?",
            options: ["5Œ©", "1.2Œ©", "6Œ©", "0.5Œ©"],
            correct: 0,
            tag: "–ï—Å–µ–ø —à—ã“ì–∞—Ä—É",
            short: "–¢—ñ–∑–±–µ–∫—Ç–µ–π: R = 2 + 3 = 5Œ©.",
          },
          {
            topic: "–ï—Å–µ–ø",
            q: "R1 = 2Œ©, R2 = 2Œ© –ø–∞—Ä–∞–ª–ª–µ–ª—å. R–∂–∞–ª–ø—ã?",
            options: ["4Œ©", "2Œ©", "1Œ©", "0.5Œ©"],
            correct: 2,
            tag: "–ï—Å–µ–ø —à—ã“ì–∞—Ä—É",
            short: "–ü–∞—Ä–∞–ª–ª–µ–ª—å: 1/R = 1/2 + 1/2 = 1 ‚Üí R=1Œ©.",
          },
          {
            topic: "–ï—Å–µ–ø",
            q: "–ü–∞—Ä–∞–ª–ª–µ–ª—å —Ç—ñ–∑–±–µ–∫—Ç–µ I–∂–∞–ª–ø—ã –Ω–µ–≥–µ —Ç–µ“£?",
            options: ["I = I1 + I2 + ...", "I = I1 - I2", "I = U¬∑R", "I = R/U"],
            correct: 0,
            tag: "–¢–æ–∫ —Ç–∞—Ä–∞–ª—É—ã",
            short: "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ —Ç–æ–∫ —Ç–∞—Ä–º–∞“õ—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ “õ–æ—Å—ã–ª–∞–¥—ã.",
          },
          {
            topic: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É",
            q: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å“õ–∞–Ω–¥–∞ –∫–µ—Ä–Ω–µ—É–ª–µ—Ä “õ–∞–ª–∞–π –±”©–ª—ñ–Ω–µ–¥—ñ?",
            options: ["U = U1 + U2 + ...", "U –±–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π", "U = U1/U2", "U = R1+R2"],
            correct: 0,
            tag: "–ö–µ—Ä–Ω–µ—É —Ç–∞—Ä–∞–ª—É—ã",
            short: "–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ –∂–∞–ª–ø—ã –∫–µ—Ä–Ω–µ—É –∫–µ—Ä–Ω–µ—É–ª–µ—Ä “õ–æ—Å—ã–Ω–¥—ã—Å—ã.",
          },
          {
            topic: "–¢“Ø—Å—ñ–Ω—ñ–∫",
            q: "“Æ–π–¥–µ–≥—ñ —à–∞–º–¥–∞—Ä –Ω–µ–≥–µ –∫”©–±—ñ–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å –∂–∞–ª“ì–∞–Ω–∞–¥—ã?",
            options: ["–ë—ñ—Ä—ñ ”©—à—Å–µ –±”ô—Ä—ñ ”©—à–µ–¥—ñ", "”ò—Ä“õ–∞–π—Å—ã—Å—ã –±—ñ—Ä–¥–µ–π –∫–µ—Ä–Ω–µ—É–¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ", "–¢–æ–∫ –Ω”©–ª –±–æ–ª–∞–¥—ã", "–ö–µ–¥–µ—Ä–≥—ñ ”©—Å–µ–¥—ñ"],
            correct: 1,
            tag: "–¢“Ø—Å—ñ–Ω—ñ–∫",
            short: "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ ”ô—Ä —à–∞–º –±—ñ—Ä–¥–µ–π –∫–µ—Ä–Ω–µ—É–¥—ñ –∞–ª–∞–¥—ã, –±—ñ—Ä–µ—É—ñ –∂–∞–Ω–±–∞—Å–∞ –±–∞—Å“õ–∞—Å—ã –∂–∞–Ω–∞ –±–µ—Ä–µ–¥—ñ.",
          },
        ]
      },

      t3: {
        title: "–¢–µ—Å—Ç 3: “ö—É–∞—Ç/–∂“±–º—ã—Å",
        questions: [
          {
            topic: "“ö—É–∞—Ç",
            q: "–≠–ª–µ–∫—Ç—Ä “õ—É–∞—Ç—ã–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?",
            options: ["P = U¬∑I", "P = U/I", "P = I/R", "P = R/U"],
            correct: 0,
            tag: "“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
            short: "“ö—É–∞—Ç: P = U¬∑I.",
          },
          {
            topic: "“ö—É–∞—Ç",
            q: "“ö—É–∞—Ç—Ç—ã“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ?",
            options: ["–î–∂–æ—É–ª—å (J)", "–í–∞—Ç—Ç (W)", "–ö—É–ª–æ–Ω (C)", "–û–º (Œ©)"],
            correct: 1,
            tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
            short: "“ö—É–∞—Ç –≤–∞—Ç—Ç–ø–µ–Ω (W) ”©–ª—à–µ–Ω–µ–¥—ñ.",
          },
          {
            topic: "–ñ“±–º—ã—Å/—ç–Ω–µ—Ä–≥–∏—è",
            q: "–≠–ª–µ–∫—Ç—Ä –∂“±–º—ã—Å—ã (—ç–Ω–µ—Ä–≥–∏—è) “Ø—à—ñ–Ω –¥“±—Ä—ã—Å ”©—Ä–Ω–µ–∫?",
            options: ["A = P¬∑t", "A = U/R", "A = I¬∑R", "A = U/I"],
            correct: 0,
            tag: "–ñ“±–º—ã—Å —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
            short: "–ñ“±–º—ã—Å: A = P¬∑t (–Ω–µ–º–µ—Å–µ A=UIt).",
          },
          {
            topic: "“ö—É–∞—Ç",
            q: "P = 60 W, U = 220 V –±–æ–ª—Å–∞, —Ç–æ–∫ I “õ–∞–Ω—à–∞ (—à–∞–º–∞–º–µ–Ω)?",
            options: ["0.27 A", "3.67 A", "13.2 A", "132 A"],
            correct: 0,
            tag: "–ï—Å–µ–ø —à—ã“ì–∞—Ä—É",
            short: "I = P/U = 60/220 ‚âà 0.27 A.",
          },
          {
            topic: "–ñ“±–º—ã—Å/—ç–Ω–µ—Ä–≥–∏—è",
            q: "P = 100 W “õ“±—Ä—ã–ª“ì—ã 30 —Å –∂“±–º—ã—Å —ñ—Å—Ç–µ–¥—ñ. A “õ–∞–Ω—à–∞?",
            options: ["3000 J", "3 J", "0.3 J", "300 J"],
            correct: 0,
            tag: "–ï—Å–µ–ø —à—ã“ì–∞—Ä—É",
            short: "A = P¬∑t = 100¬∑30 = 3000 J.",
          },
          {
            topic: "–¢“Ø—Å—ñ–Ω—ñ–∫",
            q: "“ö—É–∞—Ç –Ω–µ –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ?",
            options: ["–£–∞“õ—ã—Ç –±—ñ—Ä–ª—ñ–≥—ñ–Ω–¥–µ–≥—ñ –∂“±–º—ã—Å", "–ö–µ–¥–µ—Ä–≥—ñ–Ω—ñ“£ —à–∞–º–∞—Å—ã", "–¢–æ–∫—Ç—ã“£ –±–∞“ì—ã—Ç—ã", "–ö–µ—Ä–Ω–µ—É–¥—ñ“£ –±–µ–ª–≥—ñ—Å—ñ"],
            correct: 0,
            tag: "–¢“Ø—Å—ñ–Ω—ñ–∫",
            short: "“ö—É–∞—Ç ‚Äî —É–∞“õ—ã—Ç –±—ñ—Ä–ª—ñ–≥—ñ–Ω–¥–µ –∂–∞—Å–∞–ª“ì–∞–Ω –∂“±–º—ã—Å (—ç–Ω–µ—Ä–≥–∏—è —à—ã“ì—ã–Ω–¥–∞—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã).",
          },
          {
            topic: "–§–æ—Ä–º—É–ª–∞",
            q: "“ö—É–∞—Ç—Ç—ã“£ –±–∞–ª–∞–º–∞ —Ñ–æ—Ä–º—É–ª–∞—Å—ã?",
            options: ["P = I¬≤¬∑R", "P = R/I¬≤", "P = U¬∑R", "P = U/R¬≤"],
            correct: 0,
            tag: "“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã",
            short: "P = U¬∑I –∂”ô–Ω–µ U=IR ‚Üí P=I¬≤R (—Å–æ–Ω–¥–∞–π-–∞“õ P=U¬≤/R).",
          },
          {
            topic: "–§–æ—Ä–º—É–ª–∞",
            q: "P = U¬≤/R —Ñ–æ—Ä–º—É–ª–∞—Å—ã “õ–∞–π–¥–∞–Ω —à—ã“ì–∞–¥—ã?",
            options: ["U=IR –∞–ª–º–∞—Å—Ç—ã—Ä—É –∞—Ä“õ—ã–ª—ã", "–ö–µ–∑–¥–µ–π—Å–æ“õ", "–¢–µ–∫ —Ç”ô–∂—ñ—Ä–∏–±–µ–¥–µ–Ω", "–¢–µ–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É–¥–∞–Ω"],
            correct: 0,
            tag: "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É",
            short: "P=U¬∑I, –∞–ª I=U/R ‚Üí P=U¬∑(U/R)=U¬≤/R.",
          },
          {
            topic: "–¢“Ø—Å—ñ–Ω—ñ–∫",
            q: "–≠–ª–µ–∫—Ç—Ä —ç–Ω–µ—Ä–≥–∏—è—Å—ã —Ç“±—Ä–º—ã—Å—Ç–∞ –∂–∏—ñ “õ–∞–Ω–¥–∞–π –±—ñ—Ä–ª—ñ–∫–ø–µ–Ω –µ—Å–µ–ø—Ç–µ–ª–µ–¥—ñ?",
            options: ["–∫–í—Ç¬∑—Å–∞“ì", "–î–∂–æ—É–ª—å", "–û–º", "–ö—É–ª–æ–Ω"],
            correct: 0,
            tag: "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä",
            short: "–¢“±—Ä–º—ã—Å—Ç–∞ –∫–í—Ç¬∑—Å–∞“ì “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã.",
          },
          {
            topic: "–°–∞–ª—ã—Å—Ç—ã—Ä—É",
            q: "–ö–µ–¥–µ—Ä–≥—ñ ”©—Å—Å–µ (U —Ç“±—Ä–∞“õ—Ç—ã), “õ—É–∞—Ç P “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ?",
            options: ["–ê–∑–∞—è–¥—ã", "–ê—Ä—Ç–∞–¥—ã", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ", "–ù”©–ª –±–æ–ª–∞–¥—ã"],
            correct: 0,
            tag: "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫",
            short: "P = U¬≤/R: R –∞—Ä—Ç—Å–∞, P –∞–∑–∞—è–¥—ã.",
          },
        ]
      }
    };

    // ============================================================
    // AI-—Å—Ç–∏–ª—å: “±–∑—ã–Ω, —Ç–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ —à–∞–±–ª–æ–Ω–¥–∞—Ä—ã (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç—Å—ñ–∑)
    // ============================================================
    function buildLongAIExplanation({qObj, chosenIndex, isCorrect}) {
      const chosenText = (chosenIndex == null) ? "–¢–∞“£–¥–∞–ª–º–∞“ì–∞–Ω" : qObj.options[chosenIndex];
      const rightText = qObj.options[qObj.correct];

      // –ö–µ“£–µ–π—Ç—ñ–ª–≥–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ tag –±–æ–π—ã–Ω—à–∞
      const byTag = {
        "–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã": [
          "–û–º –∑–∞“£—ã “Ø—à —à–∞–º–∞–Ω—ã –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã—Ä–∞–¥—ã: –∫–µ—Ä–Ω–µ—É (U), —Ç–æ–∫ –∫“Ø—à—ñ (I), –∫–µ–¥–µ—Ä–≥—ñ (R). –ù–µ–≥—ñ–∑–≥—ñ —Ç“Ø—Ä—ñ: U = I¬∑R.",
          "–ë“±–ª —Ñ–æ—Ä–º—É–ª–∞ ¬´–∫–µ—Ä–Ω–µ—É –Ω–µ“ì“±—Ä–ª—ã–º “Ø–ª–∫–µ–Ω –±–æ–ª—Å–∞, –±—ñ—Ä–¥–µ–π –∫–µ–¥–µ—Ä–≥—ñ–¥–µ —Ç–æ–∫ —Å–æ“ì“±—Ä–ª—ã–º “Ø–ª–∫–µ–Ω –±–æ–ª–∞–¥—ã¬ª –¥–µ–≥–µ–Ω–¥—ñ –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ.",
          "–ï—Å—Ç–µ —Å–∞“õ—Ç–∞—É“ì–∞ –ª–∞–π—Ñ—Ö–∞–∫: ¬´U¬ª ”ô—Ä“õ–∞—à–∞–Ω ¬´I¬ª –º–µ–Ω ¬´R¬ª-–¥—ã“£ –∫”©–±–µ–π—Ç—ñ–Ω–¥—ñ—Å—ñ —Ä–µ—Ç—ñ–Ω–¥–µ —Ç“±—Ä–∞–¥—ã (U = I√óR)."
        ],
        "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É": [
          "–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä–≥–µ–Ω–¥–µ –±–∞—Å—Ç—ã –µ—Ä–µ–∂–µ: —Ç–µ“£–¥—ñ–∫—Ç—ñ“£ –µ–∫—ñ –∂–∞“ì—ã–Ω–∞ –¥–∞ –±—ñ—Ä–¥–µ–π –∞–º–∞–ª –∂–∞—Å–∞–π—Å—ã“£.",
          "–ú—ã—Å–∞–ª—ã U = I¬∑R –±–æ–ª—Å–∞, I —Ç–∞–±—É “Ø—à—ñ–Ω –µ–∫—ñ –∂–∞“õ—Ç—ã –¥–∞ R-“ì–∞ –±”©–ª–µ–º—ñ–∑: I = U/R.",
          "R —Ç–∞–±—É “Ø—à—ñ–Ω –µ–∫—ñ –∂–∞“õ—Ç—ã –¥–∞ I-–≥–µ –±”©–ª–µ–º—ñ–∑: R = U/I. –û—Å—ã 3 —Ç“Ø—Ä–¥—ñ –∂–∞—Ç—Ç–∞–ø –∞–ª—Å–∞“£ ‚Äî –∫”©–ø “õ–∞—Ç–µ –∫–µ—Ç–ø–µ–π–¥—ñ."
        ],
        "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä": [
          "”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫ ‚Äî —à–∞–º–∞–Ω—ã —à–∞—Ç–∞—Å—Ç—ã—Ä–º–∞–π —Ç–∞–Ω—É–¥—ã“£ –µ“£ —Ç–µ–∑ –∂–æ–ª—ã.",
          "I ‚Äî –∞–º–ø–µ—Ä (A), U ‚Äî –≤–æ–ª—å—Ç (V), R ‚Äî –æ–º (Œ©), P ‚Äî –≤–∞—Ç—Ç (W), A/—ç–Ω–µ—Ä–≥–∏—è ‚Äî –¥–∂–æ—É–ª—å (J) –Ω–µ–º–µ—Å–µ —Ç“±—Ä–º—ã—Å—Ç–∞ –∫–í—Ç¬∑—Å–∞“ì.",
          "–ö”©–ø “õ–∞—Ç–µ –æ—Å—ã –∂–µ—Ä–¥–µ –±–æ–ª–∞–¥—ã: W –ø–µ–Ω V-—Ç—ñ, Œ© –º–µ–Ω A-–Ω—ã –∞—É—ã—Å—Ç—ã—Ä—ã–ø “õ–æ—é. –§–æ—Ä–º—É–ª–∞–º–µ–Ω –±—ñ—Ä–≥–µ –±—ñ—Ä–ª—ñ–∫—Ç—ñ –¥–µ –µ—Å—Ç–µ —Å–∞“õ—Ç–∞."
        ],
        "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫": [
          "–¢”ô—É–µ–ª–¥—ñ–ª—ñ–∫—Ç—ñ —Ç“Ø—Å—ñ–Ω—É “Ø—à—ñ–Ω —Ñ–æ—Ä–º—É–ª–∞“ì–∞ “õ–∞—Ä–∞: I = U/R –Ω–µ–º–µ—Å–µ P = U¬≤/R.",
          "–ï–≥–µ—Ä U —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, R –∞—Ä—Ç“õ–∞–Ω–¥–∞ –±”©–ª—à–µ–∫ –∫—ñ—à—ñ—Ä–µ–π–µ–¥—ñ ‚Üí I –∞–∑–∞—è–¥—ã; –¥”ô–ª —Å–æ–ª —Å–∏—è“õ—Ç—ã P = U¬≤/R ‚Üí “õ—É–∞—Ç —Ç–∞ –∞–∑–∞—è–¥—ã.",
          "–ú“±–Ω—ã –∫“Ø–Ω–¥–µ–ª—ñ–∫—Ç—ñ –º—ã—Å–∞–ª–º–µ–Ω –µ–ª–µ—Å—Ç–µ—Ç: “õ“±–±—ã—Ä (R) —Ç–∞—Ä—ã–ª—Å–∞ (R ”©—Å—Å–µ) —Å—É –∞–∑ ”©—Ç–µ–¥—ñ (I –∞–∑–∞—è–¥—ã)."
        ],
        "–ï—Å–µ–ø —à—ã“ì–∞—Ä—É": [
          "–ï—Å–µ–ø—Ç–µ 3 “õ–∞–¥–∞–º: 1) –±–µ—Ä—ñ–ª–≥–µ–Ω—ñ–Ω –∂–∞–∑, 2) —Ñ–æ—Ä–º—É–ª–∞–Ω—ã —Ç–∞“£–¥–∞, 3) –æ—Ä–Ω—ã–Ω–∞ “õ–æ–π—ã–ø –µ—Å–µ–ø—Ç–µ.",
          "–ö–∞–ª—å–∫—É–ª—è—Ü–∏—è–¥–∞–Ω –±“±—Ä—ã–Ω –±—ñ—Ä–ª—ñ–∫—Ç—ñ —Ç–µ–∫—Å–µ—Ä: –≤–æ–ª—å—Ç/–æ–º ‚Üí –∞–º–ø–µ—Ä, –≤–∞—Ç—Ç/–≤–æ–ª—å—Ç ‚Üí –∞–º–ø–µ—Ä, –≤–∞—Ç—Ç¬∑—Å–µ–∫ ‚Üí –¥–∂–æ—É–ª—å.",
          "–ï–≥–µ—Ä –Ω”ô—Ç–∏–∂–µ —Ç—ã–º “Ø–ª–∫–µ–Ω/—Ç—ã–º –∫—ñ—à—ñ —à—ã“õ—Å–∞ ‚Äî –∫”©–±–µ–π—Ç—É/–±”©–ª—É —à–∞—Ç–∞—Å“õ–∞–Ω –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω."
        ],
        "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É": [
          "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É–¥–∞ —Ç–æ–∫ –±—ñ—Ä “ì–∞–Ω–∞ –∂–æ–ª–º–µ–Ω ”©—Ç–µ–¥—ñ, —Å–æ–Ω–¥—ã“õ—Ç–∞–Ω I –±–∞—Ä–ª—ã“õ –∂–µ—Ä–¥–µ –±—ñ—Ä–¥–µ–π.",
          "–ö–µ–¥–µ—Ä–≥—ñ–ª–µ—Ä “õ–æ—Å—ã–ª–∞–¥—ã: R–∂–∞–ª–ø—ã = R1 + R2 + ...",
          "–ö–µ—Ä–Ω–µ—É –±”©–ª—ñ–Ω–µ–¥—ñ: U = U1 + U2 + ... (”ô—Ä —Ä–µ–∑–∏—Å—Ç–æ—Ä–¥–∞ ”©–∑ “Ø–ª–µ—Å—ñ –±–∞—Ä)."
        ],
        "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É": [
          "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É–¥–∞ —Ç–∞—Ä–º–∞“õ—Ç–∞—Ä –∫”©–ø: —Ç–æ–∫ —Ç–∞—Ä–º–∞“õ—Ç–∞—Ä“ì–∞ –±”©–ª—ñ–Ω–µ–¥—ñ, –±—ñ—Ä–∞“õ –∫–µ—Ä–Ω–µ—É ”ô—Ä —Ç–∞—Ä–º–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–π.",
          "–ñ–∞–ª–ø—ã –∫–µ–¥–µ—Ä–≥—ñ –∫—ñ—à—ñ—Ä–µ–π–µ–¥—ñ: 1/R = 1/R1 + 1/R2 + ...",
          "–°–µ–±–µ–±—ñ —Ç–æ–∫“õ–∞ –±—ñ—Ä–Ω–µ—à–µ ¬´–∂–æ–ª¬ª –∞—à—ã–ª–∞–¥—ã ‚Äî ”©—Ç–∫—ñ–∑–≥—ñ—à—Ç—ñ–∫ –∞—Ä—Ç–∞–¥—ã."
        ],
        "–¢–æ–∫ —Ç–∞—Ä–∞–ª—É—ã": [
          "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ I–∂–∞–ª–ø—ã = I1 + I2 + ... (—Ç–∞—Ä–º–∞“õ—Ç–∞—Ä “õ–æ—Å—ã–Ω–¥—ã—Å—ã).",
          "–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ —Ç–æ–∫ –±—ñ—Ä–¥–µ–π, ”©–π—Ç–∫–µ–Ω—ñ –∂–æ–ª –±—ñ—Ä–µ—É.",
          "–ï–≥–µ—Ä “õ–∞–π –∂–µ—Ä–¥–µ —Ç–æ–∫ –±—ñ—Ä–¥–µ–π –µ–∫–µ–Ω—ñ–Ω “±–º—ã—Ç—Å–∞“£: ¬´–±—ñ—Ä –∂–æ–ª ‚Äî –±—ñ—Ä–¥–µ–π —Ç–æ–∫¬ª –¥–µ–ø –µ—Å—Ç–µ —Å–∞“õ—Ç–∞."
        ],
        "–ö–µ—Ä–Ω–µ—É —Ç–∞—Ä–∞–ª—É—ã": [
          "–ü–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ –∫–µ—Ä–Ω–µ—É –±—ñ—Ä–¥–µ–π: ”ô—Ä —Ç–∞—Ä–º–∞“õ –±—ñ—Ä ¬´–±—ñ—Ä–¥–µ–π –Ω“Ø–∫—Ç–µ–ª–µ—Ä–≥–µ¬ª “õ–æ—Å—ã–ª“ì–∞–Ω.",
          "–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ –∫–µ—Ä–Ω–µ—É –±”©–ª—ñ–Ω–µ–¥—ñ, ”©–π—Ç–∫–µ–Ω—ñ ”ô—Ä —ç–ª–µ–º–µ–Ω—Ç –∂–∞–ª–ø—ã –∫–µ—Ä–Ω–µ—É–¥—ñ“£ –±—ñ—Ä –±”©–ª—ñ–≥—ñ–Ω ¬´–∞–ª–∞–¥—ã¬ª.",
          "“ö—ã—Å“õ–∞ —Ç–µ–∫—Å–µ—Ä—ñ—Å: –ø–∞—Ä–∞–ª–ª–µ–ª—å ‚Äî U –±—ñ—Ä–¥–µ–π; —Ç—ñ–∑–±–µ–∫—Ç–µ–π ‚Äî I –±—ñ—Ä–¥–µ–π."
        ],
        "–ñ–∞–ª–ø—ã –∫–µ–¥–µ—Ä–≥—ñ": [
          "–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å“õ–∞–Ω–¥–∞ –∂–∞–ª–ø—ã –∫–µ–¥–µ—Ä–≥—ñ –∞–∑–∞—è–¥—ã: R–∂–∞–ª–ø—ã –µ“£ –∫—ñ—à—ñ—Å—ñ–Ω–µ–Ω –¥–µ –∫—ñ—à—ñ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.",
          "–°–µ–±–µ–±—ñ ”©—Ç–∫—ñ–∑–≥—ñ—à—Ç—ñ–∫ –∫”©–±–µ–π–µ–¥—ñ: 1/R (”©—Ç–∫—ñ–∑–≥—ñ—à—Ç—ñ–∫) “õ–æ—Å—ã–ª–∞–¥—ã.",
          "–¢—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ –∫–µ—Ä—ñ—Å—ñ–Ω—à–µ ‚Äî R ”©—Å–µ–¥—ñ, ”©–π—Ç–∫–µ–Ω—ñ –∂–æ–ª “±–∑–∞—Ä“ì–∞–Ω–¥–∞–π –±–æ–ª–∞–¥—ã."
        ],
        "“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã": [
          "“ö—É–∞—Ç ‚Äî —ç–Ω–µ—Ä–≥–∏—è–Ω—ã“£ –∂“±–º—Å–∞–ª—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã: P = A/t.",
          "–≠–ª–µ–∫—Ç—Ä —Ç—ñ–∑–±–µ–≥—ñ–Ω–¥–µ “õ—É–∞—Ç—Ç—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ç“Ø—Ä—ñ: P = U¬∑I.",
          "“ö–æ—Å—ã–º—à–∞ —Ç“Ø—Ä–ª–µ—Ä—ñ: P = I¬≤¬∑R –∂”ô–Ω–µ P = U¬≤/R (–û–º –∑–∞“£—ã –∞—Ä“õ—ã–ª—ã —à—ã“ì–∞–¥—ã)."
        ],
        "–ñ“±–º—ã—Å —Ñ–æ—Ä–º—É–ª–∞—Å—ã": [
          "–≠–ª–µ–∫—Ç—Ä –∂“±–º—ã—Å—ã/—ç–Ω–µ—Ä–≥–∏—è: A = P¬∑t.",
          "–ï–≥–µ—Ä P = U¬∑I –±–æ–ª—Å–∞, –æ–Ω–¥–∞ A = U¬∑I¬∑t (–∂–∏—ñ “õ–æ–ª–¥–∞–Ω—ã–ª–∞—Ç—ã–Ω —Ç“Ø—Ä).",
          "–ë—ñ—Ä–ª—ñ–∫—Ç–µ—Ä: –≤–∞—Ç—Ç¬∑—Å–µ–∫ = –¥–∂–æ—É–ª—å. –¢“±—Ä–º—ã—Å—Ç–∞ –∫–í—Ç¬∑—Å–∞“ì “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã."
        ],
        "–¢“Ø—Å—ñ–Ω—ñ–∫": [
          "–ë“±–ª —Å“±—Ä–∞“õ —Ñ–æ—Ä–º—É–ª–∞ –∂–∞—Ç—Ç–∞—É–¥–∞–Ω –±”©–ª–µ–∫, –º–∞“ì—ã–Ω–∞ —Ç“Ø—Å—ñ–Ω—É–¥—ñ —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ.",
          "”®–∑—ñ“£–µ —Å“±—Ä–∞“õ “õ–æ–π: ¬´–ë“±–ª —à–∞–º–∞ –Ω–µ–Ω—ñ —Å–∏–ø–∞—Ç—Ç–∞–π–¥—ã? “ö–∞–π —à–∞–º–∞–ª–∞—Ä–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã?¬ª",
          "–ú–∞“ì—ã–Ω–∞–Ω—ã —Ç“Ø—Å—ñ–Ω—Å–µ“£, –∂–∞—É–∞–ø –Ω“±—Å“õ–∞–ª–∞—Ä—ã–Ω—ã“£ —ñ—à—ñ–Ω–¥–µ –±—ñ—Ä-–µ–∫–µ—É—ñ –±—ñ—Ä–¥–µ–Ω ¬´–ª–æ–≥–∏–∫–∞“ì–∞ —Å–∞–π –µ–º–µ—Å¬ª –±–æ–ª—ã–ø “õ–∞–ª–∞–¥—ã."
        ],
      };

      const tagLines = byTag[qObj.tag] || [
        "–ë“±–ª —Å“±—Ä–∞“õ—Ç—ã“£ –∫—ñ–ª—Ç—ñ ‚Äî –Ω–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞–Ω—ã –¥“±—Ä—ã—Å —Ç–∞“£–¥–∞—É –∂”ô–Ω–µ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä–¥—ñ —à–∞—Ç–∞—Å—Ç—ã—Ä–º–∞—É.",
        "–ï–≥–µ—Ä “õ–∞—Ç–µ –∫–µ—Ç—Å–µ, –∫”©–±—ñ–Ω–µ –∫”©–±–µ–π—Ç—É/–±”©–ª—É –Ω–µ–º–µ—Å–µ —Ñ–æ—Ä–º—É–ª–∞–¥–∞“ì—ã —à–∞–º–∞–ª–∞—Ä–¥—ã“£ –æ—Ä–Ω—ã–Ω –∞—É—ã—Å—Ç—ã—Ä—É–¥–∞–Ω –±–æ–ª–∞–¥—ã.",
        "“ö—ã—Å“õ–∞ “õ–∞–π—Ç–∞–ª–∞—É –∂–∞—Å–∞: —Ñ–æ—Ä–º—É–ª–∞–Ω—ã –∂–∞–∑—ã–ø, 2‚Äì3 –º—ã—Å–∞–ª –µ—Å–µ–ø–ø–µ–Ω –±–µ–∫—ñ—Ç."
      ];

      const verdict = isCorrect
        ? "–°–µ–Ω –¥“±—Ä—ã—Å –∂–∞—É–∞–ø –±–µ—Ä–¥—ñ“£ ‚úÖ –ë—ñ—Ä–∞“õ —Ç–æ–ª—ã“õ —Ç“Ø—Å—ñ–Ω—É “Ø—à—ñ–Ω “õ—ã—Å“õ–∞—à–∞ –¥”ô–ª–µ–ª—ñ–Ω –æ“õ—ã–ø —à—ã“õ."
        : "“ö–∞–∑—ñ—Ä “õ–∞—Ç–µ –∫–µ—Ç—Ç—ñ ‚ùå –ï—à—Ç–µ“£–µ –µ—Ç–ø–µ–π–¥—ñ ‚Äî –Ω–∞“õ—Ç—ã “õ–∞–π –∂–µ—Ä–¥–µ–Ω —à–∞—Ç–∞—Å“õ–∞–Ω—ã“£–¥—ã —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä—ñ–ø —à—ã“ì–∞–º.";

      const commonMistake = !isCorrect
        ? `–ö”©–±—ñ–Ω–µ –¥”ô–ª –æ—Å—ã–Ω–¥–∞–π “õ–∞—Ç–µ –º—ã–Ω–∞–¥–∞–Ω –±–æ–ª–∞–¥—ã: "${qObj.tag}" –±”©–ª—ñ–º—ñ–Ω–¥–µ —Ñ–æ—Ä–º—É–ª–∞–Ω—ã/–µ—Ä–µ–∂–µ–Ω—ñ —à–∞—Ç–∞—Å—Ç—ã—Ä—ã–ø –∞–ª—É.`
        : `–ñ–∞“õ—Å—ã! –î–µ–≥–µ–Ω–º–µ–Ω "${qObj.tag}" –±”©–ª—ñ–º—ñ–Ω –±–µ–∫—ñ—Ç—ñ–ø –∞–ª—Å–∞“£, –∫–µ–ª–µ—Å—ñ —Å“±—Ä–∞“õ—Ç–∞—Ä –∂–µ“£—ñ–ª –±–æ–ª–∞–¥—ã.`;

      const miniPractice = [
        "–ú–∏–Ω–∏-–∂–∞—Ç—Ç—ã“ì—É:",
        "1) –ù–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞–Ω—ã –±—ñ—Ä –∂–æ–ª“ì–∞ –∂–∞–∑.",
        "2) –°–æ–ª —Ñ–æ—Ä–º—É–ª–∞–Ω—ã 2 –±–∞—Å“õ–∞ —Ç“Ø—Ä–≥–µ —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä (–µ–≥–µ—Ä –º“Ø–º–∫—ñ–Ω –±–æ–ª—Å–∞).",
        "3) 1 “õ—ã—Å“õ–∞ —Å–∞–Ω–¥—ã“õ –º—ã—Å–∞–ª –æ–π–ª–∞–ø, –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω —Ç–µ–∫—Å–µ—Ä."
      ].join("\n");

      return [
        verdict,
        "",
        `–°“±—Ä–∞“õ: ${qObj.q}`,
        `–°–µ–Ω —Ç–∞“£–¥–∞“ì–∞–Ω—ã“£: ${chosenText}`,
        `–î“±—Ä—ã—Å –∂–∞—É–∞–ø: ${rightText}`,
        "",
        "–¢“Ø—Å—ñ–Ω–¥—ñ—Ä—É:",
        ...tagLines.map(s => "‚Ä¢ " + s),
        "",
        commonMistake,
        "",
        miniPractice
      ].join("\n");
    }

    // ============================================================
    // UI state
    // ============================================================
    const tabsDiv = document.getElementById("tabs");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");
    const quizCard = document.getElementById("quizCard");
    const qMeta = document.getElementById("qMeta");
    const qTitle = document.getElementById("qTitle");
    const qTopic = document.getElementById("qTopic");
    const optsDiv = document.getElementById("opts");
    const checkBtn = document.getElementById("checkBtn");
    const nextBtn = document.getElementById("nextBtn");
    const resultLine = document.getElementById("resultLine");
    const resultBadge = document.getElementById("resultBadge");
    const rightAnswerText = document.getElementById("rightAnswerText");
    const shortExplain = document.getElementById("shortExplain");
    const mistag = document.getElementById("mistag");

    const aiExplainBtn = document.getElementById("aiExplainBtn");
    const aiBox = document.getElementById("aiBox");
    const aiExplainOut = document.getElementById("aiExplainOut");

    const analysisCard = document.getElementById("analysisCard");
    const analysisText = document.getElementById("analysisText");
    const topTagsDiv = document.getElementById("topTags");
    const recsUl = document.getElementById("recs");
    const againBtn = document.getElementById("againBtn");
    const sendOk = document.getElementById("sendOk");
    const sendWarn = document.getElementById("sendWarn");

    const studentNameInp = document.getElementById("studentName");
    const studentClassInp = document.getElementById("studentClass");

    let activeTestKey = "t1";
    let idx = 0;
    let chosen = null;
    let answers = [];
    let startedAt = null;

    // –°—á–µ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫ –ø–æ tag –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    let tagCount = new Map();

    // ============================================================
    // Tabs render
    // ============================================================
    function renderTabs(){
      tabsDiv.innerHTML = "";
      Object.entries(TESTS).forEach(([key, t])=>{
        const b = document.createElement("button");
        b.className = "tab" + (key===activeTestKey ? " active":"");
        b.textContent = t.title;
        b.onclick = ()=>{
          activeTestKey = key;
          idx = 0;
          chosen = null;
          answers = [];
          tagCount = new Map();
          startedAt = null;
          analysisCard.style.display="none";
          quizCard.style.display="none";
          sendOk.style.display="none";
          sendWarn.style.display="none";
          renderTabs();
        };
        tabsDiv.appendChild(b);
      });
    }

    // ============================================================
    // Quiz render
    // ============================================================
    function renderQuestion(){
      const t = TESTS[activeTestKey];
      const q = t.questions[idx];

      qMeta.textContent = `–ê“ì—ã–º–¥–∞“ì—ã —Ç–µ—Å—Ç: ${t.title} ‚Ä¢ –°“±—Ä–∞“õ: ${idx+1}/${t.questions.length}`;
      qTitle.textContent = q.q;
      qTopic.textContent = q.topic ? q.topic : "";

      optsDiv.innerHTML = "";
      chosen = null;

      q.options.forEach((opt, i)=>{
        const lab = document.createElement("label");
        lab.className = "opt";
        lab.innerHTML = `
          <input type="radio" name="opt" value="${i}">
          <div><b>${String.fromCharCode(65+i)}.</b> ${opt}</div>
        `;
        lab.onclick = ()=>{
          chosen = i;
          // –æ—Ç–º–µ—Ç–∏—Ç—å —Ä–∞–¥–∏–æ
          const radio = lab.querySelector("input");
          radio.checked = true;
        };
        optsDiv.appendChild(lab);
      });

      // reset result area
      resultLine.style.display="none";
      nextBtn.style.display="none";
      checkBtn.disabled = false;

      aiExplainBtn.style.display = "none";
      aiBox.style.display = "none";
      aiExplainOut.textContent = "";
    }

    // ============================================================
    // Analysis & recommendations
    // ============================================================
    function buildRecommendations(topTags){
      // –ü—Ä–æ—Å—Ç–µ–π—à–∏–µ —Å–æ–≤–µ—Ç—ã –ø–æ —Ç–æ–ø-–æ—à–∏–±–∫–∞–º
      const recs = [];
      const tags = topTags.map(x=>x[0]);

      if(tags.includes("–û–º –∑–∞“£—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã") || tags.includes("–§–æ—Ä–º—É–ª–∞–Ω—ã —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É")){
        recs.push("–û–º –∑–∞“£—ã–Ω—ã“£ 3 —Ç“Ø—Ä—ñ–Ω –∂–∞—Ç—Ç–∞: I=U/R, U=I¬∑R, R=U/I. –ö“Ø–Ω—ñ–Ω–µ 5 –º—ã—Å–∞–ª –µ—Å–µ–ø —à—ã“ì–∞—Ä—ã–ø –±–µ–∫—ñ—Ç.");
      }
      if(tags.includes("”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä")){
        recs.push("”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫—Ç–µ—Ä –∫–µ—Å—Ç–µ—Å—ñ–Ω –∂–∞—Å–∞: I‚ÄîA, U‚ÄîV, R‚ÄîŒ©, P‚ÄîW, A‚ÄîJ/–∫–í—Ç¬∑—Å–∞“ì. “ö–∞—Å—ã–Ω–∞ “õ—ã—Å“õ–∞ –º—ã—Å–∞–ª –∂–∞–∑.");
      }
      if(tags.includes("–ü–∞—Ä–∞–ª–ª–µ–ª—å “õ–æ—Å—ã–ª—É") || tags.includes("–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É")){
        recs.push("–ï—Ä–µ–∂–µ: —Ç—ñ–∑–±–µ–∫—Ç–µ–π–¥–µ I –±—ñ—Ä–¥–µ–π, –ø–∞—Ä–∞–ª–ª–µ–ª—å–¥–µ U –±—ñ—Ä–¥–µ–π. –û—Å—ã–Ω—ã 2 —Å—É—Ä–µ—Ç–ø–µ–Ω –¥”ô–ø—Ç–µ—Ä–≥–µ —Å—ã–∑ –¥–∞, 3 –µ—Å–µ–ø–ø–µ–Ω –±–µ–∫—ñ—Ç.");
      }
      if(tags.includes("“ö—É–∞—Ç —Ñ–æ—Ä–º—É–ª–∞—Å—ã") || tags.includes("–ñ“±–º—ã—Å —Ñ–æ—Ä–º—É–ª–∞—Å—ã")){
        recs.push("“ö—É–∞—Ç/—ç–Ω–µ—Ä–≥–∏—è: P=U¬∑I, A=P¬∑t, –∂”ô–Ω–µ P=I¬≤R, P=U¬≤/R —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä—ã–Ω —à—ã“ì–∞—Ä—ã–ø –∫”©—Ä (–û–º –∑–∞“£—ã–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã—Ä—ã–ø).");
      }
      if(tags.includes("–ï—Å–µ–ø —à—ã“ì–∞—Ä—É")){
        recs.push("–ï—Å–µ–ø –∞–ª–≥–æ—Ä–∏—Ç–º—ñ: –±–µ—Ä—ñ–ª–≥–µ–Ω ‚Üí —Ñ–æ—Ä–º—É–ª–∞ ‚Üí –æ—Ä–Ω—ã–Ω–∞ “õ–æ—é ‚Üí –±—ñ—Ä–ª—ñ–∫ —Ç–µ–∫—Å–µ—Ä—É. ”ò—Ä –µ—Å–µ–ø—Ç–µ–Ω –∫–µ–π—ñ–Ω –Ω”ô—Ç–∏–∂–µ–Ω—ñ –ª–æ–≥–∏–∫–∞–º–µ–Ω —Å–∞–ª—ã—Å—Ç—ã—Ä.");
      }
      if(recs.length === 0){
        recs.push("–ñ–∞“õ—Å—ã –Ω”ô—Ç–∏–∂–µ! ”ò–ª—Å—ñ–∑ —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä“ì–∞ 3 “õ—ã—Å“õ–∞ –µ—Å–µ–ø —à—ã“ì–∞—Ä—ã–ø, “õ–∞—Ç–µ –∫–µ—Ç–∫–µ–Ω —Å“±—Ä–∞“õ—Ç–∞—Ä“ì–∞ “õ–∞–π—Ç–∞ –æ—Ä–∞–ª.");
      }
      return recs;
    }

    function showAnalysis(){
      const t = TESTS[activeTestKey];
      const total = t.questions.length;
      const correct = answers.filter(a=>a.correct).length;
      const percent = Math.round((correct/total)*100);
      const durationSec = startedAt ? Math.round((Date.now()-startedAt)/1000) : 0;

      // top-3 tags
      const arr = Array.from(tagCount.entries()).sort((a,b)=>b[1]-a[1]);
      const top = arr.slice(0,3);

      // text
      const sName = (studentNameInp.value || "").trim() || "‚Äî";
      const sClass = (studentClassInp.value || "").trim() || "‚Äî";
      const now = new Date();
      const stamp = now.toLocaleString();

      analysisText.textContent =
`–û“õ—É—à—ã: ${sName} (${sClass})
–¢–µ—Å—Ç: ${t.title}
–î“±—Ä—ã—Å –∂–∞—É–∞–ø: ${correct}/${total} ‚Ä¢ –ù”ô—Ç–∏–∂–µ: ${percent}% ‚Ä¢ –£–∞“õ—ã—Ç—ã: ~${durationSec} —Å–µ–∫
–ö“Ø–Ω—ñ/—É–∞“õ—ã—Ç—ã: ${stamp}`;

      // chips
      topTagsDiv.innerHTML = "";
      if(top.length === 0){
        const sp = document.createElement("span");
        sp.className="chip good";
        sp.textContent="“ö–∞—Ç–µ –∂–æ“õ üéâ";
        topTagsDiv.appendChild(sp);
      } else {
        top.forEach(([tag,cnt])=>{
          const sp = document.createElement("span");
          sp.className="chip";
          sp.textContent=`${tag} ‚Äî ${cnt}`;
          topTagsDiv.appendChild(sp);
        });
      }

      // recs
      const recs = buildRecommendations(top);
      recsUl.innerHTML = "";
      recs.forEach(r=>{
        const li = document.createElement("li");
        li.textContent = r;
        recsUl.appendChild(li);
      });

      analysisCard.style.display="block";

      // –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —É—á–∏—Ç–µ–ª—é (Netlify Forms)
      sendOk.style.display="none";
      sendWarn.style.display="none";
      sendToTeacher({
        studentName: sName,
        studentClass: sClass,
        testKey: activeTestKey,
        testTitle: t.title,
        score: `${correct}/${total}`,
        correct,
        total,
        percent,
        durationSec,
        topTags: top.map(([tag,cnt])=>`${tag}:${cnt}`).join(", ") || "none",
        recommendations: recs.join(" | "),
        timestamp: now.toISOString()
      });
    }

    // ============================================================
    // Netlify Forms submit
    // ============================================================
    function encode(data) {
      return Object.keys(data)
        .map(key => encodeURIComponent(key) + "=" + encodeURIComponent(data[key]))
        .join("&");
    }

    async function sendToTeacher(payload){
      // –í–ê–ñ–ù–û: Netlify Forms –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–ª–µ "form-name"
      const data = { "form-name": "results", ...payload };

      try{
        const res = await fetch("/", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: encode(data)
        });
        // Netlify –æ–±—ã—á–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç 200/303
        if(res.ok){
          sendOk.style.display="block";
        }else{
          sendWarn.style.display="block";
        }
      }catch(e){
        sendWarn.style.display="block";
      }
    }

    // ============================================================
    // Start / Reset
    // ============================================================
    startBtn.onclick = ()=>{
      const name = (studentNameInp.value || "").trim();
      const klass = (studentClassInp.value || "").trim();
      if(!name || !klass){
        alert("–ê–ª–¥—ã–º–µ–Ω –∞—Ç—ã-–∂”©–Ω—ñ“£ –∂”ô–Ω–µ —Å—ã–Ω—ã–ø—Ç—ã —Ç–æ–ª—Ç—ã—Ä.");
        return;
      }
      startedAt = Date.now();
      idx = 0;
      answers = [];
      tagCount = new Map();
      analysisCard.style.display="none";
      quizCard.style.display="block";
      renderQuestion();
      window.scrollTo({top: quizCard.offsetTop - 10, behavior:"smooth"});
    };

    resetBtn.onclick = ()=>{
      if(confirm("–ë–∞—Ä–ª—ã“õ –Ω”ô—Ç–∏–∂–µ–Ω—ñ —Ç–∞–∑–∞–ª–∞–π–º—ã–∑ –±–∞?")){
        idx = 0;
        chosen = null;
        answers = [];
        tagCount = new Map();
        startedAt = null;
        quizCard.style.display="none";
        analysisCard.style.display="none";
        sendOk.style.display="none";
        sendWarn.style.display="none";
      }
    };

    againBtn.onclick = ()=>{
      analysisCard.style.display="none";
      quizCard.style.display="none";
      sendOk.style.display="none";
      sendWarn.style.display="none";
      idx = 0;
      chosen = null;
      answers = [];
      tagCount = new Map();
      startedAt = null;
      window.scrollTo({top:0, behavior:"smooth"});
    };

    // ============================================================
    // Check answer
    // ============================================================
    checkBtn.onclick = ()=>{
      const t = TESTS[activeTestKey];
      const q = t.questions[idx];
      if(chosen === null){
        alert("–ñ–∞—É–∞–ø—Ç—ã —Ç–∞“£–¥–∞.");
        return;
      }

      const isCorrect = (chosen === q.correct);

      // store
      answers.push({
        i: idx,
        chosen,
        correct: isCorrect,
        tag: isCorrect ? null : q.tag
      });

      // count tag if wrong
      if(!isCorrect){
        tagCount.set(q.tag, (tagCount.get(q.tag) || 0) + 1);
      }

      // show result
      resultLine.style.display="block";
      checkBtn.disabled = true;

      const badge = document.createElement("span");
      badge.className = "badge " + (isCorrect ? "good":"bad");
      badge.textContent = isCorrect ? "–î“±—Ä—ã—Å ‚úÖ" : "“ö–∞—Ç–µ ‚ùå";
      resultBadge.innerHTML = "";
      resultBadge.appendChild(badge);

      rightAnswerText.textContent = q.options[q.correct];
      shortExplain.textContent = q.short;

      // tag: if correct ‚Äî show helpful info, but keep the field (user asked AI always)
      mistag.textContent = isCorrect ? "‚Äî" : q.tag;

      // AI explain always visible
      aiExplainBtn.style.display = "inline-block";
      aiBox.style.display = "none";
      aiExplainOut.textContent = "";

      aiExplainBtn.onclick = ()=>{
        const txt = buildLongAIExplanation({qObj:q, chosenIndex: chosen, isCorrect});
        aiExplainOut.textContent = txt;
        aiBox.style.display = "block";
        // scroll a bit so student sees it
        aiBox.scrollIntoView({behavior:"smooth", block:"start"});
      };

      // next
      nextBtn.style.display = "inline-block";
      nextBtn.onclick = ()=>{
        if(idx < t.questions.length - 1){
          idx++;
          renderQuestion();
          window.scrollTo({top: quizCard.offsetTop - 10, behavior:"smooth"});
        }else{
          // finish
          quizCard.style.display="none";
          showAnalysis();
          window.scrollTo({top: analysisCard.offsetTop - 10, behavior:"smooth"});
        }
      };
    };

    // init
    renderTabs();
    function encodeFormData(data){
  return Object.keys(data)
    .map(k => encodeURIComponent(k) + "=" + encodeURIComponent(data[k]))
    .join("&");
}

async function submitResultsToNetlify(payload){
  try{
    const res = await fetch("/", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: encodeFormData({
        "form-name": "results",
        ...payload
      })
    });
    return res.ok;
  }catch(e){
    return false;
  }
}

  </script>
  <!-- =========================
     NETLIFY FORMS (HIDDEN)
     –ù”ô—Ç–∏–∂–µ–Ω—ñ –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä—É “Ø—à—ñ–Ω
     ========================= -->
<form name="results" method="POST" data-netlify="true" netlify-honeypot="bot-field" hidden>
  <input type="hidden" name="form-name" value="results" />
  <p hidden>
    <label>Don‚Äôt fill this out: <input name="bot-field" /></label>
  </p>

  <!-- –û“õ—É—à—ã –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ -->
  <input type="text" name="student_name" />
  <input type="text" name="student_class" />

  <!-- –¢–µ—Å—Ç –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ -->
  <input type="text" name="test_title" />
  <input type="text" name="score" />
  <input type="text" name="percent" />
  <input type="text" name="time_spent_sec" />
  <input type="text" name="datetime" />

  <!-- –ê–Ω–∞–ª–∏–∑ -->
  <textarea name="top_tags"></textarea>
  <textarea name="recommendations"></textarea>

  <!-- –¢–µ—Ö–Ω–∏–∫–∞–ª—ã“õ -->
  <textarea name="raw_json"></textarea>
</form>

</body>
</html>
